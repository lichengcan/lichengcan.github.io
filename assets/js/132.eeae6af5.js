(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{552:function(e,r,a){"use strict";a.r(r);var n=a(2),t=Object(n.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("blockquote",[r("p",[e._v("è½¬è½½ï¼šhttps://www.iocoder.cn/Spring-Boot/RabbitMQ/?github")])]),e._v(" "),r("h1",{attrs:{id:"_1-æ¦‚è¿°"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¦‚è¿°"}},[e._v("#")]),e._v(" 1. æ¦‚è¿°")]),e._v(" "),r("p",[e._v("è€ƒè™‘è¿™æ˜¯ RabbitMQ å¦‚ä½•åœ¨ Spring Boot æ•´åˆä¸ä½¿ç”¨çš„æ–‡ç« ï¼Œæ‰€ä»¥è¿˜æ˜¯ç®€å•ä»‹ç»ä¸‹ RabbitMQ æ˜¯ä»€ä¹ˆï¼Ÿ")]),e._v(" "),r("blockquote",[r("p",[e._v("FROM "),r("a",{attrs:{href:"https://www.oschina.net/p/rabbitmq",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠAMQP æ¶ˆæ¯æœåŠ¡å™¨ RabbitMQã€‹"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("RabbitMQ æ˜¯ç”± LShift æä¾›çš„ä¸€ä¸ª Advanced Message Queuing Protocol (AMQP) çš„å¼€æºå®ç°ï¼Œç”±ä»¥é«˜æ€§èƒ½ã€å¥å£®ä»¥åŠå¯ä¼¸ç¼©æ€§å‡ºåçš„ Erlang å†™æˆï¼Œå› æ­¤ä¹Ÿæ˜¯ç»§æ‰¿äº†è¿™äº›ä¼˜ç‚¹ã€‚")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/991c599424d61e17aea8eb76571715c9.jpg",alt:""}})]),e._v(" "),r("ul",[r("li",[e._v("AMQP é‡Œä¸»è¦è¦è¯´ä¸¤ä¸ªç»„ä»¶ï¼šExchange å’Œ Queue ï¼Œç»¿è‰²çš„ X å°±æ˜¯ Exchange ï¼Œçº¢è‰²çš„æ˜¯ Queue ï¼Œè¿™ä¸¤è€…éƒ½åœ¨ Server ç«¯ï¼Œåˆç§°ä½œ Broker ï¼Œè¿™éƒ¨åˆ†æ˜¯ RabbitMQ å®ç°çš„ã€‚")]),e._v(" "),r("li",[e._v("è€Œè“è‰²çš„åˆ™æ˜¯å®¢æˆ·ç«¯ï¼Œé€šå¸¸æœ‰ Producer å’Œ Consumer ä¸¤ç§ç±»å‹ï¼ˆè§’è‰²ï¼‰ã€‚")])])]),e._v(" "),r("p",[e._v("åœ¨æœ¬æ–‡ä¸­ï¼Œæä¾›æ›´å¤šçš„ç”Ÿäº§è€… Producer å’Œæ¶ˆè´¹è€… Consumer çš„ä½¿ç”¨ç¤ºä¾‹ã€‚ä¾‹å¦‚è¯´ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("å››ç§ç±»å‹çš„äº¤æ¢æœº( Exchange )")]),e._v(" "),r("li",[e._v("Producer å‘é€"),r("strong",[e._v("é¡ºåº")]),e._v("æ¶ˆæ¯ï¼ŒConsumer "),r("strong",[e._v("é¡ºåº")]),e._v("æ¶ˆè´¹æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("Producer å‘é€"),r("strong",[e._v("å®šæ—¶")]),e._v("æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("Producer "),r("strong",[e._v("æ‰¹é‡")]),e._v("å‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("Producer å‘é€"),r("strong",[e._v("äº‹åŠ¡")]),e._v("æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("Consumer "),r("strong",[e._v("å¹¿æ’­")]),e._v("å’Œ"),r("strong",[e._v("é›†ç¾¤")]),e._v("æ¶ˆè´¹æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚")])]),e._v(" "),r("h1",{attrs:{id:"_2-spring-amqp"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-spring-amqp"}},[e._v("#")]),e._v(" 2. Spring-AMQP")]),e._v(" "),r("p",[e._v("åœ¨ Spring ç”Ÿæ€ä¸­ï¼Œæä¾›äº† "),r("a",{attrs:{href:"https://spring.io/projects/spring-amqp",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring-AMQP"),r("OutboundLink")],1),e._v(" é¡¹ç›®ï¼Œè®©æˆ‘ä»¬æ›´ç®€ä¾¿çš„ä½¿ç”¨ AMQP ã€‚å…¶å®˜ç½‘ä»‹ç»å¦‚ä¸‹ï¼š")]),e._v(" "),r("blockquote",[r("p",[e._v("The Spring AMQP project applies core Spring concepts to the development of AMQP-based messaging solutions. Spring-AMQP é¡¹ç›®å°† Spring æ ¸å¿ƒæ¦‚å¿µåº”ç”¨äºåŸºäº AMQP çš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆçš„å¼€å‘ã€‚")]),e._v(" "),r("p",[e._v('It provides a "template" as a high-level abstraction for sending and receiving messages. å®ƒæä¾›äº†ä¸€ä¸ªâ€œæ¨¡æ¿â€ä½œä¸ºå‘é€æ¶ˆæ¯çš„é«˜çº§æŠ½è±¡ã€‚')]),e._v(" "),r("p",[e._v('It also provides support for Message-driven POJOs with a "listener container". å®ƒè¿˜é€šè¿‡â€œä¾¦å¬å™¨å®¹å™¨â€ä¸ºæ¶ˆæ¯é©±åŠ¨çš„ POJO æä¾›æ”¯æŒã€‚')]),e._v(" "),r("p",[e._v("These libraries facilitate management of AMQP resources while promoting the use of dependency injection and declarative configuration. è¿™äº›åº“ä¿ƒè¿› AMQP èµ„æºçš„ç®¡ç†ï¼ŒåŒæ—¶ä¿ƒè¿›ä½¿ç”¨ä¾èµ–æ³¨å…¥å’Œå£°æ˜æ€§é…ç½®ã€‚")]),e._v(" "),r("p",[e._v("In all of these cases, you will see similarities to the JMS support in the Spring Framework. åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å°†çœ‹åˆ°ä¸ Spring æ¡†æ¶ä¸­çš„ JMS æ”¯æŒçš„ç›¸ä¼¼ä¹‹å¤„ã€‚")]),e._v(" "),r("p",[e._v("The project consists of two parts; spring-amqp is the base abstraction, and spring-rabbit is the RabbitMQ implementation. è¯¥é¡¹ç›®åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://mvnrepository.com/artifact/org.springframework.amqp/spring-amqp",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("spring-amqp")]),r("OutboundLink")],1),e._v(" æ˜¯ AMQP çš„åŸºç¡€æŠ½è±¡ã€‚")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://mvnrepository.com/artifact/org.springframework.amqp/spring-rabbit",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("spring-rabbit")]),r("OutboundLink")],1),e._v(" æ˜¯åŸºäº RabbitMQ å¯¹ AMQP çš„å…·ä½“å®ç°ã€‚")])])]),e._v(" "),r("ul",[r("li",[e._v("å…¶å®é‡ç‚¹æ˜¯æœ€åä¸€æ®µå†…å®¹ï¼Œç›¸ä¿¡èƒ–å‹èƒ½å¤Ÿæ˜ç™½æ„æ€çš„ã€‚")])]),e._v(" "),r("blockquote",[r("p",[e._v("Features(åŠŸèƒ½ç‰¹æ€§)")]),e._v(" "),r("ul",[r("li",[e._v("Listener container for asynchronous processing of inbound messages ç›‘å¬å™¨å®¹å™¨ï¼šå¼‚æ­¥å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/RabbitTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitTemplate"),r("OutboundLink")],1),e._v(" for sending and receiving messages RabbitTemplateï¼šå‘é€å’Œæ¥æ”¶æ¶ˆæ¯")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/RabbitAdmin.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitAdmin"),r("OutboundLink")],1),e._v(" for automatically declaring queues, exchanges and bindings RabbitAdminï¼šè‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—ï¼Œäº¤æ¢å™¨ï¼Œç»‘å®šå™¨ã€‚")])])]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://spring.io/projects/spring-boot",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring-Boot"),r("OutboundLink")],1),e._v(" é¡¹ç›®ä¸­ï¼Œæä¾›äº† AMQP å’Œ RabbitMQ çš„è‡ªåŠ¨åŒ–é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»…éœ€å¼•å…¥ "),r("a",{attrs:{href:"https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("spring-boot-starter-amqp")]),r("OutboundLink")],1),e._v(" ä¾èµ–ï¼Œå³å¯æ„‰å¿«çš„ä½¿ç”¨ã€‚")]),e._v(" "),r("h1",{attrs:{id:"_3-å¿«é€Ÿå…¥é—¨"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¿«é€Ÿå…¥é—¨"}},[e._v("#")]),e._v(" 3. å¿«é€Ÿå…¥é—¨")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo"),r("OutboundLink")],1),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("åœ¨ AMQP ä¸­ï¼ŒProducer å°†æ¶ˆæ¯å‘é€åˆ° Exchange ï¼Œå†ç”± Exchange å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª Queue ä¸­ï¼ˆæˆ–è€…ä¸¢å¼ƒï¼‰ã€‚")]),e._v(" "),r("blockquote",[r("p",[e._v("æ¦‚å¿µçš„è®²è§£ï¼Œå¼•ç”¨è‡ª "),r("a",{attrs:{href:"http://www.iocoder.cn/RabbitMQ/Detailed-understanding-of-the-basic-concepts-of-RabbitMQ/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠRabbitMQ åŸºç¡€æ¦‚å¿µè¯¦è§£ã€‹"),r("OutboundLink")],1),e._v(" æ–‡ç« ã€‚")])]),e._v(" "),r("p",[e._v("Exchange æ ¹æ® Routing Key å’Œ Binding Key å°†æ¶ˆæ¯è·¯ç”±åˆ° Queue ã€‚ç›®å‰æä¾›äº† Directã€Topicã€Fanoutã€Headers å››ç§ç±»å‹ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_3-1-direct-exchange"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-direct-exchange"}},[e._v("#")]),e._v(" 3.1 Direct Exchange")]),e._v(" "),r("p",[e._v("Direct ç±»å‹çš„ Exchange è·¯ç”±è§„åˆ™æ¯”è¾ƒç®€å•ï¼Œå®ƒä¼šæŠŠæ¶ˆæ¯è·¯ç”±åˆ°é‚£äº› binding key ä¸ routing key å®Œå…¨åŒ¹é…çš„ Queue ä¸­ã€‚ä»¥ä¸‹å›¾çš„é…ç½®ä¸ºä¾‹ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/aeb33c91bbf83726c24ba1dae9dc4e00.jpg",alt:""}})]),e._v(" "),r("ul",[r("li",[e._v("æˆ‘ä»¬ä»¥ "),r("code",[e._v('routingKey="error"')]),e._v(" å‘é€æ¶ˆæ¯åˆ° Exchange ï¼Œåˆ™æ¶ˆæ¯ä¼šè·¯ç”±åˆ° Queue1("),r("code",[e._v("amqp.gen-S9bâ€¦")]),e._v(") ã€‚")]),e._v(" "),r("li",[e._v("æˆ‘ä»¬ä»¥ "),r("code",[e._v('routingKey="info"')]),e._v(" æˆ– "),r("code",[e._v('routingKey="warning"')]),e._v(" æ¥å‘é€æ¶ˆæ¯ï¼Œåˆ™æ¶ˆæ¯åªä¼šè·¯ç”±åˆ° Queue2("),r("code",[e._v("amqp.gen-Aglâ€¦")]),e._v(") ã€‚")]),e._v(" "),r("li",[e._v("å¦‚æœæˆ‘ä»¬ä»¥å…¶å®ƒ routingKey å‘é€æ¶ˆæ¯ï¼Œåˆ™æ¶ˆæ¯ä¸ä¼šè·¯ç”±åˆ°è¿™ä¸¤ä¸ª Queue ä¸­ã€‚")]),e._v(" "),r("li",[e._v("æ€»ç»“æ¥è¯´ï¼ŒæŒ‡å®š Exchange + routing key ï¼Œæœ‰ä¸”ä»…ä¼šè·¯ç”±åˆ°è‡³å¤šä¸€ä¸ª Queue ä¸­ã€‚ğŸ˜ˆ æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œæ¶ˆæ¯å°±å‘é€åˆ°â€œç©ºæ°”â€ä¸­ï¼Œä¸ä¼šè¿›å…¥ä»»ä½• Queue ä¸­ã€‚")])]),e._v(" "),r("blockquote",[r("p",[e._v("æ³¨ï¼šQueue åå­— "),r("code",[e._v("amqp.gen-S9bâ€¦")]),e._v(" å’Œ "),r("code",[e._v("amqp.gen-Aglâ€¦")]),e._v(" è‡ªåŠ¨ç”Ÿæˆçš„ã€‚")])]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Direct Exchange çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå¯¹åº” "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-1-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 3.1.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–ã€‚")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.2.1.RELEASE</version>\n        <relativePath/> \x3c!-- lookup parent from repository --\x3e\n    </parent>\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>lab-04-rabbitmq-demo</artifactId>\n\n    <dependencies>\n        \x3c!-- å®ç°å¯¹ RabbitMQ çš„è‡ªåŠ¨åŒ–é…ç½® --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-amqp</artifactId>\n        </dependency>\n\n        \x3c!-- æ–¹ä¾¿ç­‰ä¼šå†™å•å…ƒæµ‹è¯• --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n</project>\n')])])]),r("p",[e._v("å…·ä½“æ¯ä¸ªä¾èµ–çš„ä½œç”¨ï¼Œèƒ–å‹è‡ªå·±è®¤çœŸçœ‹ä¸‹è‰¿è‰¿æ·»åŠ çš„æ‰€æœ‰æ³¨é‡Šå™¢ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-1-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/resources",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("resources")]),r("OutboundLink")],1),e._v(" ç›®å½•ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("spring:\n  # RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»\n  rabbitmq:\n    host: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\n    port: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\n    username: guest # RabbitMQ æœåŠ¡çš„è´¦å·\n    password: guest # RabbitMQ æœåŠ¡çš„å¯†ç \n")])])]),r("ul",[r("li",[e._v("åœ¨ "),r("code",[e._v("spring.rabbitmq")]),e._v(" é…ç½®é¡¹ï¼Œè®¾ç½® RabbitMQ çš„é…ç½®ï¼Œå¯¹åº” "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitProperties"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ã€‚è¿™é‡Œå’±æš‚æ—¶æœ€å°åŒ–æ·»åŠ ï¼Œæ›´å¤šçš„é…ç½®é¡¹ï¼Œæˆ‘ä»¬åœ¨ä¸‹æ–‡çš„ç¤ºä¾‹ä¸­ï¼Œä¸€ç‚¹ç‚¹æŠ½ä¸å‰¥èŒ§ã€‚")]),e._v(" "),r("li",[e._v("Spring Boot æä¾›çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitAutoConfiguration.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitAutoConfiguration"),r("OutboundLink")],1),e._v(" è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° RabbitMQ çš„è‡ªåŠ¨é…ç½®ï¼Œåˆ›å»ºç›¸åº”çš„ Producer å’Œ Consumer ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-1-3-application"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-application"}},[e._v("#")]),e._v(" 3.1.3 Application")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/Application.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Application.java")]),r("OutboundLink")],1),e._v(" ç±»ï¼Œé…ç½® "),r("code",[e._v("@SpringBootApplication")]),e._v(" æ³¨è§£å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Application.java\n\n@SpringBootApplication\n@EnableAsync // å¼€å¯å¼‚æ­¥\npublic class Application {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("æˆ‘ä»¬é¢å¤–æ·»åŠ äº† "),r("code",[e._v("@EnableAsync")]),e._v(" æ³¨è§£ï¼Œå› ä¸ºæˆ‘ä»¬ç¨åè¦ä½¿ç”¨ Spring æä¾›çš„å¼‚æ­¥è°ƒç”¨çš„åŠŸèƒ½ã€‚ä¸äº†è§£è¿™å—çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹è‰¿è‰¿å†™çš„ "),r("a",{attrs:{href:"http://www.iocoder.cn/Spring-Boot/Async-Job/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠèŠ‹é“ Spring Boot å¼‚æ­¥ä»»åŠ¡å…¥é—¨ã€‹"),r("OutboundLink")],1),e._v(" æ–‡ç« ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-1-4-demo01message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-demo01message"}},[e._v("#")]),e._v(" 3.1.4 Demo01Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo01Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo01Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo01Message.java\n\npublic class Demo01Message implements Serializable {\n\n    public static final String QUEUE = "QUEUE_DEMO_01";\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_01";\n\n    public static final String ROUTING_KEY = "ROUTING_KEY_01";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("æ³¨æ„ï¼Œè¦å®ç° Java Serializable åºåˆ—åŒ–æ¥å£ã€‚å› ä¸º RabbitTemplate é»˜è®¤ä½¿ç”¨ Java è‡ªå¸¦çš„åºåˆ—åŒ–æ–¹å¼ï¼Œè¿›è¡Œåºåˆ—åŒ– POJO ç±»å‹çš„æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("åœ¨æ¶ˆæ¯ç±»é‡Œï¼Œæˆ‘ä»¬æšä¸¾äº† Exchangeã€Queueã€RoutingKey çš„åå­—ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-1-5-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-rabbitconfig"}},[e._v("#")]),e._v(" 3.1.5 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ  Direct Exchange ç¤ºä¾‹ç›¸å…³çš„ Exchangeã€Queueã€Binding çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\nimport org.springframework.amqp.core.Queue;\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo01Queue() {\n            return new Queue(Demo01Message.QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo01Exchange() {\n            return new DirectExchange(Demo01Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo01Message.EXCHANGE\n        // Routing keyï¼šDemo01Message.ROUTING_KEY\n        // Queueï¼šDemo01Message.QUEUE\n        @Bean\n        public Binding demo01Binding() {\n            return BindingBuilder.bind(demo01Queue()).to(demo01Exchange()).with(Demo01Message.ROUTING_KEY);\n        }\n\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("åœ¨ DirectExchangeDemoConfiguration å†…éƒ¨é™æ€ç±»ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† Exchangeã€Queueã€Binding ä¸‰ä¸ª Bean ï¼Œåç»­ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/RabbitAdmin.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitAdmin"),r("OutboundLink")],1),e._v(" ä¼šè‡ªåŠ¨åˆ›å»ºäº¤æ¢å™¨ã€é˜Ÿåˆ—ã€ç»‘å®šå™¨ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/RabbitAdmin.java#L555-L612",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("RabbitAdmin#initialize()")]),r("OutboundLink")],1),e._v(" æ–¹æ³•ï¼Œæˆ– "),r("a",{attrs:{href:"https://my.oschina.net/huaxian8812/blog/782300",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠRabbitMQ è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—/äº¤æ¢å™¨/ç»‘å®šã€‹"),r("OutboundLink")],1),e._v(" æ–‡ç« ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-1-6-demo01producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-6-demo01producer"}},[e._v("#")]),e._v(" 3.1.6 Demo01Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo01Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo01Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo01Producer.java\n\n@Component\npublic class Demo01Producer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id) {\n        // åˆ›å»º Demo01Message æ¶ˆæ¯\n        Demo01Message message = new Demo01Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo01Message.EXCHANGE, Demo01Message.ROUTING_KEY, message);\n    }\n\n    public void syncSendDefault(Integer id) {\n        // åˆ›å»º Demo01Message æ¶ˆæ¯\n        Demo01Message message = new Demo01Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo01Message.QUEUE, message);\n    }\n\n    @Async\n    public ListenableFuture<Void> asyncSend(Integer id) {\n        try {\n            // å‘é€æ¶ˆæ¯\n            this.syncSend(id);\n            // è¿”å›æˆåŠŸçš„ Future\n            return AsyncResult.forValue(null);\n        } catch (Throwable ex) {\n            // è¿”å›å¼‚å¸¸çš„ Future\n            return AsyncResult.forExecutionException(ex);\n        }\n    }\n\n}\n")])])]),r("ul",[r("li",[r("p",[e._v("RabbitTemplate æ˜¯ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/AmqpTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("AmqpTemplate"),r("OutboundLink")],1),e._v(" æ¥å£çš„å®ç°ç±»ï¼Œæ‰€ä»¥æ­¤æ—¶ä½¿ç”¨ AmqpTemplate äº¦å¯ã€‚ä¸è¿‡åˆå› ä¸º RabbitTemplate è¿˜å®ç°äº†å…¶å®ƒæ¥å£ï¼Œæ‰€ä»¥æ“ä½œä¼šæ›´ä¸ºä¸°å¯Œã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©äº†æ³¨å…¥ RabbitTemplate å±æ€§ã€‚")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("#syncSend(Integer id)")]),e._v(" æ–¹æ³•ï¼Œè°ƒç”¨ RabbitTemplate çš„åŒæ­¥å‘é€æ¶ˆæ¯æ–¹æ³•ã€‚æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// AmqpTemplate.java\n\nvoid convertAndSend(String exchange, String routingKey, Object message) throws AmqpException;\n")])])]),r("ul",[r("li",[e._v("æŒ‡å®š Exchange + RoutingKey ï¼Œä»è€Œè·¯ç”±åˆ°ä¸€ä¸ª Queue ä¸­ã€‚")])])]),e._v(" "),r("li",[r("p",[r("code",[e._v("#syncSendDefault(Integer id)")]),e._v(" æ–¹æ³•ï¼Œä¹Ÿè°ƒç”¨ RabbitTemplate çš„åŒæ­¥å‘é€æ¶ˆæ¯æ–¹æ³•ã€‚æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// AmqpTemplate.java\n\nvoid convertAndSend(String routingKey, Object message) throws AmqpException;\n")])])]),r("ul",[r("li",[e._v("æ˜¯ä¸æ˜¯è§‰å¾—æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™é‡Œæˆ‘ä»¬ä¼ å…¥çš„ RoutingKey ä¸ºé˜Ÿåˆ—åï¼Ÿï¼å› ä¸º RabbitMQ æœ‰ä¸€æ¡é»˜è®¤çš„ "),r("a",{attrs:{href:"https://emacsist.github.io/2015/12/06/rabbitmq%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/#default-exchange-%E9%BB%98%E8%AE%A4%E4%BA%A4%E6%8D%A2%E6%9C%BA",target:"_blank",rel:"noopener noreferrer"}},[e._v("Exchange: (AMQP default)"),r("OutboundLink")],1),e._v(" è§„åˆ™ï¼š"),r("code",[e._v("The default exchange is implicitly bound to every queue, with a routing key equal to the queue name. It is not possible to explicitly bind to, or unbind from the default exchange. It also cannot be deleted")]),e._v(" ã€‚")]),e._v(" "),r("li",[e._v("ç¿»è¯‘è¿‡æ¥çš„æ„æ€ï¼šé»˜è®¤äº¤æ¢å™¨ï¼Œéšå¼åœ°ç»‘å®šåˆ°æ¯ä¸ªé˜Ÿåˆ—ï¼Œè·¯ç”±é”®ç­‰äºé˜Ÿåˆ—åç§°ã€‚")]),e._v(" "),r("li",[e._v("æ‰€ä»¥ï¼Œæ­¤å¤„å³ä½¿æˆ‘ä»¬ä¼ å…¥çš„ RoutingKey ä¸ºé˜Ÿåˆ—åï¼Œä¸€æ ·å¯ä»¥å‘åˆ°å¯¹åº”é˜Ÿåˆ—ã€‚")])])]),e._v(" "),r("li",[r("p",[r("code",[e._v("#asyncSend(Integer id)")]),e._v(" æ–¹æ³•ï¼Œé€šè¿‡ "),r("code",[e._v("@Async")]),e._v(" æ³¨è§£ï¼Œå£°æ˜å¼‚æ­¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä»è€Œå®ç°å¼‚æ­¥æ¶ˆæ¯åˆ° RabbitMQ ä¸­ã€‚å› ä¸º RabbitTemplate å¹¶æœªåƒ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/core/KafkaTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("KafkaTemplate"),r("OutboundLink")],1),e._v(" æˆ– "),r("a",{attrs:{href:"https://github.com/apache/rocketmq-spring/blob/master/rocketmq-spring-boot/src/main/java/org/apache/rocketmq/spring/core/RocketMQTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RocketMQTemplate"),r("OutboundLink")],1),e._v(" ç›´æ¥æä¾›äº†å¼‚æ­¥å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»“åˆ Spring å¼‚æ­¥è°ƒç”¨æ¥å®ç°ã€‚")]),e._v(" "),r("blockquote",[r("p",[e._v("åœ¨å†™å®Œæœ¬æ–‡ä¹‹åï¼Œå‘ç°è¿˜å­˜åœ¨ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/AsyncRabbitTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("AsyncRabbitTemplate"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæä¾›ä¸€éƒ¨çš„ RabbitMQ æ“ä½œã€‚ğŸ˜ˆ")])])])]),e._v(" "),r("h3",{attrs:{id:"_3-1-7-demo01consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-7-demo01consumer"}},[e._v("#")]),e._v(" 3.1.7 Demo01Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo01Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo01Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo01Consumer.java\n\n@Component\n@RabbitListener(queues = Demo01Message.QUEUE)\npublic class Demo01Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo01Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n//    @RabbitHandler(isDefault = true)\n//    public void onMessage(org.springframework.amqp.core.Message message) {\n//        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n//    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ç±»ä¸Šï¼Œæ·»åŠ äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/annotation/RabbitListener.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@RabbitListener")]),r("OutboundLink")],1),e._v(" æ³¨è§£ï¼Œå£°æ˜äº†æ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ "),r("code",[e._v('"QUEUE_DEMO_01"')]),e._v(" ã€‚")]),e._v(" "),r("li",[e._v("åœ¨æ–¹æ³•ä¸Šï¼Œæ·»åŠ äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/annotation/RabbitHandler.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@RabbitHandler")]),r("OutboundLink")],1),e._v(" æ³¨è§£ï¼Œç”³æ˜äº†å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œæ–¹æ³•å…¥å‚ä¸ºæ¶ˆæ¯çš„ç±»å‹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®äº†"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v(" ã€‚")]),e._v(" "),r("li",[e._v("å¦‚æœæˆ‘ä»¬æƒ³è¦è·å¾—æ¶ˆè´¹æ¶ˆæ¯çš„æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚è¯´ï¼ŒRoutingKeyã€åˆ›å»ºæ—¶é—´ç­‰ç­‰ä¿¡æ¯ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨è‰¿è‰¿"),r("strong",[e._v("æ³¨é‡Šæ‰çš„é‚£æ®µä»£ç ")]),e._v("ï¼Œé€šè¿‡æ–¹æ³•å…¥å‚ä¸º "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/Message.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("org.springframework.amqp.core.Message")]),r("OutboundLink")],1),e._v(" ç±»å‹ã€‚ä¸è¿‡ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆåšã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-1-8-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-8-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 3.1.8 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo01ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo01ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸‰ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo01Producer ä¸‰ä¸ªå‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo01ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo01ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo01Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n    @Test\n    public void tesSyncSendDefault() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSendDefault(id);\n        logger.info("[tesSyncSendDefault][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n    @Test\n    public void testAsyncSend() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.asyncSend(id).addCallback(new ListenableFutureCallback<Void>() {\n\n            @Override\n            public void onFailure(Throwable e) {\n                logger.info("[testASyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€å¼‚å¸¸]]", id, e);\n            }\n\n            @Override\n            public void onSuccess(Void aVoid) {\n                logger.info("[testASyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸï¼Œå‘é€æˆåŠŸ]", id);\n            }\n\n        });\n        logger.info("[testASyncSend][å‘é€ç¼–å·ï¼š[{}] è°ƒç”¨å®Œæˆ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±çœ‹ä¸‹ä¸‰ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" æ–¹æ³•ï¼Œæµ‹è¯•åŒæ­¥å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 00:19:18.736  INFO 87164 --- [           main] c.i.s.l.r.producer.Demo01ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575908358] å‘é€æˆåŠŸ]\n\n# Demo01Consumer æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 00:19:18.751  INFO 87164 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo01Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message{id=1575908358}]\n")])])]),r("ul",[r("li",[e._v("åŒæ­¥å‘é€çš„æ¶ˆæ¯ï¼ŒæˆåŠŸè¢«æ¶ˆè´¹ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å†æ¥æ‰§è¡Œ "),r("code",[e._v("#tesSyncSendDefault()")]),e._v(" æ–¹æ³•ï¼Œæµ‹è¯•å¦ä¸€ä¸ªåŒæ­¥å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 00:20:50.226  INFO 87515 --- [           main] c.i.s.l.r.producer.Demo01ProducerTest    : [tesSyncSendDefault][å‘é€ç¼–å·ï¼š[1575908450] å‘é€æˆåŠŸ]\n\n# Demo01Consumer æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 00:20:50.240  INFO 87515 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo01Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message{id=1575908450}]\n")])])]),r("ul",[r("li",[e._v("åŒæ­¥å‘é€çš„æ¶ˆæ¯ï¼ŒæˆåŠŸä¹Ÿè¢«æ¶ˆè´¹ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æœ€åæ¥æ‰§è¡Œ "),r("code",[e._v("#testAsyncSend()")]),e._v(" æ–¹æ³•ï¼Œæµ‹è¯•å¼‚æ­¥å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer å¼‚æ­¥å‘é€æ¶ˆæ¯çš„è°ƒç”¨å®Œæˆã€‚\n2019-12-15 00:22:48.891  INFO 88018 --- [           main] c.i.s.l.r.producer.Demo01ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[1575908568] è°ƒç”¨å®Œæˆ]\n\n# Producer å¼‚æ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚ã€å›è°ƒã€‘\n2019-12-15 00:22:48.905  INFO 88018 --- [         task-1] c.i.s.l.r.producer.Demo01ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[1575908568] å‘é€æˆåŠŸï¼Œå‘é€æˆåŠŸ]\n\n# Demo01Consumer æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 00:22:48.918  INFO 88018 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo01Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message{id=1575908568}]\n")])])]),r("ul",[r("li",[e._v("å¼‚æ­¥å‘é€çš„æ¶ˆæ¯ï¼ŒæˆåŠŸä¹Ÿè¢«æ¶ˆè´¹ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_3-2-topic-exchange"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-topic-exchange"}},[e._v("#")]),e._v(" 3.2 Topic Exchange")]),e._v(" "),r("p",[e._v("å‰é¢è®²åˆ° Direct Exchangeè·¯ç”±è§„åˆ™ï¼Œæ˜¯å®Œå…¨åŒ¹é… binding key ä¸routing keyï¼Œä½†è¿™ç§ä¸¥æ ¼çš„åŒ¹é…æ–¹å¼åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¸èƒ½æ»¡è¶³å®é™…ä¸šåŠ¡éœ€æ±‚ã€‚")]),e._v(" "),r("p",[e._v("Topic Exchange åœ¨åŒ¹é…è§„åˆ™ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œå®ƒä¸ Direct ç±»å‹çš„Exchange "),r("strong",[e._v("ç›¸ä¼¼")]),e._v("ï¼Œä¹Ÿæ˜¯å°†æ¶ˆæ¯è·¯ç”±åˆ° binding key ä¸ routing key ç›¸åŒ¹é…çš„ Queue ä¸­ï¼Œä½†è¿™é‡Œçš„åŒ¹é…è§„åˆ™æœ‰äº›ä¸åŒï¼Œå®ƒçº¦å®šï¼š")]),e._v(" "),r("ul",[r("li",[e._v("routing key ä¸ºä¸€ä¸ªå¥ç‚¹å· "),r("code",[e._v('"."')]),e._v(" åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å°†è¢«å¥ç‚¹å·"),r("code",[e._v('"."')]),e._v('åˆ†éš”å¼€çš„æ¯ä¸€æ®µç‹¬ç«‹çš„å­—ç¬¦ä¸²ç§°ä¸ºä¸€ä¸ªå•è¯ï¼Œä¾‹å¦‚ "stock.usd.nyse"ã€"nyse.vmw"ã€"quick.orange.rabbit"')]),e._v(" "),r("li",[e._v("binding key ä¸ routing key ä¸€æ ·ä¹Ÿæ˜¯å¥ç‚¹å· "),r("code",[e._v('"."')]),e._v(" åˆ†éš”çš„å­—ç¬¦ä¸²ã€‚")]),e._v(" "),r("li",[e._v("binding key ä¸­å¯ä»¥å­˜åœ¨ä¸¤ç§ç‰¹æ®Šå­—ç¬¦ "),r("code",[e._v('"*"')]),e._v(" ä¸ "),r("code",[e._v('"#"')]),e._v("ï¼Œç”¨äºåšæ¨¡ç³ŠåŒ¹é…ã€‚å…¶ä¸­ "),r("code",[e._v('"*"')]),e._v(" ç”¨äºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ"),r("code",[e._v('"#"')]),e._v(" ç”¨äºåŒ¹é…å¤šä¸ªå•è¯ï¼ˆå¯ä»¥æ˜¯é›¶ä¸ªï¼‰ã€‚")])]),e._v(" "),r("p",[e._v("ä»¥ä¸‹å›¾ä¸­çš„é…ç½®ä¸ºä¾‹ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/d343228b9d7606ac673ccd0028d4e424.jpg",alt:""}})]),e._v(" "),r("ul",[r("li",[r("code",[e._v('routingKey="quick.orange.rabbit"')]),e._v(" çš„æ¶ˆæ¯ä¼šåŒæ—¶è·¯ç”±åˆ° Q1 ä¸ Q2 ã€‚")]),e._v(" "),r("li",[r("code",[e._v('routingKey="lazy.orange.fox"')]),e._v(" çš„æ¶ˆæ¯ä¼šè·¯ç”±åˆ° Q1 ã€‚")]),e._v(" "),r("li",[r("code",[e._v('routingKey="lazy.brown.fox"')]),e._v(" çš„æ¶ˆæ¯ä¼šè·¯ç”±åˆ° Q2 ã€‚")]),e._v(" "),r("li",[r("code",[e._v('routingKey="lazy.pink.rabbit"')]),e._v(" çš„æ¶ˆæ¯ä¼šè·¯ç”±åˆ°Q2ï¼ˆåªä¼šæŠ•é€’ç»™ Q2 ä¸€æ¬¡ï¼Œè™½ç„¶è¿™ä¸ª routingKey ä¸ Q2 çš„ä¸¤ä¸ª bindingKey éƒ½åŒ¹é…ï¼‰ã€‚")]),e._v(" "),r("li",[r("code",[e._v('routingKey="quick.brown.fox"')]),e._v("ã€"),r("code",[e._v('routingKey="orange"')]),e._v("ã€"),r("code",[e._v('routingKey="quick.orange.male.rabbit"')]),e._v(" çš„æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰åŒ¹é…ä»»ä½• bindingKey ã€‚")])]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Topic Exchange çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œç»§ç»­åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-2-1-demo02message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-demo02message"}},[e._v("#")]),e._v(" 3.2.1 Demo02Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo02Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo02Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo02Message.java\n\npublic class Demo02Message implements Serializable {\n\n    public static final String QUEUE = "QUEUE_DEMO_02";\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_02";\n\n    public static final String ROUTING_KEY = "#.yu.nai";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨æ¶ˆæ¯ç±»é‡Œï¼Œæˆ‘ä»¬æšä¸¾äº† Exchangeã€Queueã€RoutingKey çš„åå­—ã€‚")]),e._v(" "),r("li",[e._v("é‡ç‚¹çœ‹æˆ‘ä»¬æ–°å®šä¹‰çš„è·¯ç”±é”® "),r("code",[e._v('ROUTING_KEY = "#.yu.nai"')]),e._v(" ï¼Œæˆ‘ä»¬è¦åŒ¹é…ä»¥ "),r("code",[e._v('"yu.nai"')]),e._v(" ç»“å°¾ï¼Œå¼€å¤´å¯ä»¥æ˜¯ä»»æ„ä¸ªå•è¯çš„ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-2-2-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-rabbitconfig"}},[e._v("#")]),e._v(" 3.2.2 RabbitConfig")]),e._v(" "),r("p",[e._v("ä¿®æ”¹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ  Topic Exchange ç¤ºä¾‹ç›¸å…³çš„ Exchangeã€Queueã€Binding çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n/**\n * Topic Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n */\npublic static class TopicExchangeDemoConfiguration {\n\n    // åˆ›å»º Queue\n    @Bean\n    public Queue demo02Queue() {\n        return new Queue(Demo02Message.QUEUE, // Queue åå­—\n                true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                false, // exclusive: æ˜¯å¦æ’å®ƒ\n                false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n    }\n\n    // åˆ›å»º Topic Exchange\n    @Bean\n    public TopicExchange demo02Exchange() {\n        return new TopicExchange(Demo02Message.EXCHANGE,\n                true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                false);  // exclusive: æ˜¯å¦æ’å®ƒ\n    }\n\n    // åˆ›å»º Binding\n    // Exchangeï¼šDemo02Message.EXCHANGE\n    // Routing keyï¼šDemo02Message.ROUTING_KEY\n    // Queueï¼šDemo02Message.QUEUE\n    @Bean\n    public Binding demo02Binding() {\n        return BindingBuilder.bind(demo02Queue()).to(demo02Exchange()).with(Demo02Message.ROUTING_KEY);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("åœ¨ TopicExchangeDemoConfiguration å†…éƒ¨é™æ€ç±»ä¸­ï¼Œæˆ‘ä»¬"),r("strong",[e._v("ä¹Ÿæ˜¯")]),e._v("åˆ›å»ºäº† Exchangeã€Queueã€Binding ä¸‰ä¸ª Bean ã€‚æœ‰å·®å¼‚ç‚¹çš„æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/TopicExchange.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("TopicExchange"),r("OutboundLink")],1),e._v(" ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-2-3-demo02producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-demo02producer"}},[e._v("#")]),e._v(" 3.2.3 Demo02Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo02Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo02Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo02Producer.java\n\n@Component\npublic class Demo02Producer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id, String routingKey) {\n        // åˆ›å»º Demo02Message æ¶ˆæ¯\n        Demo02Message message = new Demo02Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo02Message.EXCHANGE, routingKey, message);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("çš„ "),r("code",[e._v("#syncSend(Integer id)")]),e._v(" æ–¹æ³•å¤§ä½“ç›¸ä¼¼ï¼Œå·®å¼‚ç‚¹åœ¨äºæ–°å¢äº†æ–¹æ³•å‚æ•° "),r("code",[e._v("routingKey")]),e._v(" ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¼ å…¥ä¸åŒçš„è·¯ç”±é”®ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-2-4-demo02consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-demo02consumer"}},[e._v("#")]),e._v(" 3.2.4 Demo02Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo02Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo02Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.7 Demo01Consumerã€"),r("OutboundLink")],1),e._v("åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºæ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ "),r("code",[e._v('"QUEUE_DEMO_02"')]),e._v(" ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-2-5-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 3.2.5 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo02ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo02ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸¤ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo02Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo02ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo02ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo02Producer producer;\n\n    @Test\n    public void testSyncSendSuccess() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id, "da.yu.nai");\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n    @Test\n    public void testSyncSendFailure() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id, "yu.nai.shuai");\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[r("code",[e._v("#testSyncSendSuccess()")]),e._v(" æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯çš„ RoutingKey æ˜¯ "),r("code",[e._v('"da.yu.nai"')]),e._v(" ï¼Œå¯ä»¥åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_02"')]),e._v(" ã€‚")]),e._v(" "),r("li",[r("code",[e._v("#testSyncSendFailure()")]),e._v(" æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯çš„ RoutingKey æ˜¯ "),r("code",[e._v('"yu.nai.shuai"')]),e._v(" ï¼Œæ— æ³•åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_02"')]),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å…ˆæ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSendSuccess()")]),e._v(" æ–¹æ³•ï¼Œå¯ä»¥åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_02"')]),e._v(" çš„æƒ…å†µã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 09:35:54.924  INFO 6894 --- [           main] c.i.s.l.r.producer.Demo02ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575941754] å‘é€æˆåŠŸ]\n\n# Demo02Consumer æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 09:35:54.941  INFO 6894 --- [ntContainer#1-1] c.i.s.l.r.consumer.Demo02Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:19 æ¶ˆæ¯å†…å®¹ï¼šDemo02Message{id=1575941754}]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å†æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSendFailure()")]),e._v(" æ–¹æ³•ï¼Œæ— æ³•åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_02"')]),e._v(" çš„æƒ…å†µã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 09:37:11.353  INFO 7186 --- [           main] c.i.s.l.r.producer.Demo02ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575941831] å‘é€æˆåŠŸ]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚å› ä¸º æ— æ³•åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_02"')]),e._v(" ï¼Œè‡ªç„¶ Demo02Consumer æ— æ³•è¿›è¡Œæ¶ˆè´¹ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_3-3-fanout-exchange"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-fanout-exchange"}},[e._v("#")]),e._v(" 3.3 Fanout Exchange")]),e._v(" "),r("p",[e._v("Fanout Exchange è·¯ç”±è§„åˆ™éå¸¸ç®€å•ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰å‘é€åˆ°è¯¥ Exchange çš„æ¶ˆæ¯è·¯ç”±åˆ°æ‰€æœ‰ä¸å®ƒç»‘å®šçš„ Queue ä¸­ã€‚å¦‚ä¸‹å›¾ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/203b64e17bd9e398cf619acb5df98e6b.jpg",alt:""}})]),e._v(" "),r("ul",[r("li",[e._v("ç”Ÿäº§è€…ï¼ˆPï¼‰å‘é€åˆ° Exchangeï¼ˆXï¼‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè·¯ç”±åˆ°å›¾ä¸­çš„ä¸¤ä¸ª Queueï¼Œå¹¶æœ€ç»ˆè¢«ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ˆC1 ä¸ C2ï¼‰æ¶ˆè´¹ã€‚")]),e._v(" "),r("li",[e._v("æ€»ç»“æ¥è¯´ï¼ŒæŒ‡å®š Exchange ï¼Œä¼šè·¯ç”±åˆ°"),r("strong",[e._v("å¤šä¸ª")]),e._v("ç»‘å®šçš„ Queue ä¸­ã€‚")])]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Fanout Exchange çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œç»§ç»­åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-3-1-demo03message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-demo03message"}},[e._v("#")]),e._v(" 3.3.1 Demo03Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo03Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo03Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo03Message.java\n\npublic class Demo03Message implements Serializable {\n\n    public static final String QUEUE_A = "QUEUE_DEMO_03_A";\n    public static final String QUEUE_B = "QUEUE_DEMO_03_B";\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_03";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("æˆ‘ä»¬"),r("strong",[e._v("æœª")]),e._v("å®šæ„æ€ RoutingKey çš„åå­—ã€‚å› ä¸ºï¼ŒFanout Exchange ä»…éœ€è¦ Exchange å³å¯ã€‚")]),e._v(" "),r("li",[e._v("æˆ‘ä»¬å®šä¹‰"),r("strong",[e._v("ä¸¤ä¸ª")]),e._v(" Queue çš„åå­—ã€‚å› ä¸ºï¼Œæˆ‘ä»¬è¦æµ‹è¯• Fanout Exchange æŠ•é€’åˆ°å¤šä¸ª Queue çš„æ•ˆæœã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-3-2-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-rabbitconfig"}},[e._v("#")]),e._v(" 3.3.2 RabbitConfig")]),e._v(" "),r("p",[e._v("ä¿®æ”¹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ  Fanout Exchange ç¤ºä¾‹ç›¸å…³çš„ Exchangeã€Queueã€Binding çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n/**\n * Fanout Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n */\npublic static class FanoutExchangeDemoConfiguration {\n\n    // åˆ›å»º Queue A\n    @Bean\n    public Queue demo03QueueA() {\n        return new Queue(Demo03Message.QUEUE_A, // Queue åå­—\n                true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                false, // exclusive: æ˜¯å¦æ’å®ƒ\n                false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n    }\n\n    // åˆ›å»º Queue B\n    @Bean\n    public Queue demo03QueueB() {\n        return new Queue(Demo03Message.QUEUE_B, // Queue åå­—\n                true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                false, // exclusive: æ˜¯å¦æ’å®ƒ\n                false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n    }\n\n    // åˆ›å»º Fanout Exchange\n    @Bean\n    public FanoutExchange demo03Exchange() {\n        return new FanoutExchange(Demo03Message.EXCHANGE,\n                true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                false);  // exclusive: æ˜¯å¦æ’å®ƒ\n    }\n\n    // åˆ›å»º Binding A\n    // Exchangeï¼šDemo03Message.EXCHANGE\n    // Queueï¼šDemo03Message.QUEUE_A\n    @Bean\n    public Binding demo03BindingA() {\n        return BindingBuilder.bind(demo03QueueA()).to(demo03Exchange());\n    }\n\n    // åˆ›å»º Binding B\n    // Exchangeï¼šDemo03Message.EXCHANGE\n    // Queueï¼šDemo03Message.QUEUE_B\n    @Bean\n    public Binding demo03BindingB() {\n        return BindingBuilder.bind(demo03QueueB()).to(demo03Exchange());\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("åœ¨ FanoutExchangeDemoConfiguration å†…éƒ¨é™æ€ç±»ä¸­ï¼Œæˆ‘ä»¬"),r("strong",[e._v("ä¹Ÿæ˜¯")]),e._v("åˆ›å»ºäº† Exchangeã€Queueã€Binding ä¸‰ä¸ª Bean ã€‚æœ‰å·®å¼‚ç‚¹çš„æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/FanoutExchange.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("FanoutExchange"),r("OutboundLink")],1),e._v(" ã€‚")]),e._v(" "),r("li",[e._v("åŒæ—¶ï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠ•é€’åˆ°ä¸¤ä¸ª Queue ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ª Binding ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-3-3-demo03producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-demo03producer"}},[e._v("#")]),e._v(" 3.3.3 Demo03Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo03Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo03Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo03Producer.java\n\n@Component\npublic class Demo03Producer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id) {\n        // åˆ›å»º Demo03Message æ¶ˆæ¯\n        Demo03Message message = new Demo03Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo03Message.EXCHANGE, null, message);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("çš„ "),r("code",[e._v("#syncSend(Integer id)")]),e._v(" æ–¹æ³•å¤§ä½“ç›¸ä¼¼ï¼Œå·®å¼‚ç‚¹åœ¨äºä¼ å…¥ "),r("code",[e._v("routingKey = null")]),e._v(" ï¼Œå› ä¸ºä¸éœ€è¦ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-3-4-demo03consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-demo03consumer"}},[e._v("#")]),e._v(" 3.3.4 Demo03Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo03ConsumerA.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo03ConsumerA"),r("OutboundLink")],1),e._v(" å’Œ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo03ConsumerB.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo03ConsumerB"),r("OutboundLink")],1),e._v(" "),r("strong",[e._v("ä¸¤ä¸ª")]),e._v("ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo03ConsumerA.java\n@Component\n@RabbitListener(queues = Demo03Message.QUEUE_A)\npublic class Demo03ConsumerA {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo03Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n\n// Demo03ConsumerB.java\n@Component\n@RabbitListener(queues = Demo03Message.QUEUE_B)\npublic class Demo03ConsumerB {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo03Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œåˆ†åˆ«æ¶ˆè´¹ "),r("code",[e._v('"QUEUE_DEMO_03_A"')]),e._v("ã€"),r("code",[e._v('"QUEUE_DEMO_03_B"')]),e._v(" é˜Ÿåˆ—ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-3-5-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-5-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 3.3.5 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo03ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo03ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo03Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo03ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo03ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo03Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("p",[e._v("æˆ‘ä»¬å…ˆæ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" æ–¹æ³•ï¼Œç¡®è®¤ä¸‹ Fanout Exchange çš„æ•ˆæœã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 13:42:51.794  INFO 50616 --- [           main] c.i.s.l.r.producer.Demo03ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575956571] å‘é€æˆåŠŸ]\n\n# Demo03ConsumerA æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 13:42:51.811  INFO 50616 --- [ntContainer#2-1] c.i.s.l.r.consumer.Demo03ConsumerA       : [onMessage][çº¿ç¨‹ç¼–å·:22 æ¶ˆæ¯å†…å®¹ï¼šDemo03Message{id=1575956571}]\n\n# Demo03ConsumerB ä¹ŸæˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 13:42:51.811  INFO 50616 --- [ntContainer#3-1] c.i.s.l.r.consumer.Demo03ConsumerB       : [onMessage][çº¿ç¨‹ç¼–å·:24 æ¶ˆæ¯å†…å®¹ï¼šDemo03Message{id=1575956571}]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚")]),e._v(" "),r("li",[e._v("å‘é€çš„æ¶ˆæ¯ï¼ŒæˆåŠŸæŠ•é€’åˆ°äº†ä¸¤ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥è¢«ä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½æ¶ˆè´¹åˆ°äº†ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_3-4-headers-exchange"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-headers-exchange"}},[e._v("#")]),e._v(" 3.4 Headers Exchange")]),e._v(" "),r("p",[e._v("Headers Exchange ä¸ä¾èµ–äº routing key ä¸ binding key çš„åŒ¹é…è§„åˆ™æ¥è·¯ç”±æ¶ˆæ¯ï¼Œè€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„ headers å±æ€§è¿›è¡ŒåŒ¹é…ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("åœ¨ç»‘å®š Queue ä¸ Exchange æ—¶æŒ‡å®šä¸€ç»„ headers é”®å€¼å¯¹ã€‚")]),e._v(" "),r("li",[e._v("å½“æ¶ˆæ¯å‘é€åˆ° Exchange æ—¶ï¼ŒRabbitMQ ä¼šå–åˆ°è¯¥æ¶ˆæ¯çš„ headersï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„å½¢å¼ï¼‰ï¼Œå¯¹æ¯”å…¶ä¸­çš„é”®å€¼å¯¹æ˜¯å¦å®Œå…¨åŒ¹é… Queue ä¸ Exchange ç»‘å®šæ—¶æŒ‡å®šçš„é”®å€¼å¯¹ï¼›å¦‚æœå®Œå…¨åŒ¹é…åˆ™æ¶ˆæ¯ä¼šè·¯ç”±åˆ°è¯¥ Queue ï¼Œå¦åˆ™ä¸ä¼šè·¯ç”±åˆ°è¯¥ Queue ã€‚")])]),e._v(" "),r("p",[e._v("ä¸è¿‡è‰¿è‰¿åœ¨æŸ¥è¯¢èµ„æ–™çš„æ—¶å€™ï¼Œæœ‰èµ„æ–™è¯´ Headers Exchange æ€§èƒ½å¾ˆå·®ï¼Œå®é™…åœºæ™¯ä¹Ÿä½¿ç”¨æ¯”è¾ƒå°‘ã€‚æ‰€ä»¥æœ¬å°èŠ‚çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥é€‰æ‹©æ€§çœ‹ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Headers Exchange çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œç»§ç»­åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-4-1-demo04message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-demo04message"}},[e._v("#")]),e._v(" 3.4.1 Demo04Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo04Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo04Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo03Message.java\n\npublic class Demo04Message implements Serializable {\n\n    public static final String QUEUE = "QUEUE_DEMO_04_A";\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_04";\n\n    public static final String HEADER_KEY = "color";\n    public static final String HEADER_VALUE = "red";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("æˆ‘ä»¬"),r("strong",[e._v("æœª")]),e._v("å®šæ„æ€ RoutingKey çš„åå­—ã€‚å› ä¸ºï¼ŒHeaders Exchange æ˜¯é€šè¿‡ Exchange + Headers çš„ç»„åˆã€‚")]),e._v(" "),r("li",[e._v("æˆ‘ä»¬å®šä¹‰"),r("strong",[e._v("ä¸€ä¸ª")]),e._v(" Headers é”®å€¼å¯¹ï¼Œ"),r("code",[e._v("color = red")]),e._v(" ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-4-2-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-rabbitconfig"}},[e._v("#")]),e._v(" 3.4.2 RabbitConfig")]),e._v(" "),r("p",[e._v("ä¿®æ”¹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ  Headers Exchange ç¤ºä¾‹ç›¸å…³çš„ Exchangeã€Queueã€Binding çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n/**\n * Headers Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n */\npublic static class HeadersExchangeDemoConfiguration {\n\n    // åˆ›å»º Queue\n    @Bean\n    public Queue demo04Queue() {\n        return new Queue(Demo04Message.QUEUE, // Queue åå­—\n                true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                false, // exclusive: æ˜¯å¦æ’å®ƒ\n                false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n    }\n\n    // åˆ›å»º Headers Exchange\n    @Bean\n    public HeadersExchange demo04Exchange() {\n        return new HeadersExchange(Demo04Message.EXCHANGE,\n                true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                false);  // exclusive: æ˜¯å¦æ’å®ƒ\n    }\n\n    // åˆ›å»º Binding\n    // Exchangeï¼šDemo04Message.EXCHANGE\n    // Queueï¼šDemo04Message.QUEUE\n    // Headers: Demo04Message.HEADER_KEY + Demo04Message.HEADER_VALUE\n    @Bean\n    public Binding demo4Binding() {\n        return BindingBuilder.bind(demo04Queue()).to(demo04Exchange())\n                .where(Demo04Message.HEADER_KEY).matches(Demo04Message.HEADER_VALUE); // é…ç½® Headers åŒ¹é…\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("åœ¨ TopicExchangeDemoConfiguration å†…éƒ¨é™æ€ç±»ä¸­ï¼Œæˆ‘ä»¬"),r("strong",[e._v("ä¹Ÿæ˜¯")]),e._v("åˆ›å»ºäº† Exchangeã€Queueã€Binding ä¸‰ä¸ª Bean ã€‚æœ‰å·®å¼‚ç‚¹çš„æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/HeadersExchange.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("HeadersExchange"),r("OutboundLink")],1),e._v(" ã€‚")]),e._v(" "),r("li",[e._v("åŒæ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ Binding æ˜¯åŸºäº Headers åŒ¹é…ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-4-3-demo04producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-demo04producer"}},[e._v("#")]),e._v(" 3.4.3 Demo04Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo04Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo04Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo02Producer.java\n\n@Component\npublic class Demo04Producer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id, String headerValue) {\n        // åˆ›å»º MessageProperties å±æ€§\n        MessageProperties messageProperties = new MessageProperties();\n        messageProperties.setHeader(Demo04Message.HEADER_KEY, headerValue); // è®¾ç½® header\n        // åˆ›å»º Message æ¶ˆæ¯\n        Message message = rabbitTemplate.getMessageConverter().toMessage(\n                new Demo04Message().setId(id), messageProperties);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.send(Demo04Message.EXCHANGE, null, message);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("çš„ "),r("code",[e._v("#syncSend(Integer id)")]),e._v(" æ–¹æ³•å¤§ä½“ç›¸ä¼¼ï¼Œå·®å¼‚ç‚¹åœ¨äºæ–°å¢äº†æ–¹æ³•å‚æ•° "),r("code",[e._v("headerValue")]),e._v(" ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¼ å…¥ä¸åŒçš„ Headers å€¼ã€‚")]),e._v(" "),r("li",[e._v("å› ä¸º RabbitTemplate ä¼šæä¾›å¾ˆæ–¹ä¾¿çš„ä¼ é€’ Headers çš„ API æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå¥½è‡ªå·±æ„å»ºï¼Œå½“ç„¶ä¹Ÿæ¯”è¾ƒç®€å•å“ˆã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_3-4-4-demo04consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-4-demo04consumer"}},[e._v("#")]),e._v(" 3.4.4 Demo04Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo04Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo04Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.7 Demo01Consumerã€"),r("OutboundLink")],1),e._v("åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºæ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ "),r("code",[e._v('"QUEUE_DEMO_04"')]),e._v(" ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_3-4-5-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-5-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 3.4.5 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo04ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo04ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸¤ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo04Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo04ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo04ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo04Producer producer;\n\n    @Test\n    public void testSyncSendSuccess() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id, Demo04Message.HEADER_VALUE);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n    @Test\n    public void testSyncSendFailure() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id, "error");\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[r("code",[e._v("#testSyncSendSuccess()")]),e._v(" æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯çš„ Headers çš„å€¼ "),r("code",[e._v('"red"')]),e._v(" ï¼Œå¯ä»¥åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_04"')]),e._v(" ã€‚")]),e._v(" "),r("li",[r("code",[e._v("#testSyncSendFailure()")]),e._v(" æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯çš„ Headers çš„å€¼ "),r("code",[e._v('"error"')]),e._v(" ï¼Œæ— æ³•åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_04"')]),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å…ˆæ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSendSuccess()")]),e._v(" æ–¹æ³•ï¼Œå¯ä»¥åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_04"')]),e._v(" çš„æƒ…å†µã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 14:30:05.872  INFO 61498 --- [           main] c.i.s.l.r.producer.Demo04ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575959405] å‘é€æˆåŠŸ]\n\n# Demo04Consumer æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯\n2019-12-15 14:30:05.888  INFO 61498 --- [ntContainer#4-1] c.i.s.l.r.consumer.Demo04Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:25 æ¶ˆæ¯å†…å®¹ï¼šDemo04Message{id=1575959405}]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å†æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSendFailure()")]),e._v(" æ–¹æ³•ï¼Œæ— æ³•åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_04"')]),e._v(" çš„æƒ…å†µã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 14:30:47.090  INFO 61664 --- [           main] c.i.s.l.r.producer.Demo04ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575959447] å‘é€æˆåŠŸ]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚å› ä¸º æ— æ³•åŒ¹é…åˆ° "),r("code",[e._v('"DEMO_QUEUE_04"')]),e._v(" ï¼Œè‡ªç„¶ Demo04Consumer æ— æ³•è¿›è¡Œæ¶ˆè´¹ã€‚")])]),e._v(" "),r("h1",{attrs:{id:"_4-æ‰¹é‡å‘é€æ¶ˆæ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-æ‰¹é‡å‘é€æ¶ˆæ¯"}},[e._v("#")]),e._v(" 4. æ‰¹é‡å‘é€æ¶ˆæ¯")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch"),r("OutboundLink")],1),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Producer æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œæé«˜å‘é€æ€§èƒ½ã€‚ä¸åŒäºæˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"http://www.iocoder.cn/Spring-Boot/RocketMQ/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹"),r("OutboundLink")],1),e._v(" çš„"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v(" åŠŸèƒ½ï¼ŒRocketMQ æ˜¯æä¾›äº†ä¸€ä¸ªå¯ä»¥æ‰¹é‡å‘é€å¤šæ¡æ¶ˆæ¯çš„ API ã€‚è€Œ Spring-AMQP æä¾›çš„æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/batch/MessageBatch.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MessageBatch"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯æ”¶é›†å™¨ï¼Œå°†å‘é€ç»™"),r("strong",[e._v("ç›¸åŒ Exchange + RoutingKey çš„æ¶ˆæ¯ä»¬")]),e._v("ï¼Œâ€œ"),r("strong",[e._v("å·å·")]),e._v("â€æ”¶é›†åœ¨ä¸€èµ·ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶å€™ï¼Œä¸€æ¬¡æ€§æ‰¹é‡å‘é€æäº¤ç»™ RabbitMQ Broker ã€‚")]),e._v(" "),r("p",[e._v("Spring-AMQP é€šè¿‡ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/BatchingRabbitTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BatchingRabbitTemplate"),r("OutboundLink")],1),e._v(" æä¾›æ‰¹é‡å‘é€æ¶ˆæ¯çš„åŠŸèƒ½ã€‚å¦‚ä¸‹æ˜¯ä¸‰ä¸ªæ¡ä»¶ï¼Œæ»¡è¶³"),r("strong",[e._v("ä»»ä¸€")]),e._v("å³ä¼šæ‰¹é‡å‘é€ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("ã€æ•°é‡ã€‘"),r("code",[e._v("batchSize")]),e._v(" ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯æ•°é‡çš„æœ€å¤§æ¡æ•°ã€‚")]),e._v(" "),r("li",[e._v("ã€ç©ºé—´ã€‘"),r("code",[e._v("bufferLimit")]),e._v(" ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯å ç”¨çš„æœ€å¤§å†…å­˜ã€‚")]),e._v(" "),r("li",[e._v("ã€æ—¶é—´ã€‘"),r("code",[e._v("timeout")]),e._v(" ï¼šè¶…è¿‡æ”¶é›†çš„æ—¶é—´çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚ğŸ˜ˆ ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™é‡Œçš„è¶…æ—¶å¼€å§‹è®¡æ—¶çš„æ—¶é—´ï¼Œæ˜¯"),r("strong",[e._v("ä»¥æœ€åä¸€æ¬¡å‘é€æ—¶é—´ä¸ºèµ·ç‚¹")]),e._v("ã€‚ä¹Ÿå°±è¯´ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å‘é€æ¶ˆæ¯ï¼Œéƒ½ä»¥å½“å‰æ—¶åˆ»å¼€å§‹è®¡æ—¶ï¼Œé‡æ–°åˆ°è¾¾ "),r("code",[e._v("timeout")]),e._v(" æ¯«ç§’æ‰ç®—è¶…æ—¶ã€‚")])]),e._v(" "),r("p",[e._v("å¦å¤–ï¼ŒBatchingRabbitTemplate æä¾›çš„æ‰¹é‡å‘é€æ¶ˆæ¯çš„èƒ½åŠ›"),r("strong",[e._v("æ¯”è¾ƒå¼±")]),e._v("ã€‚å¯¹äºåŒä¸€ä¸ª BatchingRabbitTemplate å¯¹è±¡æ¥è¯´ï¼Œ"),r("strong",[e._v("åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ‰¹æ¬¡(ä¿è¯ Exchange + RoutingKey ç›¸åŒ)")]),e._v("ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Producer æ‰¹é‡å‘é€æ¶ˆæ¯çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3. å¿«é€Ÿå…¥é—¨ã€"),r("OutboundLink")],1),e._v(" çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_4-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 4.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_4-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 4.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_4-3-demo05message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-demo05message"}},[e._v("#")]),e._v(" 4.3 Demo05Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo05Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_4-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-rabbitconfig"}},[e._v("#")]),e._v(" 4.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ  BatchingRabbitTemplate çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo05Queue() {\n            return new Queue(Demo05Message.QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo05Exchange() {\n            return new DirectExchange(Demo05Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo05Message.EXCHANGE\n        // Routing keyï¼šDemo05Message.ROUTING_KEY\n        // Queueï¼šDemo05Message.QUEUE\n        @Bean\n        public Binding demo05Binding() {\n            return BindingBuilder.bind(demo05Queue()).to(demo05Exchange()).with(Demo05Message.ROUTING_KEY);\n        }\n\n    }\n\n    @Bean\n    public BatchingRabbitTemplate batchRabbitTemplate(ConnectionFactory connectionFactory) {\n        // åˆ›å»º BatchingStrategy å¯¹è±¡ï¼Œä»£è¡¨æ‰¹é‡ç­–ç•¥\n        int batchSize = 16384; // è¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯æ•°é‡çš„æœ€å¤§æ¡æ•°ã€‚\n        int bufferLimit = 33554432; // æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§å†…å­˜\n        int timeout = 30000; // è¶…è¿‡æ”¶é›†çš„æ—¶é—´çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’\n        BatchingStrategy batchingStrategy = new SimpleBatchingStrategy(batchSize, bufferLimit, timeout);\n\n        // åˆ›å»º TaskScheduler å¯¹è±¡ï¼Œç”¨äºå®ç°è¶…æ—¶å‘é€çš„å®šæ—¶å™¨\n        TaskScheduler taskScheduler = new ConcurrentTaskScheduler();\n\n        // åˆ›å»º BatchingRabbitTemplate å¯¹è±¡\n        BatchingRabbitTemplate batchTemplate = new BatchingRabbitTemplate(batchingStrategy, taskScheduler);\n        batchTemplate.setConnectionFactory(connectionFactory);\n        return batchTemplate;\n    }\n\n}\n")])])]),r("ul",[r("li",[r("p",[e._v("DirectExchangeDemoConfiguration é…ç½®ç±»ï¼Œç”¨äºå®šä¹‰ Queueã€Exchangeã€Binding çš„é…ç½®ã€‚")])]),e._v(" "),r("li",[r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("#batchRabbitTemplate(ConnectionFactory connectionFactory)\n")])])]),r("p",[e._v("æ–¹æ³•ï¼Œåˆ›å»º BatchingRabbitTemplate Bean å¯¹è±¡ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("å…·ä½“çš„ "),r("code",[e._v("batchSize")]),e._v("ã€"),r("code",[e._v("bufferLimit")]),e._v("ã€"),r("code",[e._v("timeout")]),e._v(" æ•°å€¼é…ç½®å¤šå°‘ï¼Œæ ¹æ®è‡ªå·±çš„åº”ç”¨æ¥ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ•…æ„å°† "),r("code",[e._v("timeout")]),e._v(" é…ç½®æˆäº† 30 ç§’ï¼Œä¸»è¦ä¸ºäº†æ¼”ç¤ºä¹‹ç”¨ã€‚")]),e._v(" "),r("li",[e._v("åˆ›å»º BatchingRabbitTemplate å¯¹è±¡çš„ä»£ç ï¼Œè‰¿è‰¿å·²ç»æ·»åŠ æ³¨é‡Šï¼Œå¯ä»¥è‡ªå·±é˜…è¯»ç†è§£ä¸‹å™¢ã€‚")])])])]),e._v(" "),r("h2",{attrs:{id:"_4-5-demo05producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-demo05producer"}},[e._v("#")]),e._v(" 4.5 Demo05Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo05Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ BatchingRabbitTemplate ï¼Œå®ç°æ‰¹é‡å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo05Producer.java\n\n@Component\npublic class Demo05Producer {\n\n    @Autowired\n    private BatchingRabbitTemplate batchingRabbitTemplate;\n\n    public void syncSend(Integer id) {\n        // åˆ›å»º Demo05Message æ¶ˆæ¯\n        Demo05Message message = new Demo05Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        batchingRabbitTemplate.convertAndSend(Demo05Message.EXCHANGE, Demo05Message.ROUTING_KEY, message);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("çœ‹èµ·æ¥å’Œæˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("æä¾›çš„å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œé™¤äº†æ¢æˆäº† BatchingRabbitTemplate æ¥å‘é€æ¶ˆæ¯ï¼Œå…¶å®ƒéƒ½æ˜¯ä¸€è‡´çš„ã€‚ğŸ˜ˆ å¯¹çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè‰¿è‰¿åœ¨ä¸Šæ–‡è¯´åˆ°ï¼ŒSpring-AMQP æ˜¯â€œ"),r("strong",[e._v("å·å·")]),e._v("â€æ”¶é›†æ¥å®ç°æ‰¹é‡å‘é€ï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¿˜æ˜¯ä¸€è‡´çš„ã€‚")])]),e._v(" "),r("p",[e._v("BatchingRabbitTemplate é€šè¿‡é‡å†™ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/BatchingRabbitTemplate.java#L76-L99",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("#send(String exchange, String routingKey, Message message, CorrelationData correlationData)")]),r("OutboundLink")],1),e._v(" "),r("strong",[e._v("æ ¸å¿ƒ")]),e._v("æ–¹æ³•ï¼Œå®ç°æ‰¹é‡å‘é€çš„åŠŸèƒ½ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥è‡ªå·±å»ç ”ç©¶ä¸‹æºç ï¼Œä¸å¤æ‚å“ˆ~")]),e._v(" "),r("h2",{attrs:{id:"_4-6-demo05consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-demo05consumer"}},[e._v("#")]),e._v(" 4.6 Demo05Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo05Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo05Consumer.java\n\n@Component\n@RabbitListener(queues = Demo05Message.QUEUE)\npublic class Demo05Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo05Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.7 Demo01Consumerã€"),r("OutboundLink")],1),e._v("åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºæ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ "),r("code",[e._v('"QUEUE_DEMO_02"')]),e._v(" ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_4-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 4.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo05ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯• Producer æ‰¹é‡å‘é€æ¶ˆæ¯çš„æ•ˆæœã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo05ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo05ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo05Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        for (int i = 0; i < 3; i++) {\n            // åŒæ­¥å‘é€æ¶ˆæ¯\n            int id = (int) (System.currentTimeMillis() / 1000);\n            producer.syncSend(id);\n\n            // æ•…æ„æ¯æ¡æ¶ˆæ¯ä¹‹é—´ï¼Œéš”ç¦» 10 ç§’\n            logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n            Thread.sleep(10 * 1000L);\n        }\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åŒæ­¥å‘é€ä¸‰æ¡æ¶ˆæ¯ï¼Œæ¯æ¬¡å‘é€æ¶ˆæ¯ä¹‹é—´ï¼Œéƒ½æ•…æ„ sleep 10 ç§’ã€‚ğŸ˜ˆ ç›®çš„æ˜¯ï¼Œæ°å¥½æ»¡è¶³æˆ‘ä»¬é…ç½®çš„ "),r("code",[e._v("timeout")]),e._v(" æœ€å¤§ç­‰å¾…æ—¶é•¿ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æ¥æ‰§è¡Œ "),r("code",[e._v("#testASyncSend()")]),e._v(" æ–¹æ³•ï¼Œæµ‹è¯•æ‰¹é‡å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer æˆåŠŸåŒæ­¥å‘é€äº† 3 æ¡æ¶ˆæ¯ï¼Œæ¯æ¡é—´éš” 10 ç§’ã€‚\n2019-12-15 16:50:15.419  INFO 94085 --- [           main] c.i.s.l.r.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575967815] å‘é€æˆåŠŸ]\n2019-12-15 16:50:25.426  INFO 94085 --- [           main] c.i.s.l.r.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575967825] å‘é€æˆåŠŸ]\n2019-12-15 16:50:35.427  INFO 94085 --- [           main] c.i.s.l.r.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575967835] å‘é€æˆåŠŸ]\n\n// Demo05Consumer åœ¨æœ€åä¸€æ¡æ¶ˆæ¯å‘é€æˆåŠŸåæœçš„ 30 ç§’ï¼Œæ¶ˆè´¹åˆ°è¿™ 3 æ¡æ¶ˆæ¯ã€‚\n2019-12-15 16:51:05.449  INFO 94085 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo05Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo05Message{id=1575967815}]\n2019-12-15 16:51:05.450  INFO 94085 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo05Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo05Message{id=1575967825}]\n2019-12-15 16:51:05.450  INFO 94085 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo05Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo05Message{id=1575967835}]\n")])])]),r("ul",[r("li",[e._v("å› ä¸ºä½¿ç”¨ BatchingRabbitTemplate æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥åœ¨ Producer æˆåŠŸå‘é€å®Œç¬¬ä¸€æ¡æ¶ˆæ¯åï¼ŒConsumer å¹¶æœªæ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("åˆå› ä¸º BatchingRabbitTemplate æ˜¯æŒ‰ç…§æ¯æ¬¡å‘é€åï¼Œéƒ½é‡æ–°è®¡æ—¶ï¼Œæ‰€ä»¥åœ¨æœ€åä¸€æ¡æ¶ˆæ¯æˆåŠŸå‘é€åçš„ 30 ç§’ï¼ŒConsumer æ‰æ¶ˆè´¹åˆ°æ‰¹é‡å‘é€çš„ 3 æ¡æ¶ˆæ¯ã€‚")])]),e._v(" "),r("h1",{attrs:{id:"_5-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"}},[e._v("#")]),e._v(" 5. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch-consume"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v("å°èŠ‚ï¼Œæˆ‘ä»¬å·²ç»å®ç°æ‰¹é‡å‘é€æ¶ˆæ¯åˆ° RabbitMQ Broker ä¸­ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œè¿™æ‰¹æ¶ˆæ¯åœ¨ RabbitMQ Broker åˆ°åº•æ˜¯å­˜å‚¨"),r("strong",[e._v("ä¸€æ¡")]),e._v("æ¶ˆæ¯ï¼Œè¿˜æ˜¯"),r("strong",[e._v("å¤šæ¡")]),e._v("æ¶ˆæ¯ï¼Ÿ")]),e._v(" "),r("ul",[r("li",[e._v("å¦‚æœèƒ–å‹ä½¿ç”¨è¿‡ Kafkaã€RocketMQ è¿™ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‚£ä¹ˆåˆ¤æ–­è‚¯å®šä¼šæ˜¯"),r("strong",[e._v("å¤šæ¡")]),e._v("æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("ä»"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4.6 Demo05Consumerã€"),r("OutboundLink")],1),e._v("ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°"),r("strong",[e._v("é€æ¡")]),e._v("æ¶ˆæ¯çš„æ¶ˆè´¹ï¼Œä¹Ÿä¼šè®¤ä¸ºæ˜¯"),r("strong",[e._v("å¤šæ¡")]),e._v("æ¶ˆæ¯ã€‚")])]),e._v(" "),r("p",[e._v("ğŸ˜­ å®é™…ä¸Šï¼ŒRabbitMQ Broker å­˜å‚¨çš„æ˜¯"),r("strong",[e._v("ä¸€æ¡")]),e._v("æ¶ˆæ¯ã€‚åˆæˆ–è€…è¯´ï¼Œ"),r("strong",[e._v("RabbitMQ å¹¶æ²¡æœ‰æä¾›æ‰¹é‡æ¥æ”¶æ¶ˆæ¯çš„ API æ¥å£")]),e._v("ã€‚")]),e._v(" "),r("p",[e._v("é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v("èƒ½å¤Ÿå®ç°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ‰¹é‡å‘é€æ¶ˆæ¯æ˜¯ Spring-AMQP çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/batch/SimpleBatchingStrategy.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleBatchingStrategy"),r("OutboundLink")],1),e._v(" æ‰€å°è£…æä¾›ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("åœ¨ Producer æœ€ç»ˆæ‰¹é‡å‘é€æ¶ˆæ¯æ—¶ï¼ŒSimpleBatchingStrategy ä¼šé€šè¿‡ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/batch/SimpleBatchingStrategy.java#L141-L156",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("#assembleMessage()")]),r("OutboundLink")],1),e._v(" æ–¹æ³•ï¼Œå°†æ‰¹é‡å‘é€çš„"),r("strong",[e._v("å¤šæ¡")]),e._v("æ¶ˆæ¯"),r("strong",[e._v("ç»„è£…")]),e._v("æˆä¸€æ¡â€œæ‰¹é‡â€æ¶ˆæ¯ï¼Œç„¶åè¿›è¡Œå‘é€ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ Consumer æ‹‰å–åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šæ ¹æ®"),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/batch/SimpleBatchingStrategy.java#L158-L163",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("#canDebatch(MessageProperties properties)")]),r("OutboundLink")],1),e._v(" æ–¹æ³•ï¼Œåˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦ä¸ºä¸€æ¡â€œæ‰¹é‡â€æ¶ˆæ¯ï¼Ÿå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨"),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/batch/SimpleBatchingStrategy.java#L165-L194",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("# deBatch(Message message, Consumer fragmentConsumer)")]),r("OutboundLink")],1),e._v(" æ–¹æ³•ï¼Œå°†ä¸€æ¡â€œæ‰¹é‡â€æ¶ˆæ¯"),r("strong",[e._v("æ‹†å¼€")]),e._v("ï¼Œå˜æˆ"),r("strong",[e._v("å¤šæ¡")]),e._v("æ¶ˆæ¯ã€‚")])]),e._v(" "),r("blockquote",[r("p",[e._v("è¿™ä¸ªæ“ä½œï¼Œæ˜¯ä¸æ˜¯ç•¥å¾®æœ‰ç‚¹éªšæ°”ï¼Ÿï¼è‰¿è‰¿åœ¨è¿™é‡Œå¡äº†å¾ˆä¹…ï¼ï¼ï¼è«åå…¶å¦™çš„~ä¸€ç›´ä»¥ä¸ºï¼ŒRabbitMQ æä¾›äº†æ‰¹é‡å‘é€æ¶ˆæ¯çš„ API æ¥å£å•Šã€‚")]),e._v(" "),r("p",[e._v("OK ï¼Œè™½ç„¶å¾ˆæ‚²ä¼¤ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å›åˆ°è¿™ä¸ªå°èŠ‚çš„ä¸»é¢˜ã€‚")])]),e._v(" "),r("p",[e._v("åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ã€‚åœ¨ Spring-AMQP ä¸­ï¼Œæä¾›äº†ä¸¤ç§æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹å¼ã€‚æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç§ï¼Œå®ƒéœ€è¦åŸºäº"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v("ä¹‹ä¸Šå®ç°ã€‚")]),e._v(" "),r("p",[e._v("åœ¨ SimpleBatchingStrategy å°†ä¸€æ¡â€œæ‰¹é‡â€æ¶ˆæ¯æ‹†å¼€ï¼Œå˜æˆå¤šæ¡æ¶ˆæ¯åï¼Œç›´æ¥"),r("strong",[e._v("æ‰¹é‡")]),e._v("äº¤ç»™ Consumer è¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v(" çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch"),r("OutboundLink")],1),e._v(" é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch-consume"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~")]),e._v(" "),r("h2",{attrs:{id:"_5-1-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-rabbitconfig"}},[e._v("#")]),e._v(" 5.1 RabbitConfig")]),e._v(" "),r("p",[e._v("ä¿®æ”¹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/config/SimpleRabbitListenerContainerFactory.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleRabbitListenerContainerFactory"),r("OutboundLink")],1),e._v(" Bean ï¼Œæ”¯æŒç”¨äºåˆ›å»º"),r("strong",[e._v("æ”¯æŒæ‰¹é‡æ¶ˆè´¹")]),e._v("çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleRabbitListenerContainer"),r("OutboundLink")],1),e._v(" ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// RabbitConfig.java\n\n@Bean(name = "consumerBatchContainerFactory")\npublic SimpleRabbitListenerContainerFactory consumerBatchContainerFactory(\n        SimpleRabbitListenerContainerFactoryConfigurer configurer, ConnectionFactory connectionFactory) {\n    // åˆ›å»º SimpleRabbitListenerContainerFactory å¯¹è±¡\n    SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n    configurer.configure(factory, connectionFactory);\n    // <X> é¢å¤–æ·»åŠ æ‰¹é‡æ¶ˆè´¹çš„å±æ€§\n    factory.setBatchListener(true);\n    return factory;\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitAnnotationDrivenConfiguration.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitAnnotationDrivenConfiguration"),r("OutboundLink")],1),e._v(" è‡ªåŠ¨åŒ–é…ç½®ç±»ä¸­ï¼Œå®ƒä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªåå­—ä¸º "),r("code",[e._v('"rabbitListenerContainerFactory"')]),e._v(" çš„ SimpleRabbitListenerContainerFactory Bean ï¼Œå¯ç”¨äºæ¶ˆè´¹è€…çš„ç›‘å¬å™¨æ˜¯"),r("strong",[e._v("å•ä¸ª")]),e._v("æ¶ˆè´¹æ¶ˆè´¹çš„ã€‚")]),e._v(" "),r("li",[e._v("æˆ‘ä»¬è‡ªå®šä¹‰åˆ›å»ºçš„ä¸€ä¸ªåå­—ä¸º"),r("code",[e._v('"consumerBatchContainerFactory"')]),e._v(" çš„ SimpleRabbitListenerContainerFactory Bean ï¼Œå¯ç”¨äºæ¶ˆè´¹è€…çš„ç›‘å¬å™¨æ˜¯"),r("strong",[e._v("æ‰¹é‡")]),e._v("æ¶ˆè´¹æ¶ˆè´¹çš„ã€‚é‡ç‚¹æ˜¯ "),r("code",[e._v("<X>")]),e._v(" å¤„ï¼Œé…ç½®æ¶ˆè´¹è€…çš„ç›‘å¬å™¨æ˜¯"),r("strong",[e._v("æ‰¹é‡")]),e._v("æ¶ˆè´¹æ¶ˆæ¯çš„ç±»å‹ï¼Œå…¶å®ƒçš„å¯ä»¥æš‚æ—¶ä¸ç”¨ç†è§£ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_5-2-demo05consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-demo05consumer"}},[e._v("#")]),e._v(" 5.2 Demo05Consumer")]),e._v(" "),r("p",[e._v("ä¿®æ”¹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo05Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œ"),r("strong",[e._v("æ‰¹é‡")]),e._v("æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo05Consumer.java\n\n@Component\n@RabbitListener(queues = Demo05Message.QUEUE,\n    containerFactory = "consumerBatchContainerFactory")\npublic class Demo05Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(List<Demo05Message> messages) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯æ•°é‡ï¼š{}]", Thread.currentThread().getId(), messages.size());\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ç±»ä¸Šçš„ "),r("code",[e._v("@@RabbitListener")]),e._v(" æ³¨è§£çš„ "),r("code",[e._v("containerFactory")]),e._v(" å±æ€§ï¼Œè®¾ç½®äº†æˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ5.1 RabbitConfigã€"),r("OutboundLink")],1),e._v("åˆ›å»ºçš„ SimpleRabbitListenerContainerFactory Bean ï¼Œè¡¨ç¤ºå®ƒè¦æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ "),r("code",[e._v("#onMessage(...)")]),e._v(" æ¶ˆè´¹æ–¹æ³•ä¸Šï¼Œä¿®æ”¹æ–¹æ³•å…¥å‚çš„ç±»å‹ä¸º List æ•°ç»„ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_5-3-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 5.3 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4.7 ç®€å•æµ‹è¯•ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo05ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05ProducerTest"),r("OutboundLink")],1),e._v(" å•å…ƒæµ‹è¯•ç±»ã€‚")]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æ¥æ‰§è¡Œ "),r("code",[e._v("#testASyncSend()")]),e._v(" æ–¹æ³•ï¼Œæµ‹è¯•æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer æˆåŠŸåŒæ­¥å‘é€äº† 3 æ¡æ¶ˆæ¯ï¼Œæ¯æ¡é—´éš” 10 ç§’ã€‚\n2019-12-15 22:42:08.755  INFO 60216 --- [           main] c.i.s.l.r.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575988928] å‘é€æˆåŠŸ]\n2019-12-15 22:42:18.757  INFO 60216 --- [           main] c.i.s.l.r.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575988938] å‘é€æˆåŠŸ]\n2019-12-15 22:42:28.758  INFO 60216 --- [           main] c.i.s.l.r.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575988948] å‘é€æˆåŠŸ]\n\n// Demo05Consumer åœ¨æœ€åä¸€æ¡æ¶ˆæ¯å‘é€æˆåŠŸåæœçš„ 30 ç§’ï¼Œä¸€æ¬¡æ€§æ‰¹é‡æ¶ˆè´¹äº†è¿™ 3 æ¡æ¶ˆæ¯ã€‚\n2019-12-15 22:42:58.775  INFO 60216 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo05Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯æ•°é‡ï¼š3]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸï¼ŒDemo05Consumer æ‰¹é‡æ¶ˆè´¹äº† 3 æ¡æ¶ˆæ¯ã€‚")])]),e._v(" "),r("h1",{attrs:{id:"_6-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯-ç¬¬äºŒå¼¹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯-ç¬¬äºŒå¼¹"}},[e._v("#")]),e._v(" 6. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼ˆç¬¬äºŒå¼¹ï¼‰")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch-consume-02"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ5. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v("å°èŠ‚ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†ä¸€ç§æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹å¼ã€‚å› ä¸ºå…¶ä¾èµ–"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v("çš„åŠŸèƒ½ï¼Œæœ‰ç‚¹è¿‡äºè‹›åˆ»ã€‚æ‰€ä»¥ï¼ŒSpring-AMQP æä¾›äº†ç¬¬äºŒç§æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹å¼ã€‚")]),e._v(" "),r("p",[e._v("å…¶å®ç°æ–¹å¼æ˜¯ï¼Œé˜»å¡ç­‰å¾…æœ€å¤š "),r("code",[e._v("receiveTimeout")]),e._v(" ç§’ï¼Œæ‹‰å– "),r("code",[e._v("batchSize")]),e._v(" æ¡æ¶ˆæ¯ï¼Œè¿›è¡Œæ‰¹é‡æ¶ˆè´¹ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("å¦‚æœåœ¨ "),r("code",[e._v("receiveTimeout")]),e._v(" ç§’å†…å·²ç»æˆåŠŸæ‹‰å–åˆ° "),r("code",[e._v("batchSize")]),e._v(" æ¡æ¶ˆæ¯ï¼Œåˆ™ç›´æ¥è¿›è¡Œæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚")]),e._v(" "),r("li",[e._v("å¦‚æœåœ¨ "),r("code",[e._v("receiveTimeout")]),e._v(" ç§’è¿˜æ²¡æ‹‰å–åˆ° "),r("code",[e._v("batchSize")]),e._v(" æ¡æ¶ˆæ¯ï¼Œä¸å†ç­‰å¾…ï¼Œè€Œæ˜¯è¿›è¡Œæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚")])]),e._v(" "),r("p",[e._v("ä¸è¿‡ Spring-AMQP çš„é˜»å¡ç­‰å¾…æ—¶é•¿ "),r("code",[e._v("receiveTimeout")]),e._v(" çš„è®¾è®¡æœ‰ç‚¹â€œç¥å¥‡â€ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("å®ƒä»£è¡¨çš„æ˜¯ï¼Œæ¯æ¬¡æ‹‰å–ä¸€æ¡æ¶ˆæ¯ï¼Œæœ€å¤šé˜»å¡ç­‰å¾… "),r("code",[e._v("receiveTimeout")]),e._v(" æ—¶é•¿ã€‚å¦‚æœç­‰å¾…ä¸åˆ°ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œåˆ™è¿›å…¥å·²è·å–åˆ°çš„æ¶ˆæ¯çš„æ‰¹é‡æ¶ˆè´¹ã€‚ğŸ˜ˆ ä¹Ÿå°±æ˜¯è¯´ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ç­‰å¾… "),r("code",[e._v("receiveTimeout * batchSize")]),e._v(" æ—¶é•¿ï¼Œæ‰ä¼šè¿›è¡Œæ‰¹é‡æ¶ˆè´¹ã€‚")]),e._v(" "),r("li",[e._v("æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥ç‚¹å‡» "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.java#L922",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("SimpleMessageListenerContainer#doReceiveAndExecute(BlockingQueueConsumer consumer)")]),r("OutboundLink")],1),e._v(" æ–¹æ³•ï¼Œç®€å•é˜…è¯»æºç ï¼Œå³å¯å¿«é€Ÿç†è§£ã€‚")])]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-batch-consume-02"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_6-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 6.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_6-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 6.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_6-3-demo06message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-demo06message"}},[e._v("#")]),e._v(" 6.3 Demo06Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo06Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo06Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_6-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-rabbitconfig"}},[e._v("#")]),e._v(" 6.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/config/SimpleRabbitListenerContainerFactory.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleRabbitListenerContainerFactory"),r("OutboundLink")],1),e._v(" Bean ï¼Œæ”¯æŒç”¨äºåˆ›å»º"),r("strong",[e._v("æ”¯æŒæ‰¹é‡æ¶ˆè´¹")]),e._v("çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleRabbitListenerContainer"),r("OutboundLink")],1),e._v(" ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// RabbitConfig.java\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo06Queue() {\n            return new Queue(Demo06Message.QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo06Exchange() {\n            return new DirectExchange(Demo06Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo06Message.EXCHANGE\n        // Routing keyï¼šDemo06Message.ROUTING_KEY\n        // Queueï¼šDemo06Message.QUEUE\n        @Bean\n        public Binding demo06Binding() {\n            return BindingBuilder.bind(demo06Queue()).to(demo06Exchange()).with(Demo06Message.ROUTING_KEY);\n        }\n\n    }\n\n    @Bean(name = "consumerBatchContainerFactory")\n    public SimpleRabbitListenerContainerFactory consumerBatchContainerFactory(\n            SimpleRabbitListenerContainerFactoryConfigurer configurer, ConnectionFactory connectionFactory) {\n        // åˆ›å»º SimpleRabbitListenerContainerFactory å¯¹è±¡\n        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n        configurer.configure(factory, connectionFactory);\n        // é¢å¤–æ·»åŠ æ‰¹é‡æ¶ˆè´¹çš„å±æ€§\n        factory.setBatchListener(true);\n        // <X>\n        factory.setBatchSize(10);\n        factory.setReceiveTimeout(30 * 1000L);\n        factory.setConsumerBatchEnabled(true);\n        return factory;\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("DirectExchangeDemoConfiguration é…ç½®ç±»ï¼Œç”¨äºå®šä¹‰ Queueã€Exchangeã€Binding çš„é…ç½®ã€‚")]),e._v(" "),r("li",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ5.1 RabbitConfigã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼Œé¢å¤–å¢åŠ äº† "),r("code",[e._v("batchSize = 10")]),e._v("ã€"),r("code",[e._v("receiveTimeout = 30 * 1000L")]),e._v("ã€"),r("code",[e._v("consumerBatchEnabled = 30 * 1000L")]),e._v(" å±æ€§ã€‚ğŸ˜ˆ ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œ"),r("strong",[e._v("æœ¬å°èŠ‚æ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯")]),e._v("ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_6-5-demo06producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-demo06producer"}},[e._v("#")]),e._v(" 6.5 Demo06Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo06Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo06Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_6-6-demo06consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-demo06consumer"}},[e._v("#")]),e._v(" 6.6 Demo06Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo05Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œ"),r("strong",[e._v("æ‰¹é‡")]),e._v("æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo06Consumer.java\n\n@Component\n@RabbitListener(queues = Demo06Message.QUEUE,\n    containerFactory = "consumerBatchContainerFactory")\npublic class Demo06Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(List<Demo06Message> messages) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯æ•°é‡ï¼š{}]", Thread.currentThread().getId(), messages.size());\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ5.2 Demo05Consumerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªå·®åœ¨æ¶ˆè´¹ä¸åŒçš„é˜Ÿåˆ—ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_6-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 6.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo06ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo06ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯• Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„æ•ˆæœã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo06ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo06ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo06Producer producer;\n\n    @Test\n    public void testSyncSend01() throws InterruptedException {\n        // å‘é€ 3 æ¡æ¶ˆæ¯\n        this.testSyncSend(3);\n    }\n\n    @Test\n    public void testSyncSen02() throws InterruptedException {\n        // å‘é€ 10 æ¡æ¶ˆæ¯\n        this.testSyncSend(10);\n    }\n\n    private void testSyncSend(int n) throws InterruptedException {\n        for (int i = 0; i < n; i++) {\n            // åŒæ­¥å‘é€æ¶ˆæ¯\n            int id = (int) (System.currentTimeMillis() / 1000);\n            producer.syncSend(id);\n            logger.info("[testSyncSendMore][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n        }\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[r("code",[e._v("#testSyncSend01()")]),e._v(" æ–¹æ³•ï¼Œå‘é€ 3 æ¡æ¶ˆæ¯ï¼Œæµ‹è¯• Demo06Consumer è·å–æ•°é‡ä¸º "),r("code",[e._v("batchSize = 10")]),e._v(" æ¶ˆæ¯ï¼Œ"),r("strong",[e._v("è¶…æ—¶")]),e._v("æƒ…å†µä¸‹çš„æ‰¹é‡æ¶ˆè´¹ã€‚")]),e._v(" "),r("li",[r("code",[e._v("#testSyncSend02()")]),e._v(" æ–¹æ³•ï¼Œå‘é€ 10 æ¡æ¶ˆæ¯ï¼Œæµ‹è¯• Demo06Consumer è·å–æ•°é‡ä¸º "),r("code",[e._v("batchSize = 10")]),e._v(" æ¶ˆæ¯ï¼Œ"),r("strong",[e._v("æœªè¶…æ—¶")]),e._v("æƒ…å†µä¸‹çš„æ‰¹é‡æ¶ˆè´¹ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend01()")]),e._v(" æ–¹æ³•ï¼Œ"),r("strong",[e._v("è¶…æ—¶")]),e._v("æƒ…å†µä¸‹çš„æ‰¹é‡æ¶ˆè´¹ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer æˆåŠŸåŒæ­¥å‘é€äº† 3 æ¡æ¶ˆæ¯\n2019-12-15 00:01:18.097  INFO 78389 --- [           main] c.i.s.l.r.producer.Demo06ProducerTest    : [testSyncSendMore][å‘é€ç¼–å·ï¼š[1575993678] å‘é€æˆåŠŸ]\n2019-12-15 00:01:18.099  INFO 78389 --- [           main] c.i.s.l.r.producer.Demo06ProducerTest    : [testSyncSendMore][å‘é€ç¼–å·ï¼š[1575993678] å‘é€æˆåŠŸ]\n2019-12-15 00:01:18.099  INFO 78389 --- [           main] c.i.s.l.r.producer.Demo06ProducerTest    : [testSyncSendMore][å‘é€ç¼–å·ï¼š[1575993678] å‘é€æˆåŠŸ]\n\n// Consumer 30 ç§’è¶…æ—¶ç­‰å¾…åï¼Œæ‰¹é‡æ¶ˆè´¹åˆ° 3 æ¡æ¶ˆæ¯\n2019-12-15 00:01:48.116  INFO 78389 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯æ•°é‡ï¼š3]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚å…·ä½“èƒ–å‹çœ‹ä¸‹æ—¥å¿—ä¸Šçš„æ³¨é‡Šè¯´æ˜ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend02()")]),e._v(" æ–¹æ³•ï¼Œ"),r("strong",[e._v("æœªè¶…æ—¶")]),e._v("æƒ…å†µä¸‹çš„æ‰¹é‡æ¶ˆè´¹ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer æˆåŠŸåŒæ­¥å‘é€äº† 10 æ¡æ¶ˆæ¯\n2019-12-15 00:03:50.406  INFO 78997 --- [           main] c.i.s.l.r.producer.Demo06ProducerTest    : [testSyncSendMore][å‘é€ç¼–å·ï¼š[1575993830] å‘é€æˆåŠŸ]\n// ... çœç•¥ 8 æ¡æ¶ˆæ¯\n2019-12-15 00:03:50.410  INFO 78997 --- [           main] c.i.s.l.r.producer.Demo06ProducerTest    : [testSyncSendMore][å‘é€ç¼–å·ï¼š[1575993830] å‘é€æˆåŠŸ]\n\n// Consumer æ‹‰å–åˆ° 10 æ¡æ¶ˆæ¯åï¼Œç«‹å³æ‰¹é‡æ¶ˆè´¹åˆ° 10 æ¡æ¶ˆæ¯\n2019-12-15 00:03:50.429  INFO 78997 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯æ•°é‡ï¼š10\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚å…·ä½“èƒ–å‹çœ‹ä¸‹æ—¥å¿—ä¸Šçš„æ³¨é‡Šè¯´æ˜ã€‚")])]),e._v(" "),r("p",[e._v("ğŸ˜ˆ è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸¤ç§ Spring-AMQP çš„æ‰¹é‡æ¶ˆè´¹æ¶ˆè´¹çš„æ–¹æ³•ã€‚æ›´å¤šçš„å†…å®¹ï¼Œå¯ä»¥çœ‹çœ‹ "),r("a",{attrs:{href:"https://docs.spring.io/spring-amqp/docs/current/reference/html/#receiving-batch",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠSpring-AMQP å®˜æ–¹æ–‡æ¡£ â€”â€” @RabbitListener with Batchingã€‹"),r("OutboundLink")],1),e._v(" æ–‡æ¡£ã€‚")]),e._v(" "),r("h2",{attrs:{id:"æœ‰ä¸ªå°å‘"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æœ‰ä¸ªå°å‘"}},[e._v("#")]),e._v(" æœ‰ä¸ªå°å‘")]),e._v(" "),r("p",[e._v("RabbitMQ æ‰¹é‡æ¶ˆè´¹æ˜¯åŸºäºç¼“å†²åŒºçš„ï¼Œä¸”éœ€è¦åœ¨åŒä¸€çº¿ç¨‹ä¸‹ã€‚")]),e._v(" "),r("p",[e._v("ç»è¿‡æµ‹è¯•å½“å‘é€çš„æ•°æ®æ˜¯10æ¡æ—¶ï¼Œmqåˆ†äº†ä¸¤ä¸ªçº¿ç¨‹å»æ¶ˆè´¹ï¼š28å·çº¿ç¨‹æ¶ˆè´¹5ä¸ªï¼Œ25å·çº¿ç¨‹æ¶ˆè´¹5ä¸ªï¼Œè¿™ä¸ªæ—¶å€™ä¸ä¼šè§¦å‘BatchSizeï¼Œä¹Ÿå°±æ˜¯ä»ç„¶éœ€è¦ç­‰åˆ°è¶…æ—¶äº†æ‰ä¼šæ¶ˆè´¹ã€‚")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/image-20231213145544351.png",alt:""}})]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/image-20231213145556000.png",alt:""}})]),e._v(" "),r("h1",{attrs:{id:"_7-æ¶ˆè´¹é‡è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-æ¶ˆè´¹é‡è¯•"}},[e._v("#")]),e._v(" 7. æ¶ˆè´¹é‡è¯•")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-consume-retry"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("åœ¨å¼€å§‹æœ¬å°èŠ‚ä¹‹å‰ï¼Œèƒ–å‹é¦–å…ˆè¦å¯¹ RabbitMQ çš„"),r("a",{attrs:{href:"https://www.rabbitmq.com/dlx.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("æ­»ä¿¡é˜Ÿåˆ—"),r("OutboundLink")],1),e._v("çš„æœºåˆ¶ï¼Œæœ‰ä¸€å®šçš„äº†è§£ã€‚ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹"),r("a",{attrs:{href:"http://www.iocoder.cn/RabbitMQ/dead-letter-queue/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠRabbitMQ ä¹‹æ­»ä¿¡é˜Ÿåˆ—ã€‹"),r("OutboundLink")],1),e._v("æ–‡ç« ã€‚")]),e._v(" "),r("p",[e._v("åœ¨æ¶ˆæ¯"),r("strong",[e._v("æ¶ˆè´¹å¤±è´¥")]),e._v("çš„æ—¶å€™ï¼ŒSpring-AMQP ä¼šé€šè¿‡"),r("strong",[e._v("æ¶ˆè´¹é‡è¯•")]),e._v("æœºåˆ¶ï¼Œé‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯ç»™ Consumer ï¼Œè®© Consumer æœ‰æœºä¼šé‡æ–°æ¶ˆè´¹æ¶ˆæ¯ï¼Œå®ç°æ¶ˆè´¹æˆåŠŸã€‚")]),e._v(" "),r("p",[e._v("å½“ç„¶ï¼ŒSpring-AMQP å¹¶ä¸ä¼šæ— é™é‡æ–°æŠ•é€’æ¶ˆæ¯ç»™ Consumer é‡æ–°æ¶ˆè´¹ï¼Œè€Œæ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾¾åˆ° N æ¬¡é‡è¯•æ¬¡æ•°æ—¶ï¼ŒConsumer è¿˜æ˜¯æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œè¯¥æ¶ˆæ¯å°±ä¼šè¿›å…¥åˆ°"),r("strong",[e._v("æ­»ä¿¡é˜Ÿåˆ—")]),e._v("ã€‚åç»­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿›è¡Œé‡å‘ï¼Œæ¥ä½¿å¾—æ¶ˆè´¹è€…å®ä¾‹å†æ¬¡è¿›è¡Œæ¶ˆè´¹ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("åœ¨"),r("a",{attrs:{href:"http://www.iocoder.cn/Spring-Boot/RocketMQ/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹"),r("OutboundLink")],1),e._v("çš„"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ6. æ¶ˆè´¹é‡è¯•ã€"),r("OutboundLink")],1),e._v("å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ˜¯ RocketMQ è‡ªå¸¦çš„åŠŸèƒ½ã€‚")]),e._v(" "),r("li",[e._v("è€Œåœ¨ RabbitMQ ä¸­ï¼Œæ¶ˆè´¹é‡è¯•æ˜¯ç”± Spring-AMQP æ‰€å°è£…æä¾›çš„ï¼Œæ­»ä¿¡é˜Ÿåˆ—æ˜¯ RabbitMQ è‡ªå¸¦çš„åŠŸèƒ½ã€‚")])]),e._v(" "),r("p",[e._v("é‚£ä¹ˆæ¶ˆè´¹å¤±è´¥åˆ°è¾¾æœ€å¤§æ¬¡æ•°çš„æ¶ˆæ¯ï¼Œæ˜¯æ€ä¹ˆè¿›å…¥åˆ°æ­»ä¿¡é˜Ÿåˆ—çš„å‘¢ï¼ŸSpring-AMQP åœ¨æ¶ˆæ¯åˆ°è¾¾æœ€å¤§æ¶ˆè´¹æ¬¡æ•°çš„æ—¶å€™ï¼Œä¼šå°†è¯¥æ¶ˆæ¯è¿›è¡Œå¦å®š("),r("code",[e._v("basic.nack")]),e._v(")ï¼Œå¹¶ä¸” "),r("code",[e._v("requeue=false")]),e._v(" ï¼Œè¿™æ ·åç»­å°±å¯ä»¥åˆ©ç”¨ RabbitMQ çš„"),r("a",{attrs:{href:"https://www.rabbitmq.com/dlx.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("æ­»ä¿¡é˜Ÿåˆ—"),r("OutboundLink")],1),e._v("çš„æœºåˆ¶ï¼Œå°†è¯¥æ¶ˆæ¯è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚")]),e._v(" "),r("p",[e._v("å¦å¤–ï¼Œæ¯æ¡æ¶ˆæ¯çš„å¤±è´¥é‡è¯•ï¼Œæ˜¯å¯ä»¥é…ç½®ä¸€å®šçš„"),r("strong",[e._v("é—´éš”æ—¶é—´")]),e._v("ã€‚å…·ä½“ï¼Œæˆ‘ä»¬åœ¨ç¤ºä¾‹çš„ä»£ç ä¸­ï¼Œæ¥è¿›è¡Œå…·ä½“çš„è§£é‡Šã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer æ¶ˆè´¹é‡è¯•çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-consume-retry"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_7-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 7.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_7-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 7.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/resources",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("resources")]),r("OutboundLink")],1),e._v(" ç›®å½•ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("spring:\n  # RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»\n  rabbitmq:\n    host: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\n    port: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\n    username: guest # RabbitMQ æœåŠ¡çš„è´¦å·\n    password: guest # RabbitMQ æœåŠ¡çš„å¯†ç \n    listener:\n      simple:\n        # å¯¹åº” RabbitProperties.ListenerRetry ç±»\n        retry:\n          enabled: true # å¼€å¯æ¶ˆè´¹é‡è¯•æœºåˆ¶\n          max-attempts: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚é»˜è®¤ä¸º 3 ã€‚\n          initial-interval: 1000 # é‡è¯•é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚é»˜è®¤ä¸º 1000 ã€‚\n")])])]),r("ul",[r("li",[r("p",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡"),r("strong",[e._v("æ–°å¢")]),e._v(" "),r("code",[e._v("spring.rabbitmq.simple.retry.enable=true")]),e._v(" é…ç½®é¡¹ï¼Œæ¥å¼€å¯ Spring-AMQP çš„æ¶ˆè´¹é‡è¯•çš„åŠŸèƒ½ã€‚åŒæ—¶ï¼Œé€šè¿‡"),r("strong",[e._v("æ–°å¢")]),e._v(" "),r("code",[e._v("max-attempts")]),e._v(" å’Œ "),r("code",[e._v("initial-interval")]),e._v(" é…ç½®é¡¹ï¼Œè®¾ç½®é‡è¯•æ¬¡æ•°å’Œé—´éš”ã€‚")]),e._v(" "),r("blockquote",[r("p",[r("code",[e._v("max-attempts")]),e._v(" é…ç½®é¡¹è¦æ³¨æ„ï¼Œæ˜¯ä¸€æ¡æ¶ˆæ¯ä¸€å…±å°è¯•æ¶ˆè´¹æ€»å…± "),r("code",[e._v("max-attempts")]),e._v(" æ¬¡ï¼ŒåŒ…æ‹¬é¦–æ¬¡çš„æ­£å¸¸æ¶ˆè´¹ã€‚")])])]),e._v(" "),r("li",[r("p",[e._v("å¦å¤–ï¼Œèƒ–å‹å¯ä»¥é€šè¿‡æ·»åŠ  "),r("code",[e._v("spring.rabbitmq.listener.simple.retry.multiplier")]),e._v(" é…ç½®é¡¹æ¥å®ç°"),r("strong",[e._v("é€’ä¹˜")]),e._v("çš„æ—¶é—´é—´éš”ï¼Œæ·»åŠ  "),r("code",[e._v("spring.rabbitmq.listener.simple.retry.max-interval")]),e._v(" é…ç½®é¡¹æ¥å®ç°"),r("strong",[e._v("æœ€å¤§")]),e._v("çš„æ—¶é—´é—´éš”ã€‚")])])]),e._v(" "),r("p",[e._v("åœ¨ Spring-AMQP çš„æ¶ˆè´¹é‡è¯•æœºåˆ¶ä¸­ï¼Œåœ¨æ¶ˆè´¹å¤±è´¥åˆ°è¾¾æœ€å¤§æ¬¡æ•°åï¼Œä¼š"),r("strong",[e._v("è‡ªåŠ¨")]),e._v("æŠ›å‡º "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/AmqpRejectAndDontRequeueException.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("AmqpRejectAndDontRequeueException"),r("OutboundLink")],1),e._v(" å¼‚å¸¸ï¼Œä»è€Œç»“æŸè¯¥æ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•ã€‚è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬åœ¨æ¶ˆè´¹æ¶ˆæ¯çš„é€»è¾‘ä¸­ï¼Œ"),r("strong",[e._v("ä¸»åŠ¨")]),e._v("æŠ›å‡º AmqpRejectAndDontRequeueException å¼‚å¸¸ï¼Œä¹Ÿèƒ½ç»“æŸè¯¥æ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•ã€‚ğŸ˜ˆ ç»“æŸçš„æ–¹å¼ï¼ŒSpring-AMQP æ˜¯é€šè¿‡æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ "),r("code",[e._v("basic.nack")]),e._v(" + "),r("code",[e._v("requeue=false")]),e._v(" ï¼Œä»è€Œå®ç°è½¬å‘è¯¥æ¶ˆæ¯åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("p",[e._v("å¦å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ"),r("code",[e._v("spring.rabbitmq.simple.retry.enable=false")]),e._v(" ï¼Œå…³é—­ Spring-AMQP çš„æ¶ˆè´¹é‡è¯•åŠŸèƒ½ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œæ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸çš„æ¶ˆæ¯ï¼Œè¿˜æ˜¯ä¼šä¸€ç›´"),r("strong",[e._v("é‡æ–°æ¶ˆè´¹")]),e._v("ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸSpring-AMQP ä¼šå°†è¯¥æ¶ˆæ¯é€šè¿‡ "),r("code",[e._v("basic.nack")]),e._v(" + "),r("code",[e._v("requeue=true")]),e._v(" ï¼Œé‡æ–°æŠ•é€’å›"),r("strong",[e._v("åŸé˜Ÿåˆ—çš„å°¾å·´")]),e._v("ã€‚å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾¿ä¼šä¸æ–­æ‹‰å–åˆ°è¯¥æ¶ˆæ¯ï¼Œä¸æ–­â€œé‡è¯•â€æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚å½“ç„¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€æ ·å¯ä»¥"),r("strong",[e._v("ä¸»åŠ¨")]),e._v("æŠ›å‡º AmqpRejectAndDontRequeueException å¼‚å¸¸ï¼Œä¹Ÿèƒ½ç»“æŸè¯¥æ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•ã€‚ğŸ˜ˆ ç»“æŸçš„æ–¹å¼ï¼ŒSpring-AMQP ä¹Ÿæ˜¯é€šè¿‡æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ "),r("code",[e._v("basic.nack")]),e._v(" + "),r("code",[e._v("requeue=false")]),e._v(" ï¼Œä»è€Œå®ç°è½¬å‘è¯¥æ¶ˆæ¯åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("p",[e._v("è¿™é‡Œï¼Œæˆ‘ä»¬å†æ¥ç®€å•è¯´è¯´ Spring-AMQP æ˜¯æ€ä¹ˆæä¾›"),r("strong",[e._v("æ¶ˆè´¹é‡è¯•")]),e._v("çš„åŠŸèƒ½çš„ã€‚")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("Spring-AMQP åŸºäº "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-retry",target:"_blank",rel:"noopener noreferrer"}},[e._v("spring-retry"),r("OutboundLink")],1),e._v(" é¡¹ç›®æä¾›çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-retry/blob/master/src/main/java/org/springframework/retry/support/RetryTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RetryTemplate"),r("OutboundLink")],1),e._v(" ï¼Œå®ç°é‡è¯•åŠŸèƒ½ã€‚Spring-AMQP åœ¨è·å–åˆ°æ¶ˆæ¯æ—¶ï¼Œä¼šäº¤ç»™ RetryTemplate æ¥è°ƒç”¨æ¶ˆè´¹è€… Consumer çš„ç›‘å¬å™¨ Listener(å°±æ˜¯æˆ‘ä»¬å®ç°çš„)ï¼Œå®ç°è¯¥æ¶ˆæ¯çš„"),r("strong",[e._v("å¤šæ¬¡")]),e._v("æ¶ˆè´¹é‡è¯•ã€‚")])]),e._v(" "),r("li",[r("p",[e._v("åœ¨è¯¥æ¶ˆæ¯çš„"),r("strong",[e._v("æ¯æ¬¡æ¶ˆè´¹å¤±è´¥")]),e._v("åï¼ŒRetryTemplate ä¼šé€šè¿‡ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-retry/blob/master/src/main/java/org/springframework/retry/backoff/BackOffPolicy.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BackOffPolicy"),r("OutboundLink")],1),e._v(" æ¥è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ¶ˆæ¯çš„"),r("strong",[e._v("ä¸‹ä¸€æ¬¡é‡æ–°æ¶ˆè´¹çš„æ—¶é—´")]),e._v("ï¼Œé€šè¿‡ "),r("code",[e._v("Thread#sleep(...)")]),e._v(" æ–¹æ³•ï¼Œå®ç°é‡æ–°æ¶ˆè´¹çš„æ—¶é—´é—´éš”ã€‚åˆ°è¾¾æ—¶é—´é—´éš”åï¼ŒRetryTemplate åˆä¼šè°ƒç”¨æ¶ˆè´¹è€… Consumer çš„ç›‘å¬å™¨ Listener æ¥æ¶ˆè´¹è¯¥æ¶ˆæ¯ã€‚")])]),e._v(" "),r("li",[r("p",[e._v("å½“è¯¥æ¶ˆæ¯çš„é‡è¯•æ¶ˆè´¹åˆ°è¾¾"),r("strong",[e._v("ä¸Šé™")]),e._v("åï¼ŒRetryTemplate ä¼šè°ƒç”¨ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-retry/blob/master/src/main/java/org/springframework/retry/interceptor/MethodInvocationRecoverer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MethodInvocationRecoverer"),r("OutboundLink")],1),e._v(" å›è°ƒæ¥å®ç°æ¢å¤ã€‚è€Œ Spring-AMQP è‡ªå®šä¹‰å®ç°äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/retry/RejectAndDontRequeueRecoverer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RejectAndDontRequeueRecoverer"),r("OutboundLink")],1),e._v(" æ¥"),r("strong",[e._v("è‡ªåŠ¨")]),e._v("æŠ›å‡º AmqpRejectAndDontRequeueException å¼‚å¸¸ï¼Œä»è€Œç»“æŸè¯¥æ¶ˆæ¯çš„æ¶ˆè´¹é‡è¯•ã€‚ğŸ˜ˆ ç»“æŸçš„æ–¹å¼ï¼ŒSpring-AMQP æ˜¯é€šè¿‡æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ "),r("code",[e._v("basic.nack")]),e._v(" + "),r("code",[e._v("requeue=false")]),e._v(" ï¼Œä»è€Œå®ç°è½¬å‘è¯¥æ¶ˆæ¯åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")])]),e._v(" "),r("li",[r("p",[e._v("æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒSpring-AMQP æä¾›çš„æ¶ˆè´¹é‡è¯•çš„"),r("strong",[e._v("è®¡æ•°")]),e._v("æ˜¯"),r("strong",[e._v("å®¢æˆ·ç«¯")]),e._v("çº§åˆ«çš„ï¼Œé‡å¯ JVM åº”ç”¨åï¼Œè®¡æ•°æ˜¯ä¼šä¸¢å¤±çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦è®¡æ•°è¿›è¡ŒæŒä¹…åŒ–ï¼Œéœ€è¦è‡ªå·±é‡æ–°å®ç°ä¸‹ã€‚")]),e._v(" "),r("blockquote",[r("p",[e._v("ğŸ˜ˆ RocketMQ æä¾›çš„æ¶ˆè´¹é‡è¯•çš„è®¡æ•°ï¼Œç›®å‰æ˜¯"),r("strong",[e._v("æœåŠ¡ç«¯")]),e._v("çº§åˆ«ï¼Œå·²ç»è¿›è¡ŒæŒä¹…åŒ–ã€‚")])])])]),e._v(" "),r("blockquote",[r("p",[e._v("ğŸ˜œ çå“”å“”äº†å¥½é•¿ä¸€æ®µï¼Œæ¶‰åŠåˆ°çš„ä¿¡æ¯é‡å¯èƒ½æ¯”è¾ƒå¤§ï¼Œå¦‚æœè‰¿è‰¿æœ‰è§£é‡Šä¸æ¸…æ™°æˆ–è€…é”™è¯¯çš„åœ°æ–¹ï¼Œåˆæˆ–è€…å“ªé‡Œä¸äº†è§£ï¼Œå¯ä»¥ç»™è‰¿è‰¿ç•™è¨€ï¼Œä¹æ„ä¹‹è‡³ä¸ºèƒ–å‹è§£ç­”ã€‚")]),e._v(" "),r("p",[e._v("åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è°ƒè¯•ä¸‹æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°çš„æºç ï¼Œæ›´åŠ å…·è±¡ä¸‹ã€‚ã€Œæºç ä¹‹å‰ï¼Œäº†æ— ç§˜å¯†ã€ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_7-3-demo07message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-demo07message"}},[e._v("#")]),e._v(" 7.3 Demo07Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo07Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo07Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo07Message.java\n\n\n    public static final String QUEUE = "QUEUE_DEMO_07"; // æ­£å¸¸é˜Ÿåˆ—\n    public static final String DEAD_QUEUE = "DEAD_QUEUE_DEMO_07"; // æ­»ä¿¡é˜Ÿåˆ—\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_07";\n\n    public static final String ROUTING_KEY = "ROUTING_KEY_07"; // æ­£å¸¸è·¯ç”±é”®\n    public static final String DEAD_ROUTING_KEY = "DEAD_ROUTING_KEY_07"; // æ­»ä¿¡è·¯ç”±é”®\n\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼Œé¢å¤–å¢åŠ äº†æ­»ä¿¡é˜Ÿåˆ—ä¼šç”¨åˆ°çš„ Queue å’Œ RoutingKey ï¼Œè€Œ Exchange æˆ‘ä»¬å…ˆå¤ç”¨ "),r("code",[e._v('EXCHANGE = "EXCHANGE_DEMO_07"')]),e._v(" ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_7-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-rabbitconfig"}},[e._v("#")]),e._v(" 7.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œé¢å¤–æ·»åŠ "),r("strong",[e._v("æ­»ä¿¡é˜Ÿåˆ—")]),e._v("çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo07Queue() {\n            return QueueBuilder.durable(Demo07Message.QUEUE) // durable: æ˜¯å¦æŒä¹…åŒ–\n                    .exclusive() // exclusive: æ˜¯å¦æ’å®ƒ\n                    .autoDelete() // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n                    .deadLetterExchange(Demo07Message.EXCHANGE)\n                    .deadLetterRoutingKey(Demo07Message.DEAD_ROUTING_KEY)\n                    .build();\n        }\n\n        // åˆ›å»º Dead Queue\n        @Bean\n        public Queue demo07DeadQueue() {\n            return new Queue(Demo07Message.DEAD_QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo07Exchange() {\n            return new DirectExchange(Demo07Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo07Message.EXCHANGE\n        // Routing keyï¼šDemo07Message.ROUTING_KEY\n        // Queueï¼šDemo07Message.QUEUE\n        @Bean\n        public Binding demo07Binding() {\n            return BindingBuilder.bind(demo07Queue()).to(demo07Exchange()).with(Demo07Message.ROUTING_KEY);\n        }\n\n        // åˆ›å»º Dead Binding\n        // Exchangeï¼šDemo07Message.EXCHANGE\n        // Routing keyï¼šDemo07Message.DEAD_ROUTING_KEY\n        // Queueï¼šDemo07Message.DEAD_QUEUE\n        @Bean\n        public Binding demo07DeadBinding() {\n            return BindingBuilder.bind(demo07DeadQueue()).to(demo07Exchange()).with(Demo07Message.DEAD_ROUTING_KEY);\n        }\n\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.5 RabbitConfigã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼Œä¸»è¦æœ‰"),r("strong",[e._v("ä¸¤ä¸ª")]),e._v("å·®å¼‚ç‚¹ã€‚")]),e._v(" "),r("li",[e._v("ç¬¬ä¸€ç‚¹ï¼Œåˆ›å»ºçš„æ­£å¸¸ Queue é¢å¤–è®¾ç½®äº†ï¼Œå½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡æ—¶ï¼ŒRabbitMQ è‡ªåŠ¨è½¬å‘åˆ° Exchange ä¸º "),r("code",[e._v("Demo07Message.EXCHANGE")]),e._v("ï¼ŒRoutingKey ä¸º "),r("code",[e._v("Demo07Message.DEAD_ROUTING_KEY")]),e._v(" çš„æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("li",[e._v("ç¬¬äºŒç‚¹ï¼Œé€šè¿‡ "),r("code",[e._v("#demo07DeadQueue()")]),e._v(" æ–¹æ³•æ¥åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—çš„ Queue ï¼Œé€šè¿‡ "),r("code",[e._v("#demo07DeadBinding()")]),e._v(" æ–¹æ³•æ¥åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—çš„ Binding ã€‚ğŸ˜ˆ å› ä¸ºæˆ‘ä»¬é‡ç”¨äº† Exchange ä¸º "),r("code",[e._v("Demo07Message.EXCHANGE")]),e._v(" ï¼Œæ‰€ä»¥æ— éœ€åˆ›å»ºã€‚å½“ç„¶ï¼Œèƒ–å‹ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œåˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—çš„ Exchange ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_7-5-demo07producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-demo07producer"}},[e._v("#")]),e._v(" 7.5 Demo07Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-batch-consume-02/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo07Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo07Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_7-6-demo07consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-demo07consumer"}},[e._v("#")]),e._v(" 7.6 Demo07Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo07Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo07Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo07Consumer.java\n\n@Component\n@RabbitListener(queues = Demo07Message.QUEUE)\npublic class Demo07Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo07Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n        // <X> æ³¨æ„ï¼Œæ­¤å¤„æŠ›å‡ºä¸€ä¸ª RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥\n        throw new RuntimeException("æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸");\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ "),r("code",[e._v("<X>")]),e._v(" å¤„ï¼Œæˆ‘ä»¬åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶å€™ï¼ŒæŠ›å‡ºä¸€ä¸ª RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_7-7-demo07deadconsumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-7-demo07deadconsumer"}},[e._v("#")]),e._v(" 7.7 Demo07DeadConsumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo07DeadConsumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo07DeadConsumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹"),r("strong",[e._v("æ­»ä¿¡é˜Ÿåˆ—")]),e._v("çš„æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo07DeadConsumer.java\n\n@Component\n@RabbitListener(queues = Demo07Message.DEAD_QUEUE)\npublic class Demo07DeadConsumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo07Message message) {\n        logger.info("[onMessage][ã€æ­»ä¿¡é˜Ÿåˆ—ã€‘çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ç±»ä¸Šï¼Œæ·»åŠ äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/annotation/RabbitListener.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@RabbitListener")]),r("OutboundLink")],1),e._v(" æ³¨è§£ï¼Œå£°æ˜äº†æ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ "),r("code",[e._v('"DEAD_QUEUE_DEMO_07"')]),e._v(" è¿™ä¸ª"),r("strong",[e._v("æ­»ä¿¡é˜Ÿåˆ—")]),e._v("ã€‚")])]),e._v(" "),r("p",[e._v("è¿™é‡Œçš„æ¶ˆè´¹é€»è¾‘ï¼Œä»…ä»…æ˜¯ç¤ºä¾‹ï¼Œå®ç°é€»è¾‘èƒ–å‹æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œè‡ªå·±æ¥å…·ä½“å®ç°ï¼Œå˜¿å˜¿ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_7-8-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-8-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 7.8 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.8 ç®€å•æµ‹è¯•ã€"),r("OutboundLink")],1),e._v(" å¤§ä½“ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-consume-retry/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo07ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo05ProducerTest"),r("OutboundLink")],1),e._v(" å•å…ƒæµ‹è¯•ç±»ã€‚")]),e._v(" "),r("p",[e._v("æˆ‘ä»¬æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" æ–¹æ³•ï¼Œæµ‹è¯• Consumer æ¶ˆè´¹é‡è¯•çš„æ•ˆæœã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer æˆåŠŸåŒæ­¥å‘é€äº† 1 æ¡æ¶ˆæ¯\n2019-12-15 14:21:40.424  INFO 66569 --- [           main] c.i.s.l.r.producer.Demo07ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1576045300] å‘é€æˆåŠŸ]\n\n# Demo07Consumer ç¬¬ 1 æ¬¡æ¶ˆè´¹\n2019-12-15 14:21:40.442  INFO 66569 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo07Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo07Message{id=1576045300}]\n# ä¸€ç§’åï¼ŒConsumer ç¬¬ 2 æ¬¡æ¶ˆè´¹\n2019-12-15 14:21:41.446  INFO 66569 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo07Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo07Message{id=1576045300}]\n# ä¸€ç§’åï¼ŒConsumer ç¬¬ 3 æ¬¡æ¶ˆè´¹\n2019-12-15 14:21:42.450  INFO 66569 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo07Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo07Message{id=1576045300}]\n\n# RejectAndDontRequeueRecoverer æ‰“å°è¯¥æ¶ˆæ¯æ¶ˆè´¹é‡è¯•åˆ°è¾¾ä¸Šé™ï¼ŒåŒæ—¶æ‰“å°å¼‚å¸¸å †æ ˆ\n2019-12-15 14:21:42.457  WARN 66569 --- [ntContainer#0-1] o.s.a.r.r.RejectAndDontRequeueRecoverer  : Retries exhausted for message (Body:'[B@514e3b1c(byte[187])' MessageProperties [headers={}, contentType=application/x-java-serialized-object, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=EXCHANGE_DEMO_07, receivedRoutingKey=ROUTING_KEY_07, deliveryTag=1, consumerTag=amq.ctag-UpkeXbl-7TYRNt_LuYDZJQ, consumerQueue=QUEUE_DEMO_07])\n// ... çœç•¥ä¸€å¤§å †å¼‚å¸¸å †æ ˆ\n\n# Demo07DeadConsumer æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—çš„è¯¥æ¡æ¶ˆæ¯\n2019-12-15 14:21:42.463  INFO 66569 --- [ntContainer#1-1] c.i.s.l.r.consumer.Demo07DeadConsumer    : [onMessage][ã€æ­»ä¿¡é˜Ÿåˆ—ã€‘çº¿ç¨‹ç¼–å·:19 æ¶ˆæ¯å†…å®¹ï¼šDemo07Message{id=1576045300}]\n")])])]),r("ul",[r("li",[e._v("Demo07Consumer é‡è¯•æ¶ˆè´¹æ¶ˆæ¯ 3 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 1 ç§’ï¼Œå…¨éƒ¨éƒ½å¤±è´¥ï¼Œæœ€ç»ˆè¯¥æ¶ˆæ¯è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("li",[e._v("Demo07DeadConsumer æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„è¯¥æ¶ˆæ¯ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_7-9-å‘é€é‡è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-9-å‘é€é‡è¯•"}},[e._v("#")]),e._v(" 7.9 å‘é€é‡è¯•")]),e._v(" "),r("p",[e._v("åœ¨ Spring-AMQP ä¹Ÿæä¾›äº†æ¶ˆæ¯å‘é€å¤±è´¥æ—¶çš„é‡è¯•æœºåˆ¶ï¼Œä¹Ÿæ˜¯åŸºäº "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-retry",target:"_blank",rel:"noopener noreferrer"}},[e._v("spring-retry"),r("OutboundLink")],1),e._v(" é¡¹ç›®æä¾›çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-retry/blob/master/src/main/java/org/springframework/retry/support/RetryTemplate.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RetryTemplate"),r("OutboundLink")],1),e._v(" æ¥å®ç°ã€‚åœ¨ "),r("code",[e._v("application.yaml")]),e._v(" é…ç½®å¦‚ä¸‹å³å¯ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("spring:\n  # RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»\n  rabbitmq:\n    host: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\n    port: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\n    username: guest # RabbitMQ æœåŠ¡çš„è´¦å·\n    password: guest # RabbitMQ æœåŠ¡çš„å¯†ç \n    template:\n      # å¯¹åº” RabbitProperties.Retry ç±»\n      retry:\n        enabled: true # å¼€å¯å‘é€æœºåˆ¶\n        max-attempts: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚é»˜è®¤ä¸º 3 ã€‚\n        initial-interval: 1000 # é‡è¯•é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚é»˜è®¤ä¸º 1000 ã€‚\n")])])]),r("ul",[r("li",[r("p",[r("code",[e._v("spring.rabbitmq.template.enable=true")]),e._v(" é…ç½®é¡¹ï¼Œæ¥å¼€å¯ Spring-AMQP çš„å‘é€é‡è¯•çš„åŠŸèƒ½ã€‚åŒæ—¶ï¼Œé€šè¿‡"),r("strong",[e._v("æ–°å¢")]),e._v(" "),r("code",[e._v("max-attempts")]),e._v(" å’Œ "),r("code",[e._v("initial-interval")]),e._v(" é…ç½®é¡¹ï¼Œè®¾ç½®é‡è¯•æ¬¡æ•°å’Œé—´éš”ã€‚")]),e._v(" "),r("blockquote",[r("p",[r("code",[e._v("max-attempts")]),e._v(" é…ç½®é¡¹è¦æ³¨æ„ï¼Œæ˜¯ä¸€æ¡æ¶ˆæ¯ä¸€å…±å°è¯•æ¶ˆè´¹æ€»å…± "),r("code",[e._v("max-attempts")]),e._v(" æ¬¡ï¼ŒåŒ…æ‹¬é¦–æ¬¡çš„æ­£å¸¸æ¶ˆè´¹ã€‚")])])]),e._v(" "),r("li",[r("p",[e._v("å¦å¤–ï¼Œèƒ–å‹å¯ä»¥é€šè¿‡æ·»åŠ  "),r("code",[e._v("spring.rabbitmq.template.retry.multiplier")]),e._v(" é…ç½®é¡¹æ¥å®ç°"),r("strong",[e._v("é€’ä¹˜")]),e._v("çš„æ—¶é—´é—´éš”ï¼Œæ·»åŠ  "),r("code",[e._v("spring.rabbitmq.template.retry.max-interval")]),e._v(" é…ç½®é¡¹æ¥å®ç°"),r("strong",[e._v("æœ€å¤§")]),e._v("çš„æ—¶é—´é—´éš”ã€‚")])])]),e._v(" "),r("p",[e._v("è¿™é‡Œè‰¿è‰¿å°±æš‚æ—¶ä¸æ‹“å±•å¼€æ¥è®²ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±å°è¯•ä¸‹å“ˆã€‚")]),e._v(" "),r("h1",{attrs:{id:"_8-å®šæ—¶æ¶ˆæ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-å®šæ—¶æ¶ˆæ¯"}},[e._v("#")]),e._v(" 8. å®šæ—¶æ¶ˆæ¯")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-delay"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ7. æ¶ˆè´¹é‡è¯•ã€"),r("OutboundLink")],1),e._v("å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° Spring-AMQP åŸºäº RabbitMQ æä¾›çš„"),r("strong",[e._v("æ­»ä¿¡é˜Ÿåˆ—")]),e._v("ï¼Œé€šè¿‡ "),r("code",[e._v("basic.nack")]),e._v(" + "),r("code",[e._v("requeue=false")]),e._v(" çš„æ–¹å¼ï¼Œå°†é‡è¯•æ¶ˆè´¹åˆ°è¾¾ä¸Šé™æ¬¡æ•°çš„æ¶ˆæ¯ï¼ŒæŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("p",[e._v("æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬è¿˜æ˜¯åŸºäº RabbitMQ çš„"),r("strong",[e._v("æ­»ä¿¡é˜Ÿåˆ—")]),e._v("ï¼Œå®ç°"),r("strong",[e._v("å®šæ—¶æ¶ˆæ¯")]),e._v("çš„åŠŸèƒ½ã€‚RabbitMQ æä¾›äº†è¿‡æœŸæ—¶é—´ "),r("a",{attrs:{href:"https://www.rabbitmq.com/ttl.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("TTL"),r("OutboundLink")],1),e._v(" æœºåˆ¶ï¼Œå¯ä»¥è®¾ç½®æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„å­˜æ´»æ—¶é•¿ã€‚åœ¨æ¶ˆæ¯åˆ°è¾¾è¿‡æœŸæ—¶é—´æ—¶ï¼Œä¼šä»å½“å‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå¹¶è¢« RabbitMQ è‡ªåŠ¨è½¬å‘åˆ°å¯¹åº”çš„æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("p",[e._v("é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºæ¶ˆè´¹è€… Consumer ï¼Œæ¥æ¶ˆè´¹è¯¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ˜¯ä¸æ˜¯å°±å®ç°äº†"),r("strong",[e._v("å»¶è¿Ÿé˜Ÿåˆ—")]),e._v("çš„æ•ˆæœã€‚ğŸ˜ˆ å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾¿å®ç°äº†å®šæ—¶æ¶ˆæ¯çš„åŠŸèƒ½ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå®šæ—¶æ¶ˆæ¯çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-delay"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_8-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 8.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_8-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 8.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_8-3-demo08message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-demo08message"}},[e._v("#")]),e._v(" 8.3 Demo08Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo08Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo08Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo08Message.java\n\npublic class Demo08Message implements Serializable {\n\n    public static final String QUEUE = "QUEUE_DEMO_08"; // æ­£å¸¸é˜Ÿåˆ—\n    public static final String DELAY_QUEUE = "DELAY_QUEUE_DEMO_08"; // å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_08";\n\n    public static final String ROUTING_KEY = "ROUTING_KEY_08"; // æ­£å¸¸è·¯ç”±é”®\n    public static final String DELAY_ROUTING_KEY = "DELAY_ROUTING_KEY_08"; // å»¶è¿Ÿè·¯ç”±é”®ï¼ˆæ­»ä¿¡è·¯ç”±é”®ï¼‰\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ8.3 Demo07Messageã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼ŒåŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯æ¢äº†ä¸‹å‘½åï¼Œå°† "),r("code",[e._v("DEAD")]),e._v(" æ”¹æˆ "),r("code",[e._v("DELAY")]),e._v(" æ¥æ–¹ä¾¿èƒ–å‹ç†è§£ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_8-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-rabbitconfig"}},[e._v("#")]),e._v(" 8.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œé¢å¤–æ·»åŠ "),r("strong",[e._v("å»¶è¿Ÿé˜Ÿåˆ—")]),e._v("ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo08Queue() {\n            return QueueBuilder.durable(Demo08Message.QUEUE) // durable: æ˜¯å¦æŒä¹…åŒ–\n                    .exclusive() // exclusive: æ˜¯å¦æ’å®ƒ\n                    .autoDelete() // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n                    .ttl(10 * 1000) // è®¾ç½®é˜Ÿåˆ—é‡Œçš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º 10 ç§’\n                    .deadLetterExchange(Demo08Message.EXCHANGE)\n                    .deadLetterRoutingKey(Demo08Message.DELAY_ROUTING_KEY)\n                    .build();\n        }\n\n        // åˆ›å»º Delay Queue\n        @Bean\n        public Queue demo08DelayQueue() {\n            return new Queue(Demo08Message.DELAY_QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo08Exchange() {\n            return new DirectExchange(Demo08Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo08Message.EXCHANGE\n        // Routing keyï¼šDemo08Message.ROUTING_KEY\n        // Queueï¼šDemo08Message.QUEUE\n        @Bean\n        public Binding demo08Binding() {\n            return BindingBuilder.bind(demo08Queue()).to(demo08Exchange()).with(Demo08Message.ROUTING_KEY);\n        }\n\n        // åˆ›å»º Delay Binding\n        // Exchangeï¼šDemo08Message.EXCHANGE\n        // Routing keyï¼šDemo08Message.DELAY_ROUTING_KEY\n        // Queueï¼šDemo08Message.DELAY_QUEUE\n        @Bean\n        public Binding demo08DelayBinding() {\n            return BindingBuilder.bind(demo08DelayQueue()).to(demo08Exchange()).with(Demo08Message.DELAY_ROUTING_KEY);\n        }\n\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ7.4 RabbitConfigã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼Œä¸»è¦æœ‰"),r("strong",[e._v("ä¸€ä¸ª")]),e._v("å·®å¼‚ç‚¹ã€‚åœ¨ "),r("code",[e._v("#demo08Queue()")]),e._v(" æ–¹æ³•æ¥åˆ›å»ºçš„ Queue ï¼Œæˆ‘ä»¬è®¾ç½®äº†è¯¥é˜Ÿåˆ—çš„æ¶ˆæ¯çš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º 10 ç§’ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_8-5-demo08producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-demo08producer"}},[e._v("#")]),e._v(" 8.5 Demo08Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo08Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo08Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo08Producer.java\n\n@Component\npublic class Demo08Producer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id, Integer delay) {\n        // åˆ›å»º Demo07Message æ¶ˆæ¯\n        Demo08Message message = new Demo08Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo08Message.EXCHANGE, Demo08Message.ROUTING_KEY, message, new MessagePostProcessor() {\n\n            @Override\n            public Message postProcessMessage(Message message) throws AmqpException {\n                // è®¾ç½®æ¶ˆæ¯çš„ TTL è¿‡æœŸæ—¶é—´\n                if (delay != null && delay > 0) {\n                    message.getMessageProperties().setExpiration(String.valueOf(delay)); // Spring-AMQP API è®¾è®¡æœ‰é—®é¢˜ï¼Œæ‰€ä»¥ä¼ å…¥äº† String = =\n                }\n                return message;\n            }\n\n        });\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("è°ƒç”¨ "),r("code",[e._v("#syncSend(Integer id, Integer delay)")]),e._v(" æ–¹æ³•æ¥å‘é€æ¶ˆæ¯æ—¶ï¼Œå¦‚æœä¼ é€’äº†æ–¹æ³•å‚æ•° "),r("code",[e._v("delay")]),e._v(" ï¼Œåˆ™æˆ‘ä»¬ä¼šè®¾ç½®æ¶ˆæ¯çš„ TTL è¿‡æœŸæ—¶é—´ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_8-6-demo08consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-demo08consumer"}},[e._v("#")]),e._v(" 8.6 Demo08Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo08Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo08Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹"),r("strong",[e._v("å»¶è¿Ÿé˜Ÿåˆ—")]),e._v("ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰çš„æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('@Component\n@RabbitListener(queues = Demo08Message.DELAY_QUEUE)\npublic class Demo08Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo08Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ç±»ä¸Šï¼Œæ·»åŠ äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/annotation/RabbitListener.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@RabbitListener")]),r("OutboundLink")],1),e._v(" æ³¨è§£ï¼Œå£°æ˜äº†æ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ "),r("code",[e._v('"DELAY_QUEUE_DEMO_08"')]),e._v(" è¿™ä¸ª"),r("strong",[e._v("å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰")])]),e._v(" "),r("li",[e._v("åœ¨æ¶ˆè´¹é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬æ­£å¸¸æ¶ˆè´¹è¯¥æ¶ˆæ¯å³å¯ï¼Œå®ç°è‡ªå·±éœ€è¦çš„ä¸šåŠ¡é€»è¾‘ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_8-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 8.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-delay/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo08ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo08ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•"),r("strong",[e._v("å®šæ—¶æ¶ˆæ¯")]),e._v("çš„æ•ˆæœã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo08ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo08ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo08Producer producer;\n\n    @Test\n    public void testSyncSend01() throws InterruptedException {\n        // ä¸è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨é˜Ÿåˆ—é»˜è®¤çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´\n        this.testSyncSendDelay(null);\n    }\n\n    @Test\n    public void testSyncSend02() throws InterruptedException {\n        // è®¾ç½®å‘é€æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ä¸º 5000 æ¯«ç§’\n        this.testSyncSendDelay(5000);\n    }\n\n    private void testSyncSendDelay(Integer delay) throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id, delay);\n        logger.info("[testSyncSendDelay][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[r("code",[e._v("#testSyncSend01()")]),e._v(" æ–¹æ³•ï¼Œä¸è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨é˜Ÿåˆ—"),r("strong",[e._v("é»˜è®¤çš„æ¶ˆæ¯è¿‡æœŸ")]),e._v("æ—¶é—´ã€‚")]),e._v(" "),r("li",[r("code",[e._v("#testSyncSend02()")]),e._v(" æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯çš„"),r("strong",[e._v("è¿‡æœŸæ—¶é—´ä¸º 5000 æ¯«ç§’")]),e._v("ã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å…ˆæ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend01()")]),e._v(" æ–¹æ³•ï¼Œä¸è®¾ç½®æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨é˜Ÿåˆ—"),r("strong",[e._v("é»˜è®¤çš„æ¶ˆæ¯è¿‡æœŸ")]),e._v("æ—¶é—´ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 15:44:34.571  INFO 85481 --- [           main] c.i.s.l.r.producer.Demo08ProducerTest    : [testSyncSendDelay][å‘é€ç¼–å·ï¼š[1576050274] å‘é€æˆåŠŸ]\n\n# Consumer 10 ç§’åï¼Œæ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯\n2019-12-15 15:44:44.588  INFO 85481 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo08Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo08Message{id=1576050274}]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚")])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å†æ¥æ‰§è¡Œ "),r("code",[e._v("#testSyncSend02()")]),e._v(" æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯çš„"),r("strong",[e._v("è¿‡æœŸæ—¶é—´ä¸º 5000 æ¯«ç§’")]),e._v("ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚\n2019-12-15 15:45:41.076  INFO 85735 --- [           main] c.i.s.l.r.producer.Demo08ProducerTest    : [testSyncSendDelay][å‘é€ç¼–å·ï¼š[1576050341] å‘é€æˆåŠŸ]\n\n# Consumer 5 ç§’åï¼Œæ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯\n2019-12-15 15:45:46.090  INFO 85735 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo08Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo08Message{id=1576050341}]\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_8-8-rabbitmq-delayed-message-plugin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-rabbitmq-delayed-message-plugin"}},[e._v("#")]),e._v(" 8.8 RabbitMQ Delayed Message Plugin")]),e._v(" "),r("p",[e._v("RabbitMQ ç›®å‰æä¾›äº† "),r("a",{attrs:{href:"https://github.com/rabbitmq/rabbitmq-delayed-message-exchange",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitMQ Delayed Message Plugin"),r("OutboundLink")],1),e._v(" æ’ä»¶ï¼Œæä¾›æ›´åŠ "),r("strong",[e._v("é€šç”¨")]),e._v("çš„å®šæ—¶æ¶ˆæ¯çš„åŠŸèƒ½ã€‚")]),e._v(" "),r("p",[e._v("ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œè‰¿è‰¿è¿™é‡Œå…ˆæš‚æ—¶ä¸æä¾›ç¤ºä¾‹ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ "),r("a",{attrs:{href:"http://www.iocoder.cn/Fight/Spring-Boot-RabbitMQ-deferred-message-implementation-full-version/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠSpring Boot RabbitMQ å»¶è¿Ÿæ¶ˆæ¯å®ç°å®Œæ•´ç‰ˆã€‹"),r("OutboundLink")],1),e._v(" æ–‡ç« ã€‚")]),e._v(" "),r("p",[e._v("è¿™ä¸¤ç§æ–¹æ¡ˆï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œè¿˜æ˜¯"),r("strong",[e._v("æ¨èç›´æ¥ä½¿ç”¨ RabbitMQ Delayed Message Plugin æ’ä»¶çš„æ–¹å¼")]),e._v("ã€‚æ¯•ç«Ÿï¼Œè¿™æ˜¯ RabbitMQ å®˜æ–¹è®¤å¯çš„æ’ä»¶ï¼Œä½¿ç”¨èµ·æ¥è‚¯å®šæ˜¯æ²¡é”™çš„ã€‚")]),e._v(" "),r("h1",{attrs:{id:"_9-æ¶ˆæ¯æ¨¡å¼"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-æ¶ˆæ¯æ¨¡å¼"}},[e._v("#")]),e._v(" 9. æ¶ˆæ¯æ¨¡å¼")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-message-model"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæœ‰ä¸¤ç§ç»å…¸çš„æ¶ˆæ¯æ¨¡å¼ï¼šã€Œç‚¹å¯¹ç‚¹ã€å’Œã€Œå‘å¸ƒè®¢é˜…ã€ã€‚å…·ä½“çš„æ¦‚å¿µï¼Œå°±å…ˆä¸è§£é‡Šï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹"),r("a",{attrs:{href:"http://www.iocoder.cn/Fight/There-are-two-modes-of-message-queuing-point-to-point-and-publish-subscription/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Šæ¶ˆæ¯é˜Ÿåˆ—ä¸¤ç§æ¨¡å¼ï¼šç‚¹å¯¹ç‚¹ä¸å‘å¸ƒè®¢é˜…ã€‹"),r("OutboundLink")],1),e._v("æ–‡ç« ã€‚")]),e._v(" "),r("p",[e._v("å¦‚æœèƒ–å‹æœ‰ä½¿ç”¨è¿‡ RocketMQ æˆ–è€… Kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯èƒ½æ¯”è¾ƒä¹ æƒ¯çš„å«æ³•æ˜¯ï¼š")]),e._v(" "),r("blockquote",[r("p",[r("strong",[e._v("é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰")]),e._v("ï¼šå¯¹åº”ã€Œç‚¹å¯¹ç‚¹ã€ é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[r("strong",[e._v("å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰")]),e._v("ï¼šå¯¹åº”ã€Œå‘å¸ƒè®¢é˜…ã€ å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚")])]),e._v(" "),r("p",[e._v("ğŸ˜ˆ ä¸‹æ–‡æˆ‘ä»¬ç»Ÿä¸€é‡‡ç”¨é›†ç¾¤æ¶ˆè´¹å’Œå¹¿æ’­æ¶ˆè´¹å«æ³•ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ†åˆ«åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1 é›†ç¾¤æ¶ˆè´¹ã€"),r("OutboundLink")],1),e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.2 å¹¿æ’­æ¶ˆè´¹ã€"),r("OutboundLink")],1),e._v("çš„ç¤ºä¾‹ä»£ç ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-message-model"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_9-1-é›†ç¾¤æ¶ˆè´¹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-é›†ç¾¤æ¶ˆè´¹"}},[e._v("#")]),e._v(" 9.1 é›†ç¾¤æ¶ˆè´¹")]),e._v(" "),r("p",[e._v("åœ¨ RabbitMQ ä¸­ï¼Œå¦‚æœå¤šä¸ª Consumer è®¢é˜…ç›¸åŒçš„ Queue ï¼Œé‚£ä¹ˆæ¯ä¸€æ¡æ¶ˆæ¯æœ‰ä¸”ä»…ä¼šè¢«ä¸€ä¸ª Consumer æ‰€æ¶ˆè´¹ã€‚è¿™ä¸ªç‰¹æ€§ï¼Œå°±ä¸ºæˆ‘ä»¬å®ç°é›†ç¾¤æ¶ˆè´¹æä¾›äº†åŸºç¡€ã€‚")]),e._v(" "),r("p",[e._v("åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠä¸€ä¸ª Queue ä½œä¸ºä¸€ä¸ª Consumer Group ï¼ŒåŒæ—¶åˆ›å»ºæ¶ˆè´¹è¯¥ Queue çš„ Consumer ã€‚è¿™æ ·ï¼Œåœ¨æˆ‘ä»¬å¯åŠ¨å¤šä¸ª JVM è¿›ç¨‹æ—¶ï¼Œå°±ä¼šæœ‰å¤šä¸ª Consumer æ¶ˆè´¹è¯¥ Queue ï¼Œä»è€Œå®ç°é›†ç¾¤æ¶ˆè´¹çš„æ•ˆæœã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œè®©æˆ‘ä»¬å¼€å§‹é›†ç¾¤æ¶ˆè´¹çš„ç¤ºä¾‹ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_9-1-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 9.1.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_9-1-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 9.1.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_9-1-3-clusteringmessage"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-3-clusteringmessage"}},[e._v("#")]),e._v(" 9.1.3 ClusteringMessage")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/ClusteringMessage.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClusteringMessage"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// ClusteringMessage.java\n\npublic class ClusteringMessage implements Serializable {\n\n    public static final String QUEUE = "QUEUE_CLUSTERING";\n\n    public static final String EXCHANGE = "EXCHANGE_CLUSTERING";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å®šä¹‰ RoutingKey çš„æšä¸¾ï¼Œç­”æ¡ˆæˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.6 ClusteringConsumerã€"),r("OutboundLink")],1),e._v("æ­æ™“ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_9-1-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-4-rabbitconfig"}},[e._v("#")]),e._v(" 9.1.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ é›†ç¾¤æ¶ˆè´¹éœ€è¦çš„ Exchange çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * é›†ç¾¤æ¶ˆè´¹çš„ç¤ºä¾‹çš„é…ç½®\n     */\n    public static class ClusteringConfiguration {\n\n        // åˆ›å»º Topic Exchange\n        @Bean\n        public TopicExchange clusteringExchange() {\n            return new TopicExchange(ClusteringMessage.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº† Exchange ç±»å‹æ˜¯ "),r("strong",[e._v("Topic")]),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("ä¸ºä»€ä¹ˆä¸é€‰æ‹© Exchange ç±»å‹æ˜¯ "),r("strong",[e._v("Direct")]),e._v(" å‘¢ï¼Ÿè€ƒè™‘åˆ°é›†ç¾¤æ¶ˆè´¹çš„æ¨¡å¼ï¼Œä¼šå­˜åœ¨å¤š Consumer Group æ¶ˆè´¹çš„æƒ…å†µï¼Œæ˜¾ç„¶æˆ‘ä»¬è¦æ”¯æŒä¸€æ¡æ¶ˆæ¯æŠ•é€’åˆ°å¤šä¸ª Queue ä¸­ï¼Œæ‰€ä»¥ Direct Exchange åŸºæœ¬å°±è¢«æ’é™¤äº†ã€‚")]),e._v(" "),r("p",[e._v("ä¸ºä»€ä¹ˆä¸é€‰æ‹© Exchange ç±»å‹æ˜¯ "),r("strong",[e._v("Fanout")]),e._v(" æˆ–è€… "),r("strong",[e._v("Headers")]),e._v(" å‘¢ï¼Ÿå®é™…æ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡è¯¢é—®äº†æœ‹å‹(didi) "),r("a",{attrs:{href:"https://github.com/spring-cloud/spring-cloud-stream-binder-rabbit",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Cloud Stream RabbitMQ"),r("OutboundLink")],1),e._v(" æ˜¯æ€ä¹ˆå®ç°çš„ã€‚å¾—çŸ¥ç­”æ¡ˆæ˜¯"),r("a",{attrs:{href:"https://raw.githubusercontent.com/spring-cloud/spring-cloud-stream-binder-rabbit/master/docs/src/main/asciidoc/images/rabbit-binder.png",target:"_blank",rel:"noopener noreferrer"}},[e._v("é»˜è®¤"),r("OutboundLink")],1),e._v("æ˜¯ä½¿ç”¨ Topic Exchange çš„ï¼Œæ‰€ä»¥è‰¿è‰¿ç¤ºä¾‹è¿™é‡Œä¹Ÿå°±ä½¿ç”¨ Topic Exchange ç±»å‹äº†ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_9-1-5-clusteringproducer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-5-clusteringproducer"}},[e._v("#")]),e._v(" 9.1.5 ClusteringProducer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/ClusteringProducer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClusteringProducer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// ClusteringProducer.java\n\n@Component\npublic class ClusteringProducer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id) {\n        // åˆ›å»º ClusteringMessage  æ¶ˆæ¯\n        ClusteringMessage message = new ClusteringMessage();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(ClusteringMessage.EXCHANGE, null, message);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.2.3 Demo02Producerã€"),r("OutboundLink")],1),e._v("æ˜¯åŸºæœ¬ä¸€è‡´çš„ï¼Œé™¤äº†è°ƒç”¨ RabbitTemplate å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ä¼ é€’çš„ "),r("code",[e._v("routingKey")]),e._v(" å‚æ•°ä¸º "),r("code",[e._v("null")]),e._v(" ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆæˆ‘ä»¬ä¹Ÿåœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.6 ClusteringConsumerã€"),r("OutboundLink")],1),e._v("æ­æ™“ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_9-1-6-clusteringconsumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-6-clusteringconsumer"}},[e._v("#")]),e._v(" 9.1.6 ClusteringConsumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/ClusteringConsumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClusteringConsumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œ"),r("strong",[e._v("é›†ç¾¤")]),e._v("æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// ClusteringConsumer.java\n\n@Component\n@RabbitListener(\n        bindings = @QueueBinding(\n                value = @Queue(\n                        name = ClusteringMessage.QUEUE + "-" + "GROUP-01"\n                ),\n                exchange = @Exchange(\n                        name = ClusteringMessage.EXCHANGE,\n                        type = ExchangeTypes.TOPIC,\n                        declare = "false"\n                ),\n                key = "#"\n        )\n)\npublic class ClusteringConsumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(ClusteringMessage message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[r("p",[e._v("ç›¸æ¯”å…¶å®ƒ Consumer ç¤ºä¾‹æ¥è¯´ï¼Œè¿™é‡Œæ·»åŠ çš„ "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£å¤æ‚å¾ˆå¤šã€‚")])]),e._v(" "),r("li",[r("p",[e._v("åœ¨ "),r("code",[e._v("bindings")]),e._v(" å±æ€§ï¼Œæˆ‘ä»¬æ·»åŠ äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/annotation/QueueBinding.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@QueueBinding")]),r("OutboundLink")],1),e._v(" æ³¨è§£ï¼Œæ¥å®šä¹‰äº†ä¸€ä¸ª Binding ã€‚é€šè¿‡ "),r("code",[e._v("key")]),e._v(" å±æ€§ï¼Œè®¾ç½®ä½¿ç”¨çš„ RoutingKey ä¸º "),r("code",[e._v("#")]),e._v(" ï¼Œ"),r("strong",[e._v("åŒ¹é…æ‰€æœ‰")]),e._v("ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.3 ClusteringMessageã€"),r("OutboundLink")],1),e._v("æœªå®šä¹‰ RoutingKey ï¼Œä»¥åŠåœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.5 ClusteringProducerã€"),r("OutboundLink")],1),e._v("ä¸­ä½¿ç”¨ "),r("code",[e._v("routingKey = null")]),e._v(" çš„åŸå› ã€‚")])]),e._v(" "),r("li",[r("p",[e._v("åœ¨")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("exchange\n")])])]),r("p",[e._v("å±æ€§ï¼Œæˆ‘ä»¬æ·»åŠ äº†")]),e._v(" "),r("p",[r("code",[e._v("@Exchange")])]),e._v(" "),r("p",[e._v("æ³¨è§£ï¼Œè®¾ç½®äº†å¯¹åº”")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("EXCHANGE_CLUSTERING\n")])])]),r("p",[e._v("è¿™ä¸ª Exchange ã€‚")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("type")]),e._v(" å±æ€§ï¼Œè®¾ç½®æ˜¯ TopicExchange ã€‚")]),e._v(" "),r("li",[r("code",[e._v("declare")]),e._v(" å±æ€§ï¼Œå› ä¸º"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.4 RabbitConfigã€"),r("OutboundLink")],1),e._v("ä¸­ï¼Œå·²ç»é…ç½®åˆ›å»ºè¿™ä¸ª Exchange äº†ã€‚")])])]),e._v(" "),r("li",[r("p",[e._v("åœ¨ "),r("code",[e._v("value")]),e._v(" å±æ€§ï¼Œæˆ‘ä»¬æ·»åŠ äº† "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/annotation/Queue.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@Queue")]),r("OutboundLink")],1),e._v(" æ³¨è§£ï¼Œè®¾ç½®æ¶ˆè´¹ "),r("code",[e._v("QUEUE_CLUSTERING-GROUP-01")]),e._v(" è¿™ä¸ª Queue çš„æ¶ˆæ¯ã€‚")])])]),e._v(" "),r("p",[e._v("æ³¨æ„ï¼Œé€šè¿‡æ·»åŠ  "),r("code",[e._v("@Exchange")]),e._v("ã€"),r("code",[e._v("@Queue")]),e._v("ã€"),r("code",[e._v("@QueueBinding")]),e._v(" æ³¨è§£ï¼Œå¦‚æœæœªå£°æ˜ "),r("code",[e._v('declare="false"')]),e._v(" æ—¶ï¼Œä¼š"),r("strong",[e._v("è‡ªåŠ¨åˆ›å»ºå¯¹åº”")]),e._v("çš„ Exchangeã€Queueã€Binding ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_9-1-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 9.1.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/ClusteringProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClusteringProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç”¨äºæµ‹è¯•é›†ç¾¤æ¶ˆè´¹ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// ClusteringProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class ClusteringProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private ClusteringProducer producer;\n\n    @Test\n    public void mock() throws InterruptedException {\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        // å‘é€ 3 æ¡æ¶ˆæ¯\n        for (int i = 0; i < 3; i++) {\n            int id = (int) (System.currentTimeMillis() / 1000);\n            producer.syncSend(id);\n            logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n        }\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("p",[e._v("é¦–å…ˆï¼Œæ‰§è¡Œ "),r("code",[e._v("#mock()")]),e._v(" æµ‹è¯•æ–¹æ³•ï¼Œå…ˆå¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹ "),r("code",[e._v('"QUEUE_CLUSTERING-GROUP-01"')]),e._v(" è¿™ä¸ª Queue çš„ Consumer èŠ‚ç‚¹ã€‚")]),e._v(" "),r("p",[e._v("ç„¶åï¼Œæ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" æµ‹è¯•æ–¹æ³•ï¼Œå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹ "),r("code",[e._v('"QUEUE_CLUSTERING-GROUP-01"')]),e._v(" è¿™ä¸ª Queue çš„ Consumer èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œè¯¥æµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ "),r("code",[e._v("ClusteringProducer#syncSend(id)")]),e._v(" æ–¹æ³•ï¼ŒåŒæ­¥å‘é€äº† 3 æ¡æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// #### testSyncSend æ–¹æ³•å¯¹åº”çš„æ§åˆ¶å° ####\n\n# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸ\n2019-12-15 22:13:44.372  INFO 43363 --- [           main] c.i.s.l.r.p.ClusteringProducerTest       : [testSyncSend][å‘é€ç¼–å·ï¼š[1576073624] å‘é€æˆåŠŸ]\n2019-12-15 22:13:44.373  INFO 43363 --- [           main] c.i.s.l.r.p.ClusteringProducerTest       : [testSyncSend][å‘é€ç¼–å·ï¼š[1576073624] å‘é€æˆåŠŸ]\n2019-12-15 22:13:44.374  INFO 43363 --- [           main] c.i.s.l.r.p.ClusteringProducerTest       : [testSyncSend][å‘é€ç¼–å·ï¼š[1576073624] å‘é€æˆåŠŸ]\n\n# ClusteringConsumer æ¶ˆè´¹äº† 1 æ¡æ¶ˆæ¯\n2019-12-15 22:13:44.393  INFO 43363 --- [ntContainer#1-1] c.i.s.l.r.consumer.ClusteringConsumer    : [onMessage][çº¿ç¨‹ç¼–å·:19 æ¶ˆæ¯å†…å®¹ï¼šClusteringtMessage{id=1576073624}]\n\n// ### mock æ–¹æ³•å¯¹åº”çš„æ§åˆ¶å° ####\n\n# ClusteringConsumer æ¶ˆè´¹äº† 2 æ¡æ¶ˆæ¯\n2019-12-15 22:13:44.396  INFO 43308 --- [ntContainer#1-1] c.i.s.l.r.consumer.ClusteringConsumer    : [onMessage][çº¿ç¨‹ç¼–å·:19 æ¶ˆæ¯å†…å®¹ï¼šClusteringtMessage{id=1576073624}]\n2019-12-15 22:13:44.398  INFO 43308 --- [ntContainer#1-1] c.i.s.l.r.consumer.ClusteringConsumer    : [onMessage][çº¿ç¨‹ç¼–å·:19 æ¶ˆæ¯å†…å®¹ï¼šClusteringtMessage{id=1576073624}]\n")])])]),r("ul",[r("li",[e._v("3 æ¡æ¶ˆæ¯ï¼Œéƒ½ä»…è¢« "),r("strong",[e._v("ä¸¤ä¸ª")]),e._v(" Consumer èŠ‚ç‚¹çš„"),r("strong",[e._v("ä¸€ä¸ª")]),e._v("è¿›è¡Œæ¶ˆè´¹ã€‚ç¬¦åˆé›†ç¾¤æ¶ˆè´¹çš„é¢„æœŸ~")])]),e._v(" "),r("p",[e._v("å› ä¸ºè€ƒè™‘è®©é›†ç¾¤æ¶ˆè´¹çš„ç¤ºä¾‹åšçš„æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥å¹¶æœªæä¾›ä¸€æ¡æ¶ˆæ¯æŠ•é€’åˆ°å¤šä¸ª Queue ä¸­ï¼Œä»è€Œå®ç°å¤šé›†ç¾¤ä¸‹çš„é›†ç¾¤æ¶ˆè´¹çš„æ•ˆæœã€‚ä¸è¿‡æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹å¯ä»¥è‡ªè¡Œåœ¨åˆ›å»ºä¸€ä¸ªç±»ä¼¼"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.6 ClusteringConsumerã€"),r("OutboundLink")],1),e._v("çš„æ¶ˆè´¹è€…ç±»ï¼Œè®¾ç½®æ¶ˆè´¹å¦å¤–ä¸€ä¸ª Queue å³å¯ã€‚ä¾‹å¦‚è¯´ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('@Component\n@RabbitListener(\n        bindings = @QueueBinding(\n                value = @Queue(\n                        name = ClusteringMessage.QUEUE + "-" + "GROUP-02" // è¿™é‡Œä» "GROUP-01" æ”¹æˆäº† "GROUP-02" ã€‚\n                ),\n                exchange = @Exchange(\n                        name = ClusteringMessage.EXCHANGE,\n                        type = ExchangeTypes.TOPIC,\n                        declare = "false"\n                ),\n                key = "#"\n        )\n)\n')])])]),r("h2",{attrs:{id:"_9-2-å¹¿æ’­æ¶ˆè´¹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-å¹¿æ’­æ¶ˆè´¹"}},[e._v("#")]),e._v(" 9.2 å¹¿æ’­æ¶ˆè´¹")]),e._v(" "),r("p",[e._v("åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1 é›†ç¾¤æ¶ˆè´¹ã€"),r("OutboundLink")],1),e._v("ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡â€œåœ¨ RabbitMQ ä¸­ï¼Œå¦‚æœå¤šä¸ª Consumer è®¢é˜…ç›¸åŒçš„ Queue ï¼Œé‚£ä¹ˆæ¯ä¸€æ¡æ¶ˆæ¯æœ‰ä¸”ä»…ä¼šè¢«ä¸€ä¸ª Consumer æ‰€æ¶ˆè´¹â€ç‰¹æ€§ï¼Œæ¥å®ç°äº†é›†ç¾¤æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨å®ç°å¹¿æ’­æ¶ˆè´¹æ—¶ï¼Œè¿™ä¸ªç‰¹æ€§æ°æ°æˆä¸ºäº†ä¸€ç§é˜»ç¢ã€‚")]),e._v(" "),r("p",[e._v("ä¸è¿‡æœºæ™ºçš„æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™æ¯ä¸ª Consumer åˆ›å»ºä¸€ä¸ªå…¶"),r("strong",[e._v("ç‹¬æœ‰")]),e._v(" Queue ï¼Œä»è€Œä¿è¯éƒ½èƒ½æ¥æ”¶åˆ°å…¨é‡çš„æ¶ˆæ¯ã€‚åŒæ—¶ï¼ŒRabbitMQ æ”¯æŒé˜Ÿåˆ—çš„è‡ªåŠ¨åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ Consumer å…³é—­çš„æ—¶å€™ï¼Œé€šè¿‡è¯¥åŠŸèƒ½åˆ é™¤å…¶"),r("strong",[e._v("ç‹¬æœ‰")]),e._v("çš„ Queue ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œè®©æˆ‘ä»¬å¼€å§‹é›†ç¾¤æ¶ˆè´¹çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ç®€ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥ç»§ç»­åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo"),r("OutboundLink")],1),e._v(" é¡¹ç›®æ”¹é€ ã€‚")]),e._v(" "),r("h3",{attrs:{id:"_9-2-1-broadcastmessage"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-1-broadcastmessage"}},[e._v("#")]),e._v(" 9.2.1 BroadcastMessage")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/BroadcastMessage.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BroadcastMessage"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// BroadcastMessage.java\n\npublic class BroadcastMessage implements Serializable {\n\n    public static final String QUEUE = "QUEUE_BROADCASTING";\n\n    public static final String EXCHANGE = "EXCHANGE_BROADCASTING";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.3 ClusteringMessageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Queue å’Œ Exchange çš„åå­—ä¸åŒã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_9-2-2-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-2-rabbitconfig"}},[e._v("#")]),e._v(" 9.2.2 RabbitConfig")]),e._v(" "),r("p",[e._v("ä¿®æ”¹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ è‡ªå®šä¹‰çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/config/SimpleRabbitListenerContainerFactory.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleRabbitListenerContainerFactory"),r("OutboundLink")],1),e._v(" Bean ï¼Œæ·»åŠ å¹¿æ’­æ¶ˆè´¹éœ€è¦çš„ Exchange çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n/**\n * å¹¿æ’­æ¶ˆè´¹çš„ç¤ºä¾‹çš„é…ç½®\n */\npublic static class BroadcastingConfiguration {\n\n    // åˆ›å»º Topic Exchange\n    @Bean\n    public TopicExchange broadcastingExchange() {\n        return new TopicExchange(BroadcastMessage.EXCHANGE,\n                true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                false);  // exclusive: æ˜¯å¦æ’å®ƒ\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.4 RabbitConfigã€"),r("OutboundLink")],1),e._v("çš„ ClusteringConfiguration é…ç½®ç±»æ˜¯ä¸€è‡´ï¼Œåªæ˜¯åˆ›å»ºäº†ä¸åŒçš„ Exchange ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_9-2-3-broadcastproducer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-3-broadcastproducer"}},[e._v("#")]),e._v(" 9.2.3 BroadcastProducer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/BroadcastProducer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BroadcastProducer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// BroadcastProducer.java\n\n@Component\npublic class BroadcastProducer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id) {\n        // åˆ›å»º BroadcastMessage æ¶ˆæ¯\n        BroadcastMessage message = new BroadcastMessage();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(BroadcastMessage.EXCHANGE, null, message);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.5 ClusteringProducerã€"),r("OutboundLink")],1),e._v("æ˜¯ä¸€è‡´ï¼Œåªæ˜¯ä½¿ç”¨äº†ä¸åŒçš„ Exchange å’Œæ¶ˆæ¯ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_9-2-4-broadcastconsumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-4-broadcastconsumer"}},[e._v("#")]),e._v(" 9.2.4 BroadcastConsumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/ClusteringConsumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BroadcastConsumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œ"),r("strong",[e._v("å¹¿æ’­")]),e._v("æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// BroadcastConsumer.java\n\n@Component\n@RabbitListener(\n        bindings = @QueueBinding(\n                value = @Queue(\n                        name = BroadcastMessage.QUEUE + "-" + "#{T(java.util.UUID).randomUUID()}",\n                        autoDelete = "true"\n                ),\n                exchange = @Exchange(\n                        name = BroadcastMessage.EXCHANGE,\n                        type = ExchangeTypes.TOPIC,\n                        declare = "false"\n                )\n        )\n)\npublic class BroadcastConsumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(BroadcastMessage message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("æ€»ä½“å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9.1.6 ClusteringConsumerã€"),r("OutboundLink")],1),e._v("æ˜¯ä¸€è‡´ï¼Œä¸»è¦å·®å¼‚åœ¨ä¸¤ç‚¹ã€‚")]),e._v(" "),r("li",[e._v("ç¬¬ä¸€ç‚¹ï¼Œåœ¨ "),r("code",[e._v("@Queue")]),e._v(" æ³¨è§£çš„ "),r("code",[e._v("name")]),e._v(" å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡ Spring EL è¡¨è¾¾å¼ï¼Œåœ¨ Queue çš„åå­—ä¸Šï¼Œä½¿ç”¨ UUID ç”Ÿæˆå…¶åç¼€ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯æ¯ä¸ªé¡¹ç›®å¯åŠ¨çš„ Consumer çš„ Queue ä¸åŒï¼Œä»¥è¾¾åˆ°å¹¿æ’­æ¶ˆè´¹çš„ç›®çš„ã€‚")]),e._v(" "),r("li",[e._v("ç¬¬äºŒç‚¹ï¼Œåœ¨ "),r("code",[e._v("@Queue")]),e._v(" æ³¨è§£çš„ "),r("code",[e._v("autoDelete")]),e._v(" å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®ä¸º "),r("code",[e._v('"true"')]),e._v(" ï¼Œè¿™æ ·åœ¨ Consumer å…³é—­æ—¶ï¼Œè¯¥é˜Ÿåˆ—å°±å¯ä»¥è¢«è‡ªåŠ¨åˆ é™¤äº†ã€‚")])]),e._v(" "),r("h3",{attrs:{id:"_9-2-5-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-5-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 9.2.5 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-message-model/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/BroadcastProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BroadcastProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç”¨äºæµ‹è¯•å¹¿æ’­æ¶ˆè´¹ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// BroadcastProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class BroadcastProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private BroadcastProducer producer;\n\n    @Test\n    public void mock() throws InterruptedException {\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("p",[e._v("é¦–å…ˆï¼Œæ‰§è¡Œ "),r("code",[e._v("#mock()")]),e._v(" æµ‹è¯•æ–¹æ³•ï¼Œå…ˆå¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹ "),r("code",[e._v('"QUEUE_BROADCAST-${UUID1}"')]),e._v(" è¿™ä¸ª Queue çš„ Consumer èŠ‚ç‚¹ã€‚")]),e._v(" "),r("p",[e._v("ç„¶åï¼Œæ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" æµ‹è¯•æ–¹æ³•ï¼Œå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹ "),r("code",[e._v('"QUEUE_BROADCAST-${UUID2}"')]),e._v(" è¿™ä¸ª Queue çš„ Consumer èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œè¯¥æµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ "),r("code",[e._v("BroadcastProducer#syncSend(id)")]),e._v(" æ–¹æ³•ï¼ŒåŒæ­¥å‘é€äº† 3 æ¡æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// #### testSyncSend æ–¹æ³•å¯¹åº”çš„æ§åˆ¶å° ####\n\n# Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸ\n2019-12-15 00:11:41.459  INFO 64479 --- [           main] c.i.s.l.r.p.BroadcastProducerTest        : [testSyncSend][å‘é€ç¼–å·ï¼š[1576080701] å‘é€æˆåŠŸ]\n2019-12-15 00:11:41.460  INFO 64479 --- [           main] c.i.s.l.r.p.BroadcastProducerTest        : [testSyncSend][å‘é€ç¼–å·ï¼š[1576080701] å‘é€æˆåŠŸ]\n2019-12-15 00:11:41.461  INFO 64479 --- [           main] c.i.s.l.r.p.BroadcastProducerTest        : [testSyncSend][å‘é€ç¼–å·ï¼š[1576080701] å‘é€æˆåŠŸ]\n\n# BroadcastConsumer æ¶ˆè´¹äº† 3 æ¡æ¶ˆæ¯\n2019-12-15 00:11:41.478  INFO 64479 --- [ntContainer#0-1] c.i.s.l.r.consumer.BroadcastConsumer     : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šBroadcastMessage{id=1576080701}]\n2019-12-15 00:11:41.479  INFO 64479 --- [ntContainer#0-1] c.i.s.l.r.consumer.BroadcastConsumer     : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šBroadcastMessage{id=1576080701}]\n2019-12-15 00:11:41.480  INFO 64479 --- [ntContainer#0-1] c.i.s.l.r.consumer.BroadcastConsumer     : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šBroadcastMessage{id=1576080701}]\n\n// ### mock æ–¹æ³•å¯¹åº”çš„æ§åˆ¶å° ####\n\n# BroadcastConsumer ä¹Ÿæ¶ˆè´¹äº† 3 æ¡æ¶ˆ\n2019-12-15 00:11:41.460  INFO 63795 --- [ntContainer#0-1] c.i.s.l.r.consumer.BroadcastConsumer     : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šBroadcastMessage{id=1576080701}]\n2019-12-15 00:11:41.462  INFO 63795 --- [ntContainer#0-1] c.i.s.l.r.consumer.BroadcastConsumer     : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šBroadcastMessage{id=1576080701}]\n2019-12-15 00:11:41.462  INFO 63795 --- [ntContainer#0-1] c.i.s.l.r.consumer.BroadcastConsumer     : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šBroadcastMessage{id=1576080701}]\n")])])]),r("ul",[r("li",[r("strong",[e._v("ä¸¤ä¸ª")]),e._v(" Consumer èŠ‚ç‚¹ï¼Œéƒ½æ¶ˆè´¹äº†è¿™æ¡å‘é€çš„æ¶ˆæ¯ã€‚ç¬¦åˆå¹¿æ’­æ¶ˆè´¹çš„é¢„æœŸ~")])]),e._v(" "),r("h1",{attrs:{id:"_10-å¹¶å‘æ¶ˆè´¹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-å¹¶å‘æ¶ˆè´¹"}},[e._v("#")]),e._v(" 10. å¹¶å‘æ¶ˆè´¹")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-concurrency"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é…ç½®çš„æ¯ä¸€ä¸ª Spring-AMQP "),r("code",[e._v("@RabbitListener")]),e._v(" ï¼Œéƒ½æ˜¯"),r("strong",[e._v("ä¸²è¡Œ")]),e._v("æ¶ˆè´¹çš„ã€‚æ˜¾ç„¶ï¼Œè¿™åœ¨ç›‘å¬çš„ Queue æ¯ç§’æ¶ˆæ¯é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹ä¸åŠæ—¶ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ã€‚")]),e._v(" "),r("p",[e._v("è™½ç„¶è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ª JVM è¿›ç¨‹ï¼Œå®ç°"),r("strong",[e._v("å¤šè¿›ç¨‹çš„å¹¶å‘æ¶ˆè´¹")]),e._v("ï¼Œä»è€ŒåŠ é€Ÿæ¶ˆè´¹çš„é€Ÿåº¦ã€‚ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¦èƒ½å¤Ÿå®ç°"),r("strong",[e._v("å¤šçº¿ç¨‹")]),e._v("çš„å¹¶å‘æ¶ˆè´¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯"),r("strong",[e._v("æœ‰")]),e._v("ã€‚")]),e._v(" "),r("p",[e._v("åœ¨ "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ä¸­ï¼Œæœ‰ "),r("code",[e._v("concurrency")]),e._v(" å±æ€§ï¼Œå®ƒå¯ä»¥æŒ‡å®šå¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°ã€‚ä¾‹å¦‚è¯´ï¼Œå¦‚æœè®¾ç½® "),r("code",[e._v("concurrency=4")]),e._v(" æ—¶ï¼ŒSpring-AMQP å°±ä¼šä¸º"),r("strong",[e._v("è¯¥")]),e._v(" "),r("code",[e._v("@RabbitListener")]),e._v(" åˆ›å»º 4 ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ¶ˆè´¹ã€‚")]),e._v(" "),r("p",[e._v("è€ƒè™‘åˆ°è®©èƒ–å‹èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ "),r("code",[e._v("concurrency")]),e._v(" å±æ€§ï¼Œæˆ‘ä»¬æ¥ç®€å•è¯´è¯´ Spring-AMQP åœ¨è¿™å—çš„å®ç°æ–¹å¼ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Queue ä¸º "),r("code",[e._v('"DEMO_09"')]),e._v(" ã€‚")]),e._v(" "),r("li",[e._v("ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Demo9Consumer ç±»ï¼Œå¹¶åœ¨å…¶æ¶ˆè´¹æ–¹æ³•ä¸Šï¼Œæ·»åŠ  "),r("code",[e._v("@RabbitListener(concurrency=2)")]),e._v(" æ³¨è§£ã€‚")]),e._v(" "),r("li",[e._v("å†ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨é¡¹ç›®ã€‚Spring-AMQP ä¼šæ ¹æ® "),r("code",[e._v("@RabbitListener(concurrency=2)")]),e._v(" æ³¨è§£ï¼Œåˆ›å»º "),r("strong",[e._v("2")]),e._v(" ä¸ª RabbitMQ Consumer ã€‚æ³¨æ„å™¢ï¼Œæ˜¯ "),r("strong",[e._v("2")]),e._v(" ä¸ª RabbitMQ Consumer å‘¢ï¼ï¼ï¼åç»­ï¼Œæ¯ä¸ª RabbitMQ Consumer ä¼šè¢«"),r("strong",[e._v("å•ç‹¬")]),e._v("åˆ†é…åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè¿›è¡Œæ‹‰å–æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚")])]),e._v(" "),r("p",[e._v("é…±ç´«è®²è§£ä¸€ä¸‹ï¼Œèƒ–å‹å¯¹ Spring-AMQP å®ç°"),r("strong",[e._v("å¤šçº¿ç¨‹")]),e._v("çš„å¹¶å‘æ¶ˆè´¹çš„æœºåˆ¶ï¼Œæ˜¯å¦ç†è§£äº†ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚æœ¬ç¤ºä¾‹å°±æ˜¯ä¸Šè¿°ä¸¾ä¾‹çš„å…·ä½“å®ç°ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-concurrency"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 10.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 10.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("åœ¨å¼€å§‹çœ‹å…·ä½“çš„åº”ç”¨é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†äº†è§£ä¸‹ Spring-AMQP çš„ä¸¤ä¸ª "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java#L566-L579",target:"_blank",rel:"noopener noreferrer"}},[e._v("ContainerType"),r("OutboundLink")],1),e._v(" å®¹å™¨ç±»å‹ï¼Œæšä¸¾å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitProperties.java\n\npublic enum ContainerType {\n\n\t/**\n\t * Container where the RabbitMQ consumer dispatches messages to an invoker thread.\n\t */\n\tSIMPLE,\n\n\t/**\n\t * Container where the listener is invoked directly on the RabbitMQ consumer\n\t * thread.\n\t */\n\tDIRECT\n\n}\n")])])]),r("p",[e._v("â‘  ç¬¬ä¸€ç§ç±»å‹ï¼Œ"),r("code",[e._v("SIMPLE")]),e._v(" å¯¹åº” "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SimpleMessageListenerContainer"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç›‘å¬å™¨å®¹å™¨ã€‚å®ƒä¸€å…±æœ‰ä¸¤"),r("strong",[e._v("ç±»")]),e._v("çº¿ç¨‹ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("Consumer çº¿ç¨‹ï¼Œè´Ÿè´£ä» RabbitMQ Broker è·å– Queue ä¸­çš„æ¶ˆæ¯ï¼Œå­˜å‚¨åˆ°"),r("strong",[e._v("å†…å­˜ä¸­")]),e._v("çš„ "),r("a",{attrs:{href:"https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/java/util/concurrent/BlockingQueue.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("BlockingQueue"),r("OutboundLink")],1),e._v(" é˜»å¡é˜Ÿåˆ—ä¸­ã€‚")]),e._v(" "),r("li",[e._v("Listener çº¿ç¨‹ï¼Œè´Ÿè´£ä»"),r("strong",[e._v("å†…å­˜ä¸­")]),e._v("çš„ BlockingQueue è·å–æ¶ˆæ¯ï¼Œè¿›è¡Œæ¶ˆè´¹é€»è¾‘ã€‚")])]),e._v(" "),r("p",[e._v("æ³¨æ„ï¼Œæ¯ä¸€ä¸ª Consumer çº¿ç¨‹ï¼Œå¯¹åº”ä¸€ä¸ª RabbitMQ Consumer ï¼Œå¯¹åº”ä¸€ä¸ª Listener çº¿ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸‰è€…æ˜¯"),r("strong",[e._v("ä¸€ä¸€å¯¹åº”")]),e._v("çš„ã€‚")]),e._v(" "),r("p",[e._v("â‘¡ ç¬¬äºŒç§ç±»å‹ï¼Œ"),r("code",[e._v("DIRECT")]),e._v(" å¯¹åº” "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/listener/DirectMessageListenerContainer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DirectMessageListenerContainer"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç›‘å¬å™¨å®¹å™¨ã€‚å®ƒåªæœ‰"),r("strong",[e._v("ä¸€ç±»")]),e._v("çº¿ç¨‹ï¼Œå³åš "),r("code",[e._v("SIMPLE")]),e._v(" çš„ Consumer çº¿ç¨‹çš„å·¥ä½œï¼Œä¹Ÿåš "),r("code",[e._v("SIMPLE")]),e._v(" çš„ Listener çº¿ç¨‹å·¥ä½œã€‚")]),e._v(" "),r("p",[e._v("æ³¨æ„ï¼Œå› ä¸ºåªæœ‰"),r("strong",[e._v("ä¸€ç±»")]),e._v("çº¿ç¨‹ï¼Œæ‰€ä»¥å®ƒè¦ä¹ˆæ­£åœ¨è·å–æ¶ˆæ¯ï¼Œè¦ä¹ˆæ­£åœ¨æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯"),r("strong",[e._v("ä¸²è¡Œ")]),e._v("çš„ã€‚")]),e._v(" "),r("p",[e._v("ğŸ”¥ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring-AMQP é€‰æ‹©ä½¿ç”¨ç¬¬ä¸€ç§ç±»å‹ï¼Œå³ "),r("code",[e._v("SIMPLE")]),e._v(" å®¹å™¨ç±»å‹ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("spring:\n  # RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»\n  rabbitmq:\n    host: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\n    port: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\n    username: guest # RabbitMQ æœåŠ¡çš„è´¦å·\n    password: guest # RabbitMQ æœåŠ¡çš„å¯†ç \n    listener:\n      type: simple # é€‰æ‹©çš„ ListenerContainer çš„ç±»å‹ã€‚é»˜è®¤ä¸º simple ç±»å‹\n      simple:\n        concurrency: 2 # æ¯ä¸ª @ListenerContainer çš„å¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°\n        max-concurrency: 10 # æ¯ä¸ª @ListenerContainer å…è®¸çš„å¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°\n#      direct:\n#        consumers-per-queue: 2 # å¯¹äºæ¯ä¸€ä¸ª @RabbitListener ï¼Œä¸€ä¸ª Queue ï¼Œå¯¹åº”åˆ›å»ºå‡ ä¸ª Consumer ã€‚\n")])])]),r("ul",[r("li",[r("p",[e._v("ç›¸æ¯”")]),e._v(" "),r("p",[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€")]),e._v(" "),r("p",[e._v("æ¥è¯´ï¼Œé¢å¤–ä¸‰ä¸ªå‚æ•°ï¼š")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("spring.rabbitmq.listener.type")])]),e._v(" "),r("li",[r("code",[e._v("spring.rabbitmq.listener.simple.concurrency")])]),e._v(" "),r("li",[r("code",[e._v("spring.rabbitmq.listener.simple.max-concurrency")])])])])]),e._v(" "),r("p",[e._v("è¦"),r("strong",[e._v("æ³¨æ„")]),e._v("ï¼Œæ˜¯ "),r("code",[e._v("spring.rabbitmq.listener.simple.max-concurrency")]),e._v(" é…ç½®ï¼Œæ˜¯"),r("strong",[e._v("é™åˆ¶")]),e._v("æ¯ä¸ª "),r("code",[e._v("@RabbitListener")]),e._v(" çš„"),r("strong",[e._v("å…è®¸")]),e._v("é…ç½®çš„ "),r("code",[e._v("concurrency")]),e._v(" æœ€å¤§å¤§å°ã€‚å¦‚æœè¶…è¿‡ï¼Œåˆ™ä¼šæŠ›å‡º IllegalArgumentException å¼‚å¸¸ã€‚åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ10.6 Demo09Consumerã€"),r("OutboundLink")],1),e._v("ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ï¼Œæœ‰ä¸€ä¸ª "),r("code",[e._v("concurrency")]),e._v(" å±æ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰æ¯ä¸ª "),r("code",[e._v("@RabbitListener")]),e._v(" çš„å¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-3-demo09message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-demo09message"}},[e._v("#")]),e._v(" 10.3 Demo09Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo09Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo09Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-rabbitconfig"}},[e._v("#")]),e._v(" 10.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œé…ç½®ç›¸å…³çš„ Exchangeã€Queueã€Binding ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.5 RabbitConfigã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-5-demo09producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-5-demo09producer"}},[e._v("#")]),e._v(" 10.5 Demo09Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo09Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo09Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-6-demo09consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-6-demo09consumer"}},[e._v("#")]),e._v(" 10.6 Demo09Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo09Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo09Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo06Consumer.java\n\n@Component\n@RabbitListener(queues = Demo09Message.QUEUE,\n    concurrency = "2")\npublic class Demo09Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo09Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.7 Demo01Consumerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªå·®åœ¨æ¶ˆè´¹ä¸åŒçš„é˜Ÿåˆ—ã€‚")]),e._v(" "),r("li",[e._v("å¦å¤–ï¼Œå¯ä»¥é€šè¿‡ "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ï¼Œè®¾ç½®å¹¶å‘æ•°ã€‚ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¯è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„ "),r("code",[e._v("spring.rabbitmq.listener.simple.concurrency")]),e._v(" é…ç½®é¡¹ã€‚")])]),e._v(" "),r("p",[e._v("ä¸è¿‡ä¸ªäººå»ºè®®ï¼Œè¿˜æ˜¯æ¯ä¸ª "),r("code",[e._v("@RabbitListener")]),e._v(" å„è‡ªé…ç½®ï¼Œæ¯•ç«Ÿæ¯ä¸ª Queue çš„æ¶ˆæ¯æ•°é‡ï¼Œéƒ½æ˜¯ä¸åŒçš„ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç»“åˆä½¿ç”¨ ğŸ˜ˆ ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_10-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 10.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-concurrency/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo09ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo09ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œå‘é€ 10 æ¡æ¶ˆæ¯ï¼Œè§‚å¯Ÿå¹¶å‘æ¶ˆè´¹æƒ…å†µã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo09ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo09ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo09Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        for (int i = 0; i < 10; i++) {\n            int id = (int) (System.currentTimeMillis() / 1000);\n            producer.syncSend(id);\n//            logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n        }\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("p",[e._v("æ‰§è¡Œå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# çº¿ç¨‹ç¼–å·ä¸º 17\n2019-12-15 10:48:20.013  INFO 2937 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.015  INFO 2937 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.016  INFO 2937 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.017  INFO 2937 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.017  INFO 2937 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n\n# çº¿ç¨‹ç¼–å· 18\n2019-12-15 10:48:20.013  INFO 2937 --- [ntContainer#0-2] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.015  INFO 2937 --- [ntContainer#0-2] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.016  INFO 2937 --- [ntContainer#0-2] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.016  INFO 2937 --- [ntContainer#0-2] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n2019-12-15 10:48:20.017  INFO 2937 --- [ntContainer#0-2] c.i.s.l.r.consumer.Demo09Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo09Message{id=1576118899}]\n")])])]),r("ul",[r("li",[e._v("æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªçº¿ç¨‹åœ¨æ¶ˆè´¹ "),r("code",[e._v('"QUEUE_DEMO_09"')]),e._v(" ä¸‹çš„æ¶ˆæ¯ã€‚")])]),e._v(" "),r("p",[e._v("æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ "),r("a",{attrs:{href:"https://www.rabbitmq.com/management.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitMQ Management"),r("OutboundLink")],1),e._v(" æ¥æŸ¥çœ‹ "),r("code",[e._v('"QUEUE_DEMO_09"')]),e._v(" çš„æ¶ˆè´¹è€…åˆ—è¡¨ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/01.png",alt:""}})]),e._v(" "),r("h1",{attrs:{id:"_11-é¡ºåºæ¶ˆæ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-é¡ºåºæ¶ˆæ¯"}},[e._v("#")]),e._v(" 11. é¡ºåºæ¶ˆæ¯")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-orderly"),r("OutboundLink")],1)])]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å…ˆæ¥ä¸€èµ·äº†è§£ä¸‹é¡ºåºæ¶ˆæ¯çš„"),r("strong",[e._v("é¡ºåºæ¶ˆæ¯")]),e._v("çš„å®šä¹‰ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("æ™®é€šé¡ºåºæ¶ˆæ¯ ï¼šProducer å°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ°ç›¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚")]),e._v(" "),r("li",[e._v("å®Œå…¨ä¸¥æ ¼é¡ºåº ï¼šåœ¨ã€æ™®é€šé¡ºåºæ¶ˆæ¯ã€‘çš„åŸºç¡€ä¸Šï¼ŒConsumer ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ã€‚")])]),e._v(" "),r("p",[e._v("é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥æ€è€ƒä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ RabbitMQ ä¸Šï¼Œå®ç°é¡ºåºæ¶ˆæ¯éœ€è¦åšä¸¤ä¸ªäº‹æƒ…ã€‚")]),e._v(" "),r("p",[e._v("â‘  "),r("strong",[e._v("äº‹æƒ…ä¸€")]),e._v("ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ RabbitMQ Producer å‘é€ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ°ç›¸åŒçš„ Queue ä¸­ã€‚ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬è¦å‘é€ç”¨æˆ·ä¿¡æ¯å‘ç”Ÿå˜æ›´çš„ Message ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨é¡ºåºæ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†"),r("strong",[e._v("ç”¨æˆ·ç¼–å·")]),e._v("ç›¸åŒçš„æ¶ˆæ¯å‘é€åˆ°ç›¸åŒçš„ Queue ä¸­ã€‚")]),e._v(" "),r("p",[e._v("â‘¡ "),r("strong",[e._v("äº‹æƒ…äºŒ")]),e._v("ï¼Œæˆ‘ä»¬åœ¨æœ‰"),r("strong",[e._v("ä¸”ä»…å¯åŠ¨ä¸€ä¸ª")]),e._v(" Consumer æ¶ˆè´¹è¯¥é˜Ÿåˆ—ï¼Œä¿è¯ Consumer ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ã€‚")]),e._v(" "),r("p",[e._v("ä¸è¿‡å¦‚æœè¿™æ ·åšï¼Œä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€ä¸ªæ¥çœ‹çœ‹ã€‚")]),e._v(" "),r("p",[e._v("â‘  "),r("strong",[e._v("é—®é¢˜ä¸€")]),e._v("ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ10. å¹¶å‘æ¶ˆè´¹ã€"),r("OutboundLink")],1),e._v("ä¸­æåˆ°ï¼Œå¦‚æœæˆ‘ä»¬å°†æ¶ˆæ¯ä»…ä»…æŠ•é€’åˆ°ä¸€ä¸ª Queue ä¸­ï¼Œå¹¶ä¸”é‡‡ç”¨å•ä¸ª Consumer "),r("strong",[e._v("ä¸²è¡Œ")]),e._v("æ¶ˆè´¹ï¼Œåœ¨ç›‘å¬çš„ Queue æ¯ç§’æ¶ˆæ¯é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹ä¸åŠæ—¶ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ã€‚")]),e._v(" "),r("p",[e._v("æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ¡ˆæ¥è§£å†³ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("æ–¹æ¡ˆä¸€ï¼Œåœ¨ Producer ç«¯ï¼Œå°† Queue æ‹†æˆå¤šä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue ã€‚å‡è®¾åŸå…ˆ Queue æ˜¯ "),r("code",[e._v("QUEUE_USER")]),e._v(" ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆ†æ‹†æˆ "),r("code",[e._v("QUEUE_USER_00")]),e._v(" è‡³ "),r("code",[e._v("QUEUE_USER_..${N-1}")]),e._v(" è¿™æ · N ä¸ªé˜Ÿåˆ—ï¼Œç„¶ååŸºäºæ¶ˆæ¯çš„ç”¨æˆ·ç¼–å·å–ä½™ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„"),r("strong",[e._v("å­")]),e._v(" Queue ä¸­ã€‚")]),e._v(" "),r("li",[e._v("æ–¹æ¡ˆäºŒï¼Œåœ¨ Consumer ç«¯ï¼Œå°† Queue æ‹‰å–åˆ°çš„æ¶ˆæ¯ï¼Œå°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ°"),r("strong",[e._v("ç›¸åŒçš„çº¿ç¨‹")]),e._v("ä¸­æ¥æ¶ˆè´¹ã€‚ä¾‹å¦‚è¯´ï¼Œè¿˜æ˜¯ Queue æ˜¯ "),r("code",[e._v("QUEUE_USER")]),e._v(" çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ›å»º N ä¸ªçº¿ç¨‹æ± å¤§å°ä¸º 1 çš„ "),r("a",{attrs:{href:"https://github.com/JetBrains/jdk8u_jdk/blob/master/src/share/classes/java/util/concurrent/ExecutorService.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ExecutorService"),r("OutboundLink")],1),e._v(" æ•°ç»„ï¼Œç„¶ååŸºäºæ¶ˆæ¯çš„ç”¨æˆ·ç¼–å·å–ä½™ï¼Œæäº¤åˆ°å¯¹åº”çš„ ExecutorService ä¸­çš„å•ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚")])]),e._v(" "),r("p",[e._v("ä¸¤ä¸ªæ–¹æ¡ˆï¼Œå¹¶ä¸å†²çªï¼Œå¯ä»¥ç»“åˆä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("â‘¡ "),r("strong",[e._v("é—®é¢˜äºŒ")]),e._v("ï¼Œå¦‚æœæˆ‘ä»¬å¯åŠ¨ç›¸åŒ Consumer çš„"),r("strong",[e._v("å¤šä¸ªè¿›ç¨‹")]),e._v("ï¼Œä¼šå¯¼è‡´ç›¸åŒ Queue çš„æ¶ˆæ¯è¢«åˆ†é…åˆ°å¤šä¸ª Consumer è¿›è¡Œæ¶ˆè´¹ï¼Œç ´å Consumer ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ã€‚")]),e._v(" "),r("p",[e._v("æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ¡ˆæ¥è§£å†³ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("æ–¹æ¡ˆä¸€ï¼Œå¼•å…¥ ZooKeeper æ¥åè°ƒï¼ŒåŠ¨æ€è®¾ç½®å¤šä¸ªè¿›ç¨‹ä¸­çš„"),r("strong",[e._v("ç›¸åŒçš„")]),e._v(" Consumer çš„å¼€å…³ï¼Œä¿è¯æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª Consumer å¼€å¯å¯¹"),r("strong",[e._v("åŒä¸€ä¸ª")]),e._v(" Queue çš„æ¶ˆè´¹ã€‚")]),e._v(" "),r("li",[e._v("æ–¹æ¡ˆäºŒï¼Œä»…é€‚ç”¨äºã€é—®é¢˜ä¸€ã€‘çš„ã€æ–¹æ¡ˆä¸€ã€‘ã€‚è¿˜æ˜¯å¼•å…¥ ZooKeeper æ¥åè°ƒï¼ŒåŠ¨æ€è®¾ç½®å¤šä¸ªè¿›ç¨‹ä¸­çš„"),r("strong",[e._v("ç›¸åŒçš„")]),e._v(" Consumer æ¶ˆè´¹çš„ Queue çš„åˆ†é…ï¼Œä¿è¯æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª Consumer å¼€å¯å¯¹"),r("strong",[e._v("åŒä¸€ä¸ª")]),e._v(" Queue çš„æ¶ˆè´¹ã€‚")])]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚æœ¬ç¤ºä¾‹å°±æ˜¯ä¸Šè¿°ä¸¾ä¾‹çš„å…·ä½“å®ç°ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-orderly"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("å¯¹äºé—®é¢˜ä¸€ï¼Œæˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆä¸€ã€‚å› ä¸ºåœ¨ Spring-AMQP ä¸­ï¼Œè‡ªå·±å®šä¹‰çº¿ç¨‹æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œæ— æ³•å’Œç°æœ‰çš„ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-framework/blob/master/spring-jms/src/main/java/org/springframework/jms/listener/MessageListenerContainer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MessageListenerContainer"),r("OutboundLink")],1),e._v(" çš„å®ç°æ‰€ç»“åˆï¼Œé™¤éè‡ªå®šä¹‰ä¸€ä¸ª MessageListenerContainer å®ç°ç±»ã€‚")]),e._v(" "),r("li",[e._v("å¯¹äºé—®é¢˜äºŒï¼Œå› ä¸ºå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæš‚æ—¶å…ˆä¸æä¾›ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_11-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 11.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_11-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 11.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_11-3-demo10message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-demo10message"}},[e._v("#")]),e._v(" 11.3 Demo10Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo10Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo10Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo10Message.java\n\npublic class Demo10Message implements Serializable {\n\n    private static final String QUEUE_BASE = "QUEUE_DEMO_10-";\n    public static final String QUEUE_0 = QUEUE_BASE + "0";\n    public static final String QUEUE_1 = QUEUE_BASE + "1";\n    public static final String QUEUE_2 = QUEUE_BASE + "2";\n    public static final String QUEUE_3 = QUEUE_BASE + "3";\n\n    public static final int QUEUE_COUNT = 4;\n\n    public static final String EXCHANGE = "EXCHANGE_DEMO_10";\n\n    /**\n     * ç¼–å·\n     */\n    private Integer id;\n\n    // ... çœç•¥ set/get/toString æ–¹æ³•\n\n}\n')])])]),r("ul",[r("li",[e._v("å®šä¹‰äº† "),r("code",[e._v("QUEUE_DEMO_10-")]),e._v(" çš„å››ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue ã€‚")]),e._v(" "),r("li",[e._v("å®šä¹‰äº†ç»Ÿä¸€çš„ Exchange ã€‚")]),e._v(" "),r("li",[e._v("æš‚æœªå®šä¹‰ RoutingKey çš„åå­—ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨â€œé˜Ÿåˆ—ç¼–å·â€ä½œä¸º RoutingKey ï¼Œç„¶åè·¯ç”±æ¶ˆæ¯åˆ°æ¯ä¸ªå­ Queue ä¸­ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_11-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-4-rabbitconfig"}},[e._v("#")]),e._v(" 11.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œæ·»åŠ  Direct Exchange ç¤ºä¾‹ç›¸å…³çš„ Exchangeã€Queueã€Binding çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// RabbitConfig.java\n\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo10Queue0() {\n            return new Queue(Demo10Message.QUEUE_0);\n        }\n        @Bean\n        public Queue demo10Queue1() {\n            return new Queue(Demo10Message.QUEUE_1);\n        }\n        @Bean\n        public Queue demo10Queue2() {\n            return new Queue(Demo10Message.QUEUE_2);\n        }\n        @Bean\n        public Queue demo10Queue3() {\n            return new Queue(Demo10Message.QUEUE_3);\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo10Exchange() {\n            return new DirectExchange(Demo10Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        @Bean\n        public Binding demo10Binding0() {\n            return BindingBuilder.bind(demo10Queue0()).to(demo10Exchange()).with("0");\n        }\n        @Bean\n        public Binding demo10Binding1() {\n            return BindingBuilder.bind(demo10Queue1()).to(demo10Exchange()).with("1");\n        }\n        @Bean\n        public Binding demo10Binding2() {\n            return BindingBuilder.bind(demo10Queue2()).to(demo10Exchange()).with("2");\n        }\n        @Bean\n        public Binding demo10Binding3() {\n            return BindingBuilder.bind(demo10Queue3()).to(demo10Exchange()).with("3");\n        }\n\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("é¦–å…ˆï¼Œåˆ›å»ºäº†å››ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue ã€‚")]),e._v(" "),r("li",[e._v("ç„¶åï¼Œåˆ›å»ºäº†ä¸€ä¸ª Exchange ã€‚")]),e._v(" "),r("li",[e._v("æœ€åï¼Œåˆ›å»ºäº†å››ä¸ª Bingding ï¼Œå¯¹åº”æ¯ä¸€ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue ï¼ŒRoutingKey ä¸ºé˜Ÿåˆ—ç¼–å·ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_11-5-demo10producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-demo10producer"}},[e._v("#")]),e._v(" 11.5 Demo10Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo01Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo01Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯åˆ°"),r("strong",[e._v("å­")]),e._v(" Queue ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Demo10Producer.java\n\n@Component\npublic class Demo10Producer {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    public void syncSend(Integer id) {\n        // åˆ›å»º Demo10Message æ¶ˆæ¯\n        Demo10Message message = new Demo10Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo10Message.EXCHANGE, this.getRoutingKey(id), message);\n    }\n\n    private String getRoutingKey(Integer id) {\n        return String.valueOf(id % Demo10Message.QUEUE_COUNT);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬å¯¹ "),r("code",[e._v("Demo10Message.id % é˜Ÿåˆ—ç¼–å·")]),e._v(" è¿›è¡Œå–ä½™ï¼Œè·å¾—"),r("strong",[e._v("é˜Ÿåˆ—ç¼–å·")]),e._v("ä½œä¸º RoutingKey ï¼Œä»è€Œè·¯ç”±æ¶ˆæ¯åˆ°å¯¹åº”çš„"),r("strong",[e._v("å­")]),e._v(" Queue ä¸­ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_11-6-demo10consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-6-demo10consumer"}},[e._v("#")]),e._v(" 11.6 Demo10Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo10Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo10Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œ"),r("strong",[e._v("ä¸¥æ ¼")]),e._v("æ¶ˆè´¹"),r("strong",[e._v("é¡ºåº")]),e._v("æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo10Consumer.java\n\n@Component\n@RabbitListener(queues = Demo10Message.QUEUE_0)\n@RabbitListener(queues = Demo10Message.QUEUE_1)\n@RabbitListener(queues = Demo10Message.QUEUE_2)\n@RabbitListener(queues = Demo10Message.QUEUE_3)\npublic class Demo10Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler(isDefault = true)\n    public void onMessage(Message<Demo10Message> message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} Queue:{} æ¶ˆæ¯ç¼–å·ï¼š{}]", Thread.currentThread().getId(), getQueue(message),\n                message.getPayload().getId());\n    }\n\n    private static String getQueue(Message<Demo10Message> message) {\n        return message.getHeaders().get("amqp_consumerQueue", String.class);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("ä¸ºäº†å®ç°æ¯ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue èƒ½å¤Ÿè¢«æ¯ä¸ª Consumer "),r("strong",[e._v("ä¸²è¡Œ")]),e._v("æ¶ˆè´¹ï¼Œä»è€Œå®ç°åŸºäº"),r("strong",[e._v("å­")]),e._v(" Queue çš„"),r("strong",[e._v("å¹¶è¡Œ")]),e._v("çš„"),r("strong",[e._v("ä¸¥æ ¼")]),e._v("æ¶ˆè´¹"),r("strong",[e._v("é¡ºåº")]),e._v("æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªå¥½åœ¨ç±»ä¸Šæ·»äº†å››ä¸ª "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ï¼Œæ¯ä¸ªå¯¹åº”ä¸€ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue ã€‚")]),e._v(" "),r("li",[e._v("å¦‚æœèƒ–å‹ä½¿ç”¨ä¸€ä¸ª "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ï¼Œå¹¶æ·»åŠ å››ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue ï¼Œç„¶åè®¾ç½® "),r("code",[e._v("concurrency = 4")]),e._v(" æ—¶ï¼Œå®é™…æ˜¯å¹¶å‘å››ä¸ªçº¿ç¨‹ï¼Œæ¶ˆè´¹å››ä¸ª"),r("strong",[e._v("å­")]),e._v(" Queue çš„æ¶ˆæ¯ï¼Œæ— æ³•ä¿è¯"),r("strong",[e._v("ä¸¥æ ¼")]),e._v("æ¶ˆè´¹"),r("strong",[e._v("é¡ºåº")]),e._v("æ¶ˆæ¯ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_11-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_11-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 11.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-orderly/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo10ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo10ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œå‘é€ 8 æ¡æ¶ˆæ¯ï¼Œè§‚å¯Ÿé¡ºåºæ¶ˆè´¹æƒ…å†µã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo10ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo10ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo10Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        for (int i = 0; i < 2; i++) {\n            for (int id = 0; id < 4; id++) {\n                producer.syncSend(id);\n//            logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n            }\n        }\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("å‘é€ 2 è½®æ¶ˆæ¯ï¼Œæ¯ä¸€è½®æ¶ˆæ¯çš„ç¼–å·éƒ½æ˜¯ 0 è‡³ 3 ã€‚")])]),e._v(" "),r("p",[e._v("æ‰§è¡Œå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# çº¿ç¨‹ç¼–å·ä¸º 21\n2019-12-15 20:04:59.262  INFO 99104 --- [ntContainer#2-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:21 Queue:QUEUE_DEMO_10-2 æ¶ˆæ¯ç¼–å·ï¼š2]\n2019-12-15 20:04:59.265  INFO 99104 --- [ntContainer#2-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:21 Queue:QUEUE_DEMO_10-2 æ¶ˆæ¯ç¼–å·ï¼š2]\n\n# çº¿ç¨‹ç¼–å·ä¸º 17\n2019-12-15 20:04:59.262  INFO 99104 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 Queue:QUEUE_DEMO_10-0 æ¶ˆæ¯ç¼–å·ï¼š0]\n2019-12-15 20:04:59.265  INFO 99104 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 Queue:QUEUE_DEMO_10-0 æ¶ˆæ¯ç¼–å·ï¼š0]\n\n# çº¿ç¨‹ç¼–å·ä¸º 23\n2019-12-15 20:04:59.262  INFO 99104 --- [ntContainer#3-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:23 Queue:QUEUE_DEMO_10-3 æ¶ˆæ¯ç¼–å·ï¼š3]\n2019-12-15 20:04:59.265  INFO 99104 --- [ntContainer#3-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:23 Queue:QUEUE_DEMO_10-3 æ¶ˆæ¯ç¼–å·ï¼š3]\n\n# çº¿ç¨‹ç¼–å·ä¸º 19\n2019-12-15 20:04:59.262  INFO 99104 --- [ntContainer#1-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:19 Queue:QUEUE_DEMO_10-1 æ¶ˆæ¯ç¼–å·ï¼š1]\n2019-12-15 20:04:59.265  INFO 99104 --- [ntContainer#1-1] c.i.s.l.r.consumer.Demo10Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:19 Queue:QUEUE_DEMO_10-1 æ¶ˆæ¯ç¼–å·ï¼š1]\n")])])]),r("ul",[r("li",[e._v("ç›¸åŒç¼–å·çš„æ¶ˆæ¯ï¼Œè¢«æŠ•é€’åˆ°ç›¸åŒçš„"),r("strong",[e._v("å­")]),e._v(" Queue ï¼Œè¢«ç›¸åŒçš„çº¿ç¨‹æ‰€æ¶ˆè´¹ã€‚ç¬¦åˆé¢„æœŸ~")])]),e._v(" "),r("h1",{attrs:{id:"_12-äº‹åŠ¡æ¶ˆæ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_12-äº‹åŠ¡æ¶ˆæ¯"}},[e._v("#")]),e._v(" 12. äº‹åŠ¡æ¶ˆæ¯")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-transaction"),r("OutboundLink")],1),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("RabbitMQ å†…ç½®æä¾›äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒã€‚å¯¹äº‹åŠ¡æ¶ˆæ¯çš„æ¦‚å¿µä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ "),r("a",{attrs:{href:"http://www.iocoder.cn/RabbitMQ/message-confirmation-mechanism-transaction-Confirm/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠRabbitMQ ä¹‹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆäº‹åŠ¡ + Confirmï¼‰ã€‹"),r("OutboundLink")],1),e._v(" æ–‡ç« çš„"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œäº‹åŠ¡æœºåˆ¶ã€"),r("OutboundLink")],1),e._v("å°èŠ‚ã€‚")]),e._v(" "),r("p",[e._v("ä¸è¿‡ RabbitMQ æä¾›çš„å¹¶ä¸æ˜¯"),r("strong",[e._v("å®Œæ•´çš„")]),e._v("çš„äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œç¼ºå°‘äº†"),r("strong",[e._v("å›æŸ¥æœºåˆ¶")]),e._v("ã€‚ç›®å‰ï¼Œå¸¸ç”¨çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªæœ‰ RocketMQ æä¾›äº†å®Œæ•´çš„äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œå…·ä½“çš„å¯ä»¥çœ‹çœ‹"),r("a",{attrs:{href:"http://www.iocoder.cn/Spring-Boot/RocketMQ/?self",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹"),r("OutboundLink")],1),e._v(" çš„"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ9. äº‹åŠ¡æ¶ˆæ¯ã€"),r("OutboundLink")],1),e._v("å°èŠ‚ï¼ŒğŸ˜ˆ æš‚æ—¶ä¸æ‹“å±•å¼€æ¥è®²ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-transaction"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_12-1-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 12.1 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_12-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 12.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_12-3-demo11message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_12-3-demo11message"}},[e._v("#")]),e._v(" 12.3 Demo11Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo11Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo11Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_12-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_12-4-rabbitconfig"}},[e._v("#")]),e._v(" 12.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œé¢å¤–é…ç½®äº‹åŠ¡ç›¸å…³çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n@Configuration\n@EnableTransactionManagement\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo11Queue() {\n            return new Queue(Demo11Message.QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo11Exchange() {\n            return new DirectExchange(Demo11Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo11Message.EXCHANGE\n        // Routing keyï¼šDemo11Message.ROUTING_KEY\n        // Queueï¼šDemo11Message.QUEUE\n        @Bean\n        public Binding demo11Binding() {\n            return BindingBuilder.bind(demo11Queue()).to(demo11Exchange()).with(Demo11Message.ROUTING_KEY);\n        }\n\n    }\n\n    @Bean\n    public RabbitTransactionManager rabbitTransactionManager(ConnectionFactory connectionFactory, RabbitTemplate rabbitTemplate) {\n        // <Y> è®¾ç½® RabbitTemplate æ”¯æŒäº‹åŠ¡\n        rabbitTemplate.setChannelTransacted(true);\n\n        // åˆ›å»º RabbitTransactionManager å¯¹è±¡\n        return new RabbitTransactionManager(connectionFactory);\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("DirectExchangeDemoConfiguration é…ç½®ç±»ï¼Œç”¨äºå®šä¹‰ Queueã€Exchangeã€Binding çš„é…ç½®ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ç±»ä¸Šï¼Œæ·»åŠ  "),r("code",[e._v("@EnableTransactionManagement")]),e._v(" æ³¨è§£ï¼Œå¼€å¯"),r("a",{attrs:{href:"https://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/transaction.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Transaction"),r("OutboundLink")],1),e._v(" çš„æ”¯æŒã€‚")]),e._v(" "),r("li",[e._v("åœ¨ "),r("code",[e._v("#rabbitTransactionManager()")]),e._v(" æ–¹æ³•ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/transaction/RabbitTransactionManager.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitTransactionManager"),r("OutboundLink")],1),e._v(" äº‹åŠ¡ç®¡ç†å™¨ Bean ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ "),r("code",[e._v("<Y>")]),e._v(" å¤„ï¼Œæ ‡è®°åˆ›å»ºçš„ RabbitMQ Channel æ˜¯äº‹åŠ¡æ€§çš„ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨ RabbitMQ çš„äº‹åŠ¡æ¶ˆæ¯ã€‚")])]),e._v(" "),r("p",[e._v("å› ä¸º Spring-AMQP é€šè¿‡ RabbitTransactionManager æ¥å®ç°å¯¹ Spring Transaction çš„é›†æˆï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é…åˆä½¿ç”¨ "),r("code",[e._v("@Transactional")]),e._v(" æ³¨è§£ï¼Œæ¥å£°æ˜äº‹åŠ¡å³å¯ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_12-5-demo11producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_12-5-demo11producer"}},[e._v("#")]),e._v(" 12.5 Demo11Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo11Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo11Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo11Producer.java\n\n@Component\npublic class Demo11Producer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @Transactional\n    public void syncSend(Integer id) throws InterruptedException {\n        // åˆ›å»º Demo11Message æ¶ˆæ¯\n        Demo11Message message = new Demo11Message();\n        message.setId(id);\n        // åŒæ­¥å‘é€æ¶ˆæ¯\n        rabbitTemplate.convertAndSend(Demo11Message.EXCHANGE, Demo11Message.ROUTING_KEY, message);\n        logger.info("[syncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // <X> ç­‰å¾…\n        Thread.sleep(10 * 1000L);\n    }\n\n}\n')])])]),r("ul",[r("li",[r("p",[e._v("åœ¨å‘é€æ¶ˆæ¯æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ äº† "),r("code",[e._v("@Transactional")]),e._v(" æ³¨è§£ï¼Œå£°æ˜äº‹åŠ¡ã€‚å› ä¸ºæˆ‘ä»¬åˆ›å»ºäº† RabbitTransactionManager äº‹åŠ¡ç®¡ç†å™¨ï¼Œæ‰€ä»¥è¿™é‡Œä¼šåˆ›å»º RabbitMQ äº‹åŠ¡ã€‚")])]),e._v(" "),r("li",[r("p",[e._v("åœ¨"),r("X",[e._v("å¤„ï¼Œæˆ‘ä»¬æ•…æ„ç­‰å¾…")])],1),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code")])])])]),e._v(" "),r("p",[e._v("Thread#sleep(long millis)")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('\n10 ç§’ï¼Œåˆ¤æ–­ RabbitMQ äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆã€‚\n\n- å¦‚æœåŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸåï¼ŒConsumer ç«‹å³æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ï¼Œè¯´æ˜æœªç”Ÿæ•ˆã€‚\n- å¦‚æœ Consumer æ˜¯ 10 ç§’ä¹‹åï¼Œæ‰æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ï¼Œè¯´æ˜å·²ç”Ÿæ•ˆã€‚\n\n## 12.6 Demo11Consumer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.consumer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo11Consumer](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo11Consumer.java) ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚\n\nå’Œ[ã€Œ3.1.7 Demo01Consumerã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºæ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ `"QUEUE_DEMO_11"` ã€‚\n\n## 12.7 ç®€å•æµ‹è¯•\n\nåˆ›å»º [Demo11ProducerTest](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-transaction/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo11ProducerTest.java) æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯• Producer å‘é€**äº‹åŠ¡**æ¶ˆæ¯çš„æ•ˆæœã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n')])])]),r("p",[e._v("// Demo11ProducerTest.java")]),e._v(" "),r("p",[e._v("@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo11ProducerTest {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("@Autowired\nprivate Demo11Producer producer;\n\n@Test\npublic void testSyncSend() throws InterruptedException {\n    int id = (int) (System.currentTimeMillis() / 1000);\n    producer.syncSend(id);\n\n    // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n    new CountDownLatch(1).await();\n}\n")])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\næ‰§è¡Œå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Producer æˆåŠŸåŒæ­¥å‘é€äº† 1 æ¡æ¶ˆæ¯ã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡å¹¶æœªæäº¤\n2019-12-12 22:03:05.525  INFO 17729 --- [           main] c.i.s.l.r.producer.Demo11Producer        : [syncSend][å‘é€ç¼–å·ï¼š[1576159385] å‘é€æˆåŠŸ]")]),e._v(" "),r("p",[e._v("// 10 ç§’åï¼ŒProducer æäº¤äº‹åŠ¡ã€‚\n// æ­¤æ—¶ï¼ŒConsumer æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ã€‚\n2019-12-12 22:03:15.548  INFO 17729 --- [ntContainer#4-1] c.i.s.l.r.consumer.Demo11Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:25 æ¶ˆæ¯å†…å®¹ï¼šDemo11Message{id=1576159385}]")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- Consumer åœ¨äº‹åŠ¡æ¶ˆæ¯æäº¤åï¼Œæ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ã€‚ç¬¦åˆé¢„æœŸ~\n\n# 13. æ¶ˆè´¹è€…çš„æ¶ˆæ¯ç¡®è®¤\n\n> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-04-rabbitmq-demo-ack](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack) ã€‚\n\nåœ¨ RabbitMQ ä¸­ï¼ŒConsumer æœ‰ä¸¤ç§æ¶ˆæ¯ç¡®è®¤çš„æ–¹å¼ï¼š\n\n- æ–¹å¼ä¸€ï¼Œè‡ªåŠ¨ç¡®è®¤ã€‚\n- æ–¹å¼äºŒï¼Œæ‰‹åŠ¨ç¡®è®¤ã€‚\n\nå¯¹äº**è‡ªåŠ¨ç¡®è®¤**çš„æ–¹å¼ï¼ŒRabbitMQ Broker åªè¦å°†æ¶ˆæ¯å†™å…¥åˆ° TCP Socket ä¸­æˆåŠŸï¼Œå°±è®¤ä¸ºè¯¥æ¶ˆæ¯æŠ•é€’æˆåŠŸï¼Œè€Œæ— éœ€ Consumer **æ‰‹åŠ¨ç¡®è®¤**ã€‚\n\nå¯¹äº**æ‰‹åŠ¨ç¡®è®¤**çš„æ–¹å¼ï¼ŒRabbitMQ Broker å°†æ¶ˆæ¯å‘é€ç»™ Consumer ä¹‹åï¼Œç”± Consumer **æ‰‹åŠ¨ç¡®è®¤**ä¹‹åï¼Œæ‰ä»»åŠ¡æ¶ˆæ¯æŠ•é€’æˆåŠŸã€‚\n\nå®é™…åœºæ™¯ä¸‹ï¼Œå› ä¸ºè‡ªåŠ¨ç¡®è®¤å­˜åœ¨å¯èƒ½**ä¸¢å¤±æ¶ˆæ¯**çš„æƒ…å†µï¼Œæ‰€ä»¥åœ¨å¯¹**å¯é æ€§**æœ‰è¦æ±‚çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åŸºæœ¬é‡‡ç”¨æ‰‹åŠ¨ç¡®è®¤ã€‚å½“ç„¶ï¼Œå¦‚æœå…è®¸æ¶ˆæ¯æœ‰ä¸€å®šçš„ä¸¢å¤±ï¼Œå¯¹**æ€§èƒ½**æœ‰æ›´é«˜çš„äº§ç»ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘é‡‡ç”¨è‡ªåŠ¨ç¡®è®¤ã€‚\n\nğŸ˜ˆ æ›´å¤šå…³äºæ¶ˆè´¹è€…çš„æ¶ˆæ¯ç¡®è®¤çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥é˜…è¯»å¦‚ä¸‹çš„æ–‡ç« ï¼š\n\n- [ã€ŠConsumer Acknowledgements and Publisher Confirmsã€‹](https://www.rabbitmq.com/confirms.html) çš„æ¶ˆè´¹è€…éƒ¨åˆ†çš„å†…å®¹ï¼Œå¯¹åº”ä¸­æ–‡ç¿»è¯‘ä¸º [ã€Šæ¶ˆè´¹è€…åº”ç­”ï¼ˆACKï¼‰å’Œå‘å¸ƒè€…ç¡®è®¤ï¼ˆConfirmï¼‰ã€‹](https://blog.bossma.cn/rabbitmq/consumer-ack-and-publisher-confirm/) ã€‚\n- [ã€ŠRabbitMQ ä¹‹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆäº‹åŠ¡ + Confirmï¼‰ã€‹](http://www.iocoder.cn/RabbitMQ/message-confirmation-mechanism-transaction-Confirm/?self) æ–‡ç« çš„[ã€Œæ¶ˆæ¯ç¡®è®¤ï¼ˆConsumerç«¯ï¼‰ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)å°èŠ‚ã€‚\n\nåœ¨ Spring-AMQP ä¸­ï¼Œåœ¨ [AcknowledgeMode](https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/AcknowledgeMode.java) ä¸­ï¼Œå®šä¹‰äº†ä¸‰ç§æ¶ˆæ¯ç¡®è®¤çš„æ–¹å¼ï¼š\n\n\n\n")])])]),r("p",[e._v("// AcknowledgeMode.java")]),e._v(" "),r("p",[e._v("/**")]),e._v(" "),r("ul",[r("li",[e._v("No acks - {@code autoAck=true} in {@code Channel.basicConsume()}.\n*/\nNONE, // å¯¹åº” Consumer çš„è‡ªåŠ¨ç¡®è®¤")])]),e._v(" "),r("p",[e._v("/**")]),e._v(" "),r("ul",[r("li",[e._v("Manual acks - user must ack/nack via a channel aware listener.\n*/\nMANUAL, // å¯¹åº” Consumer çš„æ‰‹åŠ¨ç¡®è®¤ï¼Œç”±å¼€å‘è€…åœ¨æ¶ˆè´¹é€»è¾‘ä¸­ï¼Œæ‰‹åŠ¨è¿›è¡Œç¡®è®¤ã€‚")])]),e._v(" "),r("p",[e._v("/**")]),e._v(" "),r("ul",[r("li",[e._v("Auto - the container will issue the ack/nack based on whether")]),e._v(" "),r("li",[e._v("the listener returns normally, or throws an exception.")]),e._v(" "),r("li",[r("p",[r("em",[e._v("Do not confuse with RabbitMQ {@code autoAck} which is\n")])])]),e._v(" "),r("li",[e._v("represented by {@link #NONE} here"),e._v(".\n*/\nAUTO; // å¯¹åº” Consumer çš„æ‰‹åŠ¨ç¡®è®¤ï¼Œåœ¨æ¶ˆè´¹æ¶ˆæ¯å®Œæˆï¼ˆåŒ…æ‹¬æ­£å¸¸è¿”å›ã€å’ŒæŠ›å‡ºå¼‚å¸¸ï¼‰åï¼Œç”± Spring-AMQP æ¡†æ¶æ¥â€œè‡ªåŠ¨â€è¿›è¡Œç¡®è®¤ã€‚")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- å®é™…ä¸Šï¼Œå°±æ˜¯å°†**æ‰‹åŠ¨ç¡®è®¤**è¿›ä¸€æ­¥ç»†åˆ†ï¼Œæä¾›äº†ç”± Spring-AMQP æä¾› Consumer çº§åˆ«çš„è‡ªåŠ¨ç¡®è®¤ã€‚\n\n**åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½é‡‡ç”¨äº† Spring-AMQP é»˜è®¤çš„ `AUTO` æ¨¡å¼**ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª `MANUAL` æ¨¡å¼ï¼Œæ‰‹åŠ¨ç¡®è®¤çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª [lab-04-rabbitmq-demo-ack](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack) é¡¹ç›®ã€‚\n\n## 13.1 å¼•å…¥ä¾èµ–\n\nå’Œ [ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸€è‡´ï¼Œè§ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/pom.xml) æ–‡ä»¶ã€‚\n\n## 13.2 åº”ç”¨é…ç½®æ–‡ä»¶\n\nåœ¨ [`resources`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/resources) ç›®å½•ä¸‹ï¼Œåˆ›å»º [`application.yaml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/resources/application.yaml) é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("spring:")]),e._v(" "),r("h1",{attrs:{id:"rabbitmq-é…ç½®é¡¹-å¯¹åº”-rabbitproperties-é…ç½®ç±»"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-é…ç½®é¡¹-å¯¹åº”-rabbitproperties-é…ç½®ç±»"}},[e._v("#")]),e._v(" RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»")]),e._v(" "),r("p",[e._v("rabbitmq:\nhost: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\nport: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\nusername: guest # RabbitMQ æœåŠ¡çš„è´¦å·\npassword: guest # RabbitMQ æœåŠ¡çš„å¯†ç \nlistener:\nsimple:\nacknowledge-mode: manual # é…ç½® Consumer æ‰‹åŠ¨æäº¤")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç›¸æ¯”[ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡**æ–°å¢** `spring.rabbitmq.listener.simple.acknowledge-mode=true` é…ç½®é¡¹ï¼Œæ¥é…ç½® Consumer æ‰‹åŠ¨æäº¤ã€‚\n\n## 13.3 Demo12Message\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.message`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo12Message](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo12Message.java) æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚\n\nå’Œ[ã€Œ3.1.4 Demo01Messageã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n## 13.4 RabbitConfig\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.config`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config) åŒ…ä¸‹ï¼Œåˆ›å»º [RabbitConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java) é…ç½®ç±»ï¼Œé…ç½®ç›¸å…³çš„ Exchangeã€Queueã€Binding ã€‚\n\nå’Œ[ã€Œ3.1.5 RabbitConfigã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n## 13.5 Demo12Producer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.producer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo12Producer](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/Demo12Producer.java) ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚\n\nå’Œ[ã€Œ3.1.6 Demo01Producerã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€RoutingKey åå­—ä¸åŒã€‚\n\n## 13.6 Demo12Consumer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.consumer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo09Consumer](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo12Consumer.java) ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Demo12Consumer.java")]),e._v(" "),r("p",[e._v("@Component\n@RabbitListener(queues = Demo12Message.QUEUE)\npublic class Demo12Consumer {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@RabbitHandler\npublic void onMessage(Demo12Message message, Channel channel,\n                      @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) throws IOException {\n    logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    // æäº¤æ¶ˆè´¹è¿›åº¦\n    if (message.getId() % 2 == 1) {\n        // ack ç¡®è®¤æ¶ˆæ¯\n        // ç¬¬äºŒä¸ªå‚æ•° multiple ï¼Œç”¨äºæ‰¹é‡ç¡®è®¤æ¶ˆæ¯ï¼Œä¸ºäº†å‡å°‘ç½‘ç»œæµé‡ï¼Œæ‰‹åŠ¨ç¡®è®¤å¯ä»¥è¢«æ‰¹å¤„ã€‚\n        // 1. å½“ multiple ä¸º true æ—¶ï¼Œåˆ™å¯ä»¥ä¸€æ¬¡æ€§ç¡®è®¤ deliveryTag å°äºç­‰äºä¼ å…¥å€¼çš„æ‰€æœ‰æ¶ˆæ¯\n        // 2. å½“ multiple ä¸º false æ—¶ï¼Œåˆ™åªç¡®è®¤å½“å‰ deliveryTag å¯¹åº”çš„æ¶ˆæ¯\n        channel.basicAck(deliveryTag, false);\n    }\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- åœ¨æ¶ˆè´¹æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å¢åŠ ç±»å‹ä¸º [Channel](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java) çš„æ–¹æ³•å‚æ•°ï¼Œå’Œ `deliveryTag` ã€‚é€šè¿‡è°ƒç”¨å…¶ `Channel#basicAck(deliveryTag, multiple)` æ–¹æ³•ï¼Œå¯ä»¥è¿›è¡Œæ¶ˆæ¯çš„ç¡®è®¤ã€‚è¿™é‡Œï¼Œè‰¿è‰¿æ·»åŠ äº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šè¯´æ˜ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±ç…ç…å™¢ã€‚\n- åœ¨ `@RabbitListener` æ³¨è§£çš„ `ackMode` å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®è‡ªå®šä¹‰çš„ AcknowledgeMode æ¨¡å¼ã€‚\n- åœ¨æ¶ˆè´¹é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬æ•…æ„åªæäº¤æ¶ˆè´¹çš„æ¶ˆæ¯çš„ `Demo12Message.id` ä¸º**å¥‡æ•°**çš„æ¶ˆæ¯ã€‚ğŸ˜ˆ è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å‘é€ä¸€æ¡ `id=1` ï¼Œä¸€æ¡ `id=2` çš„æ¶ˆæ¯ï¼Œå¦‚æœç¬¬äºŒæ¡çš„æ¶ˆè´¹è¿›åº¦æ²¡æœ‰è¢«æäº¤ï¼Œå°±å¯ä»¥è¯´æ˜æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦æˆåŠŸã€‚\n\n## 13.7 ç®€å•æµ‹è¯•\n\nåˆ›å»º [Demo12ProducerTest](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-ack/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo12ProducerTest.java) æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Demo12ProducerTest.java")]),e._v(" "),r("p",[e._v("@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo12ProducerTest {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@Autowired\nprivate Demo12Producer producer;\n\n@Test\npublic void testSyncSend() throws InterruptedException {\n    for (int id = 1; id <= 2; id++) {\n        producer.syncSend(id);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n    }\n\n    // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n    new CountDownLatch(1).await();\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\næ‰§è¡Œ `#testSyncSend()` å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Producer åŒæ­¥å‘é€ 2 æ¡æ¶ˆæ¯æˆåŠŸ\n2019-12-13 00:19:33.403  INFO 45869 --- [           main] c.i.s.l.r.producer.Demo12ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1] å‘é€æˆåŠŸ]\n2019-12-13 00:19:33.406  INFO 45869 --- [           main] c.i.s.l.r.producer.Demo12ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[2] å‘é€æˆåŠŸ]")]),e._v(" "),r("p",[e._v("// Demo08Consumer æ¶ˆè´¹ 2 æ¡æ¶ˆæ¯æˆåŠŸ\n2019-12-13 00:19:33.420  INFO 45869 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo12Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo12Message{id=1}]\n2019-12-13 00:19:33.421  INFO 45869 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo12Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo12Message{id=2}]")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('\n\n\næ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ [RabbitMQ Management](https://static.iocoder.cn/7c5541295505e7a3be4ac7ab2882feeb) æ¥æŸ¥çœ‹ `"DEMO_12"` çš„è¯¥æ¶ˆè´¹è€…ï¼š\n\n\n![](https://raw.githubusercontent.com/lichengcan/images/main/02.png)\n\n- æœ‰ 1 æ¡æ¶ˆæ¯çš„æœªç¡®è®¤ï¼Œç¬¦åˆé¢„æœŸ~\n\n# 14. ç”Ÿäº§è€…çš„å‘é€ç¡®è®¤\n\nåœ¨ RabbitMQ ä¸­ï¼Œ**é»˜è®¤**æƒ…å†µä¸‹ï¼ŒProducer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œåªä¿è¯å°†æ¶ˆæ¯å†™å…¥åˆ° TCP Socket ä¸­æˆåŠŸï¼Œå¹¶ä¸ä¿è¯æ¶ˆæ¯å‘é€åˆ° RabbitMQ Broker æˆåŠŸï¼Œå¹¶ä¸”æŒä¹…åŒ–æ¶ˆæ¯åˆ°ç£ç›˜æˆåŠŸã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸Šè¿°çš„ç¤ºä¾‹ï¼ŒProducer åœ¨å‘é€æ¶ˆæ¯éƒ½ä¸æ˜¯ç»å¯¹å¯é ï¼Œæ˜¯å­˜åœ¨ä¸¢å¤±æ¶ˆæ¯çš„å¯èƒ½æ€§ã€‚\n\nä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œåœ¨ RabbitMQ ä¸­ï¼ŒProducer é‡‡ç”¨ Confirm æ¨¡å¼ï¼Œå®ç°å‘é€æ¶ˆæ¯çš„ç¡®è®¤æœºåˆ¶ï¼Œä»¥ä¿è¯æ¶ˆæ¯å‘é€çš„å¯é æ€§ã€‚å®ç°åŸç†å¦‚ä¸‹ï¼š\n\n- é¦–å…ˆï¼ŒProducer é€šè¿‡è°ƒç”¨ [`Channel#confirmSelect()`](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java#L1278-L1283) æ–¹æ³•ï¼Œå°† Channel è®¾ç½®ä¸º Confirm æ¨¡å¼ã€‚\n- ç„¶åï¼Œåœ¨è¯¥ Channel å‘é€çš„æ¶ˆæ¯æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡ [`Channel#getNextPublishSeqNo()`](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java#L1285-L1290) æ–¹æ³•ï¼Œç»™å‘é€çš„æ¶ˆæ¯åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ ID ç¼–å·(`seqNo` ä» 1 å¼€å§‹é€’å¢)ï¼Œå†å‘é€è¯¥æ¶ˆæ¯ç»™ RabbitMQ Broker ã€‚\n- ä¹‹åï¼ŒRabbitMQ Broker åœ¨æ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼Œå¹¶è¢«è·¯ç”±åˆ°ç›¸åº”çš„é˜Ÿåˆ—ä¹‹åï¼Œä¼šå‘é€ä¸€ä¸ªåŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ç¼–å·(`deliveryTag`)çš„ç¡®è®¤ç»™ Producer ã€‚\n\né€šè¿‡ `seqNo` ç¼–å·ï¼Œå°† Producer å‘é€æ¶ˆæ¯çš„â€œè¯·æ±‚â€ï¼Œå’Œ RabbitMQ Broker ç¡®è®¤æ¶ˆæ¯çš„â€œå“åº”â€ä¸²è”åœ¨ä¸€èµ·ã€‚\n\né€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼ŒProducer å°±å¯ä»¥çŸ¥é“æ¶ˆæ¯æ˜¯å¦æˆåŠŸå‘é€åˆ° RabbitMQ Broker ä¹‹ä¸­ï¼Œä¿è¯æ¶ˆæ¯å‘é€çš„å¯é æ€§ã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œæ•´ä¸ªæ‰§è¡Œçš„è¿‡ç¨‹å®é™…æ˜¯**å¼‚æ­¥**ï¼Œéœ€è¦æˆ‘ä»¬è°ƒç”¨ [`Channel#waitForConfirms()`](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java#L1293-L1329) æ–¹æ³•ï¼Œ**åŒæ­¥**é˜»å¡ç­‰å¾… RabbitMQ Broker ç¡®è®¤æ¶ˆæ¯çš„â€œå“åº”â€ã€‚\n\nä¹Ÿå› æ­¤ï¼ŒProducer é‡‡ç”¨ Confirm æ¨¡å¼æ—¶ï¼Œæœ‰ä¸‰ç§ç¼–ç¨‹æ–¹å¼ï¼š\n\n- ã€åŒæ­¥ã€‘æ™®é€š Confirm æ¨¡å¼ï¼šProducer æ¯å‘é€ä¸€æ¡æ¶ˆæ¯åï¼Œè°ƒç”¨ `Channel#waitForConfirms()` æ–¹æ³•ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯ Confirm ã€‚\n\n- ã€åŒæ­¥ã€‘æ‰¹é‡ Confirm æ¨¡å¼ï¼šProducer æ¯å‘é€ä¸€æ‰¹æ¶ˆæ¯åï¼Œè°ƒç”¨`Channel#waitForConfirms()` æ–¹æ³•ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯ Confirm ã€‚\n\n  > æœ¬è´¨ä¸Šï¼Œå’Œã€Œæ™®é€š Confirm æ¨¡å¼ã€æ˜¯ä¸€æ ·çš„ã€‚\n\n- ã€å¼‚æ­¥ã€‘å¼‚æ­¥ Confirm æ¨¡å¼ï¼šProducer æä¾›ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼ŒRabbitMQ Broker åœ¨ Confirm äº†ä¸€æ¡æˆ–è€…å¤šæ¡æ¶ˆæ¯åï¼ŒProducer ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ã€‚\n\nğŸ˜ˆ æ›´å¤šå…³äº Producer çš„ Confirm æ¨¡å¼çš„å†…å®¹ï¼Œèƒ–å‹å¯ä»¥é˜…è¯»å¦‚ä¸‹çš„æ–‡ç« ï¼š\n\n- [ã€ŠConsumer Acknowledgements and Publisher Confirmsã€‹](https://www.rabbitmq.com/confirms.html) çš„ç”Ÿäº§è€…éƒ¨åˆ†çš„å†…å®¹ï¼Œå¯¹åº”ä¸­æ–‡ç¿»è¯‘ä¸º [ã€Šæ¶ˆè´¹è€…åº”ç­”ï¼ˆACKï¼‰å’Œå‘å¸ƒè€…ç¡®è®¤ï¼ˆConfirmï¼‰ã€‹](https://blog.bossma.cn/rabbitmq/consumer-ack-and-publisher-confirm/) ã€‚\n- [ã€ŠRabbitMQ ä¹‹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆäº‹åŠ¡ + Confirmï¼‰ã€‹](http://www.iocoder.cn/RabbitMQ/message-confirmation-mechanism-transaction-Confirm/?self) æ–‡ç« çš„[ã€ŒConfirm æ¨¡å¼ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)å°èŠ‚ã€‚\n\nåœ¨ Spring-AMQP ä¸­ï¼Œåœ¨ [ConfirmType](https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/connection/CachingConnectionFactory.java#L145-L167) ä¸­ï¼Œå®šä¹‰äº†ä¸‰ç§æ¶ˆæ¯ç¡®è®¤çš„æ–¹å¼ï¼š\n\n\n\n')])])]),r("p",[e._v("// CachingConnectionFactory#ConfirmType.java")]),e._v(" "),r("p",[e._v("public enum ConfirmType {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("/**\n * Use {@code RabbitTemplate#waitForConfirms()} (or {@code waitForConfirmsOrDie()}\n * within scoped operations.\n */\nSIMPLE, // ä½¿ç”¨åŒæ­¥çš„ Confirm æ¨¡å¼\n\n/**\n * Use with {@code CorrelationData} to correlate confirmations with sent\n * messsages.\n */\nCORRELATED, // ä½¿ç”¨å¼‚æ­¥çš„ Confirm æ¨¡å¼\n\n/**\n * Publisher confirms are disabled (default).\n */\nNONE // ä¸ä½¿ç”¨ Confirm æ¨¡å¼\n")])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n**åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½é‡‡ç”¨äº† Spring-AMQP é»˜è®¤çš„ `NONE` æ¨¡å¼**ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸¤ä¸ªç¤ºä¾‹ï¼š\n\n- åœ¨[ã€Œ14.1 åŒæ­¥ Confirm æ¨¡å¼ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ `SIMPLE` ç±»å‹ï¼Œå®ç°åŒæ­¥çš„ Confirm æ¨¡å¼ã€‚\n- åœ¨[ã€Œ14.2 å¼‚æ­¥ Confirm æ¨¡å¼ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ `CORRELATED` ç±»å‹ï¼Œä½¿ç”¨å¼‚æ­¥çš„ Confirm æ¨¡å¼ã€‚\n\n## 14.1 åŒæ­¥ Confirm æ¨¡å¼\n\n> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-04-rabbitmq-demo-confirm](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm) ã€‚\n\nåœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ `ConfirmType.SIMPLE` ç±»å‹ï¼Œå®ç°åŒæ­¥çš„ Confirm æ¨¡å¼ã€‚\n\nè¦æ³¨æ„ï¼Œè¿™é‡Œçš„**åŒæ­¥**ï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬é€šè¿‡è°ƒç”¨ [`Channel#waitForConfirms()`](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java#L1293-L1329) æ–¹æ³•ï¼Œ**åŒæ­¥**é˜»å¡ç­‰å¾… RabbitMQ Broker ç¡®è®¤æ¶ˆæ¯çš„â€œå“åº”â€ã€‚\n\nè€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª [lab-04-rabbitmq-demo-confirm](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm) é¡¹ç›®ã€‚\n\n### 14.1.1 å¼•å…¥ä¾èµ–\n\nå’Œ [ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸€è‡´ï¼Œè§ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/pom.xml) æ–‡ä»¶ã€‚\n\n### 14.1.2 åº”ç”¨é…ç½®æ–‡ä»¶\n\nåœ¨ [`resources`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/resources) ç›®å½•ä¸‹ï¼Œåˆ›å»º [`application.yaml`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/resources/application.yaml) é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("spring:")]),e._v(" "),r("h1",{attrs:{id:"rabbitmq-é…ç½®é¡¹-å¯¹åº”-rabbitproperties-é…ç½®ç±»-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-é…ç½®é¡¹-å¯¹åº”-rabbitproperties-é…ç½®ç±»-2"}},[e._v("#")]),e._v(" RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»")]),e._v(" "),r("p",[e._v("rabbitmq:\nhost: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\nport: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\nusername: guest # RabbitMQ æœåŠ¡çš„è´¦å·\npassword: guest # RabbitMQ æœåŠ¡çš„å¯†ç \npublisher-confirm-type: simple # è®¾ç½® Confirm ç±»å‹ä¸º SIMPLE ã€‚")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç›¸æ¯”[ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡**æ–°å¢** `spring.rabbitmq.publisher-confirm-type=simple` é…ç½®é¡¹ï¼Œè®¾ç½® Confirm ç±»å‹ä¸º `ConfirmType.SIMPLE` ã€‚\n\nåœ¨è¯¥ç±»å‹ä¸‹ï¼ŒSpring-AMQP åœ¨åˆ›å»ºå®Œ RabbitMQ Channel ä¹‹åï¼Œä¼š**è‡ªåŠ¨**è°ƒç”¨ [`Channel#confirmSelect()`](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java#L1278-L1283) æ–¹æ³•ï¼Œå°† Channel è®¾ç½®ä¸º Confirm æ¨¡å¼ã€‚\n\n### 14.1.3 Demo13Message\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.message`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo13Message](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo13Message.java) æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚\n\nå’Œ[ã€Œ3.1.4 Demo01Messageã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n### 14.1.4 RabbitConfig\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.config`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config) åŒ…ä¸‹ï¼Œåˆ›å»º [RabbitConfig](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java) é…ç½®ç±»ï¼Œé…ç½®ç›¸å…³çš„ Exchangeã€Queueã€Binding ã€‚\n\nå’Œ[ã€Œ3.1.5 RabbitConfigã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n### 14.1.4 Demo13Producer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.producer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo13Producer](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo13Producer.java) ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚\n\n\n\n")])])]),r("p",[e._v("// Demo13Producer.java")]),e._v(" "),r("p",[e._v("@Component\npublic class Demo13Producer {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\npublic void syncSend(Integer id) {\n    // åˆ›å»º Demo13Message æ¶ˆæ¯\n    Demo13Message message = new Demo13Message();\n    message.setId(id);\n    // åŒæ­¥å‘é€æ¶ˆæ¯\n    rabbitTemplate.invoke(new RabbitOperations.OperationsCallback<Object>() {\n\n        @Override\n        public Object doInRabbit(RabbitOperations operations) {\n            // åŒæ­¥å‘é€æ¶ˆæ¯\n            operations.convertAndSend(Demo13Message.EXCHANGE, Demo13Message.ROUTING_KEY, message);\n            logger.info("[doInRabbit][å‘é€æ¶ˆæ¯å®Œæˆ]");\n            // ç­‰å¾…ç¡®è®¤\n            operations.waitForConfirms(0); // timeout å‚æ•°ï¼Œå¦‚æœä¼ é€’ 0 ï¼Œè¡¨ç¤ºæ— é™ç­‰å¾…\n            logger.info("[doInRabbit][ç­‰å¾… Confirm å®Œæˆ]");\n            return null;\n        }\n\n    }, new ConfirmCallback() {\n\n        @Override\n        public void handle(long deliveryTag, boolean multiple) throws IOException {\n            logger.info("[handle][Confirm æˆåŠŸ]");\n        }\n\n    }, new ConfirmCallback() {\n\n        @Override\n        public void handle(long deliveryTag, boolean multiple) throws IOException {\n            logger.info("[handle][Confirm å¤±è´¥]");\n        }\n\n    });\n\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- åœ¨ RabbitTemplate æä¾›çš„ API æ–¹æ³•ä¸­ï¼Œå¦‚æœ Producer è¦ä½¿ç”¨åŒæ­¥çš„ Confirm æ¨¡å¼ï¼Œéœ€è¦è°ƒç”¨ `#invoke(action, acks, nacks)` æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n")])])]),r("p",[e._v("// RabbitOperations.java\n// RabbitTemplate å®ç°äº† RabbitOperations æ¥å£")]),e._v(" "),r("p",[e._v("/**")]),e._v(" "),r("ul",[r("li",[e._v("Invoke operations on the same channel.")]),e._v(" "),r("li",[e._v("If callbacks are needed, both callbacks must be supplied.")]),e._v(" "),r("li",[e._v("@param action the callback.")]),e._v(" "),r("li",[e._v("@param acks a confirm callback for acks.")]),e._v(" "),r("li",[e._v("@param nacks a confirm callback for nacks.")]),e._v(" "),r("li",[e._v("@param "),r("T",[e._v(" the return type.")])],1),e._v(" "),r("li",[e._v("@return the result of the action method.")]),e._v(" "),r("li",[e._v("@since 2.1\n*/\n@Nullable\n"),r("T",[e._v(" T invoke(OperationsCallback"),r("T",[e._v(" action, @Nullable com.rabbitmq.client.ConfirmCallback acks,\n@Nullable com.rabbitmq.client.ConfirmCallback nacks);")])],1)],1)]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('\n\n\n- å› ä¸º Confirm æ¨¡å¼éœ€è¦åŸºäº**ç›¸åŒ** Channel ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¯¥æ–¹æ³•ã€‚\n- åœ¨æ–¹æ³•å‚æ•° `action` ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ“ä½œã€‚\n- åœ¨æ–¹æ³•å‚æ•° `acks` ä¸­ï¼Œå®šä¹‰æ¥æ”¶åˆ° RabbitMQ Broker çš„æˆåŠŸâ€œå“åº”â€æ—¶çš„æˆå›è°ƒã€‚\n- åœ¨æ–¹æ³•å‚æ•° `nacks` ä¸­ï¼Œå®šä¹‰æ¥æ”¶åˆ° RabbitMQ Broker çš„å¤±è´¥â€œå“åº”â€æ—¶çš„æˆå›è°ƒã€‚\n\n> - å½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ã€‚\n> - å¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯ã€‚\n\n- å…·ä½“çš„å‘é€æ–¹æ³•çš„ä»£ç ï¼Œèƒ–å‹æ ¹æ®è‰¿è‰¿çš„æ³¨é‡Šï¼Œè¿›è¡Œç†è§£ä¸‹ã€‚\n\n### 14.1.5 Demo13Consumer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.consumer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo13Consumer](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo13Consumer.java) ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚\n\nå’Œ[ã€Œ3.1.7 Demo01Consumerã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºæ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ `"QUEUE_DEMO_13"` ã€‚\n\n### 14.1.6 ç®€å•æµ‹è¯•\n\nåˆ›å»º [Demo13ProducerTest](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo13ProducerTest.java) æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo13Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n')])])]),r("p",[e._v("// Demo13ProducerTest.java")]),e._v(" "),r("p",[e._v("@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo13ProducerTest {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@Autowired\nprivate Demo13Producer producer;\n\n@Test\npublic void testSyncSend() throws InterruptedException {\n    int id = (int) (System.currentTimeMillis() / 1000);\n    producer.syncSend(id);\n    logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n    // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n    new CountDownLatch(1).await();\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\næ‰§è¡Œ `#testSyncSend()` å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// ä¸»çº¿ç¨‹ï¼ŒProducer å‘é€ 1 æ¡æ¶ˆæ¯å®Œæˆã€‚\n2019-12-13 12:49:13.680  INFO 13247 --- [           main] c.i.s.l.r.producer.Demo13Producer        : [doInRabbit][å‘é€æ¶ˆæ¯å®Œæˆ]")]),e._v(" "),r("p",[e._v("// AMQConnection çº¿ç¨‹ï¼ŒProducer ç¡®è®¤æ”¶åˆ° RabbitMQ Broker å¯¹è¯¥æ¶ˆæ¯çš„æˆåŠŸâ€œå“åº”â€ ã€‚\n2019-12-13 12:49:13.689  INFO 13247 --- [ 127.0.0.1:5672] c.i.s.l.r.producer.Demo13Producer        : [handle][Confirm æˆåŠŸ]")]),e._v(" "),r("p",[e._v("// ä¸»çº¿ç¨‹ï¼ŒProducer ç­‰å¾…è¯¥æ¶ˆæ¯çš„ Confirm å®Œæˆã€‚\n2019-12-13 12:49:13.689  INFO 13247 --- [           main] c.i.s.l.r.producer.Demo13Producer        : [doInRabbit][ç­‰å¾… Confirm å®Œæˆ]")]),e._v(" "),r("p",[e._v("// å•å…ƒæµ‹è¯•ï¼Œæ‰“å°ä¸‹æ—¥å¿—ï¼Œå¯ä»¥å¿½ç•¥\n2019-12-13 12:49:13.694  INFO 13247 --- [           main] c.i.s.l.r.producer.Demo13ProducerTest    :\n[testSyncSend][å‘é€ç¼–å·ï¼š[1576212553] å‘é€æˆåŠŸ]")]),e._v(" "),r("p",[e._v("// æ¶ˆè´¹è€…çš„çº¿ç¨‹ï¼ŒConsumer æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯\n2019-12-13 12:49:13.699  INFO 13247 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo13Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo13Message{id=1576212553}]")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç¬¦åˆé¢„æœŸ~æ•´ä¸ªè¿‡ç¨‹ï¼Œå¥½å¥½ç†è§£è‰¿è‰¿åœ¨æ—¥å¿—ä¸Šï¼Œæ·»åŠ çš„è¿‡ç¨‹æ³¨é‡Šå™¢ã€‚\n\n## 14.2 å¼‚æ­¥ Confirm æ¨¡å¼\n\n> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-04-rabbitmq-demo-confirm-async](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async) ã€‚\n\nåœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ `ConfirmType.SIMPLE` ç±»å‹ï¼Œå®ç°å¼‚æ­¥çš„ Confirm æ¨¡å¼ã€‚\n\nè€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª [lab-04-rabbitmq-demo-confirm-async](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async) é¡¹ç›®ã€‚\n\n### 14.2.1 å¼•å…¥ä¾èµ–\n\nå’Œ [ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸€è‡´ï¼Œè§ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/pom.xml) æ–‡ä»¶ã€‚\n\n### 14.2.2 åº”ç”¨é…ç½®æ–‡ä»¶\n\nåœ¨ [`resources`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/resources) ç›®å½•ä¸‹ï¼Œåˆ›å»º [`application.yaml`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/resources/application.yaml) é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("spring:")]),e._v(" "),r("h1",{attrs:{id:"rabbitmq-é…ç½®é¡¹-å¯¹åº”-rabbitproperties-é…ç½®ç±»-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-é…ç½®é¡¹-å¯¹åº”-rabbitproperties-é…ç½®ç±»-3"}},[e._v("#")]),e._v(" RabbitMQ é…ç½®é¡¹ï¼Œå¯¹åº” RabbitProperties é…ç½®ç±»")]),e._v(" "),r("p",[e._v("rabbitmq:\nhost: 127.0.0.1 # RabbitMQ æœåŠ¡çš„åœ°å€\nport: 5672 # RabbitMQ æœåŠ¡çš„ç«¯å£\nusername: guest # RabbitMQ æœåŠ¡çš„è´¦å·\npassword: guest # RabbitMQ æœåŠ¡çš„å¯†ç \npublisher-confirm-type: correlated # è®¾ç½® Confirm ç±»å‹ä¸º CORRELATED ã€‚")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç›¸æ¯”[ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡**æ–°å¢** `spring.rabbitmq.publisher-confirm-type=correlated` é…ç½®é¡¹ï¼Œè®¾ç½® Confirm ç±»å‹ä¸º `ConfirmType.CORRELATED` ã€‚\n\nåœ¨è¯¥ç±»å‹ä¸‹ï¼ŒSpring-AMQP åœ¨åˆ›å»ºå®Œ RabbitMQ Channel ä¹‹åï¼Œä¹Ÿä¼š**è‡ªåŠ¨**è°ƒç”¨ [`Channel#confirmSelect()`](https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/main/java/com/rabbitmq/client/Channel.java#L1278-L1283) æ–¹æ³•ï¼Œå°† Channel è®¾ç½®ä¸º Confirm æ¨¡å¼ã€‚\n\n### 14.2.3 Demo13Message\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.message`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo13Message](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo13Message.java) æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚\n\nå’Œ[ã€Œ3.1.4 Demo01Messageã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n### 14.2.4 RabbitConfig\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.config`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config) åŒ…ä¸‹ï¼Œåˆ›å»º [RabbitConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java) é…ç½®ç±»ï¼Œé…ç½®ç›¸å…³çš„ Exchangeã€Queueã€Binding ã€‚\n\nå’Œ[ã€Œ3.1.5 RabbitConfigã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n### 14.2.5 RabbitProducerConfirmCallback\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.core`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core/) åŒ…ä¸‹ï¼Œåˆ›å»º [RabbitProducerConfirmCallback](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core/RabbitProducerConfirmCallback.java) ç±»ï¼Œå®ç° [RabbitTemplate.ConfirmCallback](https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/RabbitTemplate.java#L2712-L2727) æ¥å£ï¼Œæä¾› Producer æ”¶åˆ° RabbitMQ ç¡®è®¤æ¶ˆæ¯çš„â€œå“åº”â€çš„å›è°ƒã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// RabbitProducerConfirmCallback.java")]),e._v(" "),r("p",[e._v("@Component\npublic class RabbitProducerConfirmCallback implements RabbitTemplate.ConfirmCallback {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\npublic RabbitProducerConfirmCallback(RabbitTemplate rabbitTemplate) {\n    rabbitTemplate.setConfirmCallback(this);\n}\n\n@Override\npublic void confirm(CorrelationData correlationData, boolean ack, String cause) {\n    if (ack) {\n        logger.info("[confirm][Confirm æˆåŠŸ correlationData: {}]", correlationData);\n    } else {\n        logger.error("[confirm][Confirm å¤±è´¥ correlationData: {} cause: {}]", correlationData, cause);\n    }\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- åœ¨æ„é€ æ–¹æ³•ä¸­ï¼ŒæŠŠè‡ªå·±è®¾ç½®åˆ° RabbitTemplate ä¸­ï¼Œä½œä¸º Confirm çš„å›è°ƒã€‚\n- åœ¨ `#confirm(...)` æ–¹æ³•ä¸­ï¼Œæ ¹æ®æ˜¯å¦ `ack` æˆåŠŸï¼Œæ‰“å°ä¸åŒçš„æ—¥å¿—ã€‚\n\n### 14.2.6 Demo13Producer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.producer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo13Producer](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo13Producer.java) ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚\n\n\n\n")])])]),r("p",[e._v("// Demo13Producer.java")]),e._v(" "),r("p",[e._v("@Component\npublic class Demo13Producer {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\npublic void syncSend(Integer id) {\n    // åˆ›å»º Demo13Message æ¶ˆæ¯\n    Demo13Message message = new Demo13Message();\n    message.setId(id);\n    // åŒæ­¥å‘é€æ¶ˆæ¯\n    rabbitTemplate.convertAndSend(Demo13Message.EXCHANGE, Demo13Message.ROUTING_KEY, message);\n}\n")])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('\n\n\n- ä¸éœ€è¦åƒ[ã€Œ14.1.4 Demo13Producerã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€æ ·ï¼Œè€Œæ˜¯ç›´æ¥åƒæˆ‘ä»¬å…¶å®ƒç¤ºä¾‹ä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨ RabbitTemplate çš„ `#convertAndSend(...)` ç­‰ç­‰æ–¹æ³•å³å¯ã€‚\n\n### 14.2.7 Demo13Consumer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.consumer`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo13Consumer](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo13Consumer.java) ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚\n\nå’Œ[ã€Œ3.1.7 Demo01Consumerã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºæ¶ˆè´¹çš„é˜Ÿåˆ—æ˜¯ `"QUEUE_DEMO_13"` ã€‚\n\n### 14.2.8 ç®€å•æµ‹è¯•\n\nåˆ›å»º [Demo13ProducerTest](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer) æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo13Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n')])])]),r("p",[e._v("// Demo13ProducerTest.java")]),e._v(" "),r("p",[e._v("@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo13ProducerTest {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@Autowired\nprivate Demo13Producer producer;\n\n@Test\npublic void testSyncSend() throws InterruptedException {\n    int id = (int) (System.currentTimeMillis() / 1000);\n    producer.syncSend(id);\n    logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n    // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n    new CountDownLatch(1).await();\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\næ‰§è¡Œ `#testSyncSend()` å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// å•å…ƒæµ‹è¯•ï¼Œæ‰“å°ä¸‹æ—¥å¿—ï¼Œå¯ä»¥å¿½ç•¥\n2019-12-13 17:17:45.849  INFO 69003 --- [           main] c.i.s.l.r.producer.Demo13ProducerTest    :\n[testSyncSend][å‘é€ç¼–å·ï¼š[1576228665] å‘é€æˆåŠŸ]")]),e._v(" "),r("p",[e._v("// RabbitConnectionFactory çº¿ç¨‹ï¼ŒProducer ç¡®è®¤æ”¶åˆ° RabbitMQ Broker å¯¹è¯¥æ¶ˆæ¯çš„æˆåŠŸâ€œå“åº”â€ ã€‚\n// å› ä¸ºæˆ‘ä»¬åœ¨ Demo13Producer å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¹¶æœªä¼ å…¥ CorrelationData å‚æ•°ï¼Œæ‰€ä»¥ä¸º null ã€‚\n2019-12-13 17:17:45.859  INFO 69003 --- [nectionFactory1] .i.s.l.r.c.RabbitProducerConfirmCallback : [confirm][Confirm æˆåŠŸ correlationData: null]")]),e._v(" "),r("p",[e._v("// æ¶ˆè´¹è€…çš„çº¿ç¨‹ï¼ŒConsumer æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯\n2019-12-13 17:17:45.873  INFO 69003 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo13Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼šDemo13Message{id=1576228665}]")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç¬¦åˆé¢„æœŸ~æ•´ä¸ªè¿‡ç¨‹ï¼Œå¥½å¥½ç†è§£è‰¿è‰¿åœ¨æ—¥å¿—ä¸Šï¼Œæ·»åŠ çš„è¿‡ç¨‹æ³¨é‡Šå™¢ã€‚\n\n## 14.3 ReturnCallback\n\n> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-04-rabbitmq-demo-confirm-async](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async) ã€‚\n\nå½“ Producer æˆåŠŸå‘é€æ¶ˆæ¯åˆ° RabbitMQ Broker æ—¶ï¼Œä½†æ˜¯åœ¨é€šè¿‡ Exchange è¿›è¡Œ**åŒ¹é…ä¸åˆ°** Queue æ—¶ï¼ŒBroker ä¼šå°†è¯¥æ¶ˆæ¯å›é€€ç»™ Producer ã€‚\n\nä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹ï¼Œç»§ç»­åœ¨ [lab-04-rabbitmq-demo-confirm-async](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async) é¡¹ç›®æ”¹é€ ã€‚\n\n### 14.3.1 RabbitProducerReturnCallback\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.core`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core/) åŒ…ä¸‹ï¼Œåˆ›å»º [RabbitProducerReturnCallback](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core/RabbitProducerReturnCallback.java) ç±»ï¼Œå®ç° [RabbitTemplate.ReturnCallback](https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/core/RabbitTemplate.java#L2712-L2727) æ¥å£ï¼Œæä¾› Producer æ”¶åˆ° RabbitMQ Broker å›é€€æ¶ˆæ¯çš„çš„å›è°ƒã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// RabbitProducerReturnCallback.java")]),e._v(" "),r("p",[e._v("@Component\npublic class RabbitProducerReturnCallback implements RabbitTemplate.ReturnCallback {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\npublic RabbitProducerReturnCallback(RabbitTemplate rabbitTemplate) {\n    rabbitTemplate.setReturnCallback(this);\n}\n\n@Override\npublic void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {\n    logger.error("[returnedMessage][message: [{}] replyCode: [{}] replyText: [{}] exchange: [{}] routingKey: [{}]]",\n            message, replyCode, replyText, exchange, routingKey);\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- åœ¨æ„é€ æ–¹æ³•ä¸­ï¼ŒæŠŠè‡ªå·±è®¾ç½®åˆ° RabbitTemplate ä¸­ï¼Œä½œä¸ºæ¶ˆæ¯ Return çš„å›è°ƒã€‚\n- åœ¨ `#returnedMessage(...)` æ–¹æ³•ä¸­ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ã€‚å½“ç„¶ï¼Œå…·ä½“æ€ä¹ˆå¤„ç†ï¼Œèƒ–å‹å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å“ˆã€‚\n\n### 14.3.2 Demo13Producer\n\nä¿®æ”¹ [Demo13Producer](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo13Producer.java) ç±»ï¼Œå¢åŠ ä¸€ä¸ªå‘é€æ— æ³•åŒ¹é…åˆ° Queue çš„æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Demo13Producer.java")]),e._v(" "),r("p",[e._v('public void syncSendReturn(Integer id) {\n// åˆ›å»º Demo13Message æ¶ˆæ¯\nDemo13Message message = new Demo13Message();\nmessage.setId(id);\n// åŒæ­¥å‘é€æ¶ˆæ¯\nrabbitTemplate.convertAndSend(Demo13Message.EXCHANGE, "error", message);\n}')]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- å‘é€æ¶ˆæ¯çš„ RoutingKey ï¼Œæˆ‘ä»¬æ•…æ„è®¾ç½®ä¸º `error` ï¼Œè¾¾åˆ°æ¶ˆæ¯æ— æ³•åŒ¹é…åˆ° Queue çš„æ•ˆæœã€‚\n\n### 14.3.3 ç®€å•æµ‹è¯•\n\nä¿®æ”¹ [Demo13ProducerTest](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-confirm-async/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo13ProducerTest.java) æµ‹è¯•ç±»ï¼Œå¢åŠ è°ƒç”¨ Demo13Producer æ–°å¢çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Demo13ProducerTest.java")]),e._v(" "),r("p",[e._v('@Test\npublic void testSyncSendReturn() throws InterruptedException {\nint id = (int) (System.currentTimeMillis() / 1000);\nproducer.syncSendReturn(id);\nlogger.info("[testSyncSendReturn][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);')]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\nnew CountDownLatch(1).await();\n")])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\næ‰§è¡Œ `#testSyncSendReturn()` å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// å•å…ƒæµ‹è¯•ï¼Œæ‰“å°ä¸‹æ—¥å¿—ï¼Œå¯ä»¥å¿½ç•¥\n2019-12-13 17:40:57.130  INFO 74326 --- [           main] c.i.s.l.r.producer.Demo13ProducerTest    : [testSyncSendReturn][å‘é€ç¼–å·ï¼š[1576230057] å‘é€æˆåŠŸ]")]),e._v(" "),r("p",[e._v("// RabbitConnectionFactory çº¿ç¨‹ï¼ŒProducer ç¡®è®¤æ”¶åˆ° RabbitMQ Broker å¯¹è¯¥æ¶ˆæ¯çš„é€€å› ã€‚\n2019-12-13 17:41:02.817 ERROR 74326 --- [nectionFactory1] c.i.s.l.r.c.RabbitProducerReturnCallback : [returnedMessage][message: [(Body:'[B@4689be61(byte[187])' MessageProperties [headers={}, contentType=application/x-java-serialized-object, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, deliveryTag=0])] replyCode: [312] replyText: [NO_ROUTE] exchange: [EXCHANGE_DEMO_13] routingKey: []]")]),e._v(" "),r("p",[e._v("// RabbitConnectionFactory çº¿ç¨‹ï¼ŒProducer ç¡®è®¤æ”¶åˆ° RabbitMQ Broker å¯¹è¯¥æ¶ˆæ¯çš„æˆåŠŸâ€œå“åº”â€ ã€‚\n// æ³¨æ„ï¼Œå³ä½¿å­˜åœ¨ RabbitMQ Broker å›é€€æ¶ˆæ¯çš„æƒ…å†µï¼Œä¾ç„¶ä¼šæ”¶åˆ°å¯¹è¯¥æ¶ˆæ¯çš„æˆåŠŸâ€œå“åº”â€\n2019-12-13 17:41:02.819  INFO 74326 --- [nectionFactory1] .i.s.l.r.c.RabbitProducerConfirmCallback : [confirm][Confirm æˆåŠŸ correlationData: null]")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç¬¦åˆé¢„æœŸ~æ•´ä¸ªè¿‡ç¨‹ï¼Œå¥½å¥½ç†è§£è‰¿è‰¿åœ¨æ—¥å¿—ä¸Šï¼Œæ·»åŠ çš„è¿‡ç¨‹æ³¨é‡Šå™¢ã€‚\n\n# 15. RPC è¿œç¨‹è°ƒç”¨\n\n> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-04-rabbitmq-demo-rpc](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc) ã€‚\n\nåœ¨ RabbitMQ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ [Direct Reply-to](https://www.rabbitmq.com/direct-reply-to.html) ç‰¹æ€§ï¼Œå®ç° RPC è¿œç¨‹è°ƒç”¨çš„åŠŸèƒ½ã€‚å…·ä½“çš„å®ç°åŸç†ï¼Œèƒ–å‹è‡ªå·±çœ‹[ã€ŠRabbitMQ ä¹‹ RPC å®ç°ã€‹](http://www.iocoder.cn/RabbitMQ/RPC-implementation/?self)æ–‡ç« ï¼Œè¿™é‡Œè‰¿è‰¿å°±ä¸èµ˜è¿°äº†ã€‚\n\nä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª RPC çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª [lab-04-rabbitmq-demo-rpc](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc) é¡¹ç›®ã€‚\n\n## 15.1 å¼•å…¥ä¾èµ–\n\nå’Œ [ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸€è‡´ï¼Œè§ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/pom.xml) æ–‡ä»¶ã€‚\n\n## 15.2 åº”ç”¨é…ç½®æ–‡ä»¶\n\nå’Œ [ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#) ä¸€è‡´ï¼Œè§ [`application.yaml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo14ProducerTest.java) æ–‡ä»¶ã€‚\n\n## 15.3 Demo14Message\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.message`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo14Message](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo14Message.java) æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚\n\nå’Œ[ã€Œ3.1.4 Demo01Messageã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚\n\n## 15.4 RabbitConfig\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.config`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config) åŒ…ä¸‹ï¼Œåˆ›å»º [RabbitConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java) é…ç½®ç±»ï¼Œæ·»åŠ  Direct Exchange ç¤ºä¾‹ç›¸å…³çš„ Exchangeã€Queueã€Binding çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// RabbitConfig.java")]),e._v(" "),r("p",[e._v("@Configuration\npublic class RabbitConfig {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("/**\n * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n */\npublic static class DirectExchangeDemoConfiguration {\n\n    // åˆ›å»º Queue\n    @Bean\n    public Queue demo01Queue() {\n        return new Queue(Demo14Message.QUEUE, // Queue åå­—\n                false, // durable: æ˜¯å¦æŒä¹…åŒ–\n                false, // exclusive: æ˜¯å¦æ’å®ƒ\n                false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n    }\n\n    // åˆ›å»º Direct Exchange\n    @Bean\n    public DirectExchange demo01Exchange() {\n        return new DirectExchange(Demo14Message.EXCHANGE,\n                false,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                false);  // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n    }\n\n    // åˆ›å»º Binding\n    // Exchangeï¼šDemo01Message.EXCHANGE\n    // Routing keyï¼šDemo01Message.ROUTING_KEY\n    // Queueï¼šDemo01Message.QUEUE\n    @Bean\n    public Binding demo01Binding() {\n        return BindingBuilder.bind(demo01Queue()).to(demo01Exchange()).with(Demo14Message.ROUTING_KEY);\n    }\n\n}\n")])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ä¸åŒäº[ã€Œ3.1.5 RabbitConfigã€](https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#)çš„é…ç½®ï¼Œæˆ‘ä»¬è®¾ç½®é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯æ— éœ€æŒä¹…åŒ–ï¼Œæ¯•ç«Ÿ RPC æ˜¯ä¸ªç¬æ€æ“ä½œã€‚\n\n## 15.5 Demo14Producer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.producer`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo14Producer](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo14Producer.java) ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç° RPC æ“ä½œã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Demo14Producer.java")]),e._v(" "),r("p",[e._v("@Component\npublic class Demo14Producer {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\npublic String syncSend(Integer id) {\n    // åˆ›å»º Demo01Message æ¶ˆæ¯\n    Demo14Message message = new Demo14Message();\n    message.setId(id);\n    // <1> åˆ›å»º CorrelationData å¯¹è±¡\n    CorrelationData correlationData = new CorrelationData(UUID.randomUUID().toString());\n    // <2> åŒæ­¥å‘é€æ¶ˆæ¯ï¼Œå¹¶æ¥æ”¶ç»“æœ\n    return (String) rabbitTemplate.convertSendAndReceive(Demo14Message.EXCHANGE, Demo14Message.ROUTING_KEY, message,\n            correlationData);\n}\n")])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- `<1>` å¤„ï¼Œåˆ›å»º CorrelationData å¯¹è±¡ï¼Œä½¿ç”¨ UUID ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚\n- `<2>` å¤„ï¼Œè°ƒç”¨ `RabbitTemplate#convertSendAndReceive(exchange, routingKey, message, correlationData)` æ–¹æ³•ï¼ŒProducer å‘é€æ¶ˆæ¯ï¼Œå¹¶ç­‰å¾…ç»“æœã€‚è¯¥ç»“æœï¼Œæ˜¯ Consumer æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¿”å›çš„ç»“æœã€‚\n\n## 15.6 Demo14Consumer\n\nåœ¨ [`cn.iocoder.springboot.lab04.rabbitmqdemo.consumer`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/) åŒ…ä¸‹ï¼Œåˆ›å»º [Demo14Consumer](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo14Consumer.java) ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("p",[e._v("// Demo14Consumer.java")]),e._v(" "),r("p",[e._v("@Component\n@RabbitListener(queues = Demo14Message.QUEUE)\npublic class Demo14Consumer {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@RabbitHandler\npublic String onMessage(Demo14Message message) {\n    logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n    // è¿”å›ç»“æœ\n    return "nicai";\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('\n\n\n- æ¶ˆè´¹å®Œæˆåï¼Œé¢å¤–è¿”å›äº† `"nicai"` å­—ç¬¦ä¸²ã€‚\n\n## 15.7 ç®€å•æµ‹è¯•\n\nåˆ›å»º [Demo14ProducerTest](https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-rpc/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo14ProducerTest.java) æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo14Producer çš„ RPC çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š\n\n\n\n')])])]),r("p",[e._v("// Demo14ProducerTest.java")]),e._v(" "),r("p",[e._v("@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo14ProducerTest {")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v('private Logger logger = LoggerFactory.getLogger(getClass());\n\n@Autowired\nprivate Demo14Producer producer;\n\n@Test\npublic void testSyncSend() throws InterruptedException {\n    int id = (int) (System.currentTimeMillis() / 1000);\n    String result = producer.syncSend(id);\n    logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ æ¶ˆè´¹ç»“æœï¼š[{}]]", id, result);\n\n    // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n    new CountDownLatch(1).await();\n}\n')])])]),r("p",[e._v("}")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\næ‰§è¡Œ `#testSyncSend()` å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š\n\n\n\n")])])]),r("h1",{attrs:{id:"demo14consumer-æˆåŠŸæ¶ˆè´¹å‘é€çš„æ¶ˆæ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#demo14consumer-æˆåŠŸæ¶ˆè´¹å‘é€çš„æ¶ˆæ¯"}},[e._v("#")]),e._v(" Demo14Consumer æˆåŠŸæ¶ˆè´¹å‘é€çš„æ¶ˆæ¯")]),e._v(" "),r("p",[e._v("2019-12-13 19:13:36.627  INFO 93696 --- [ntContainer#4-1] c.i.s.l.r.consumer.Demo14Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:25 æ¶ˆæ¯å†…å®¹ï¼šDemo14Message{id=1576235616}]")]),e._v(" "),r("h1",{attrs:{id:"producer-æ‰“å°å‘é€æ¶ˆæ¯çš„æ¶ˆè´¹ç»“æœ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#producer-æ‰“å°å‘é€æ¶ˆæ¯çš„æ¶ˆè´¹ç»“æœ"}},[e._v("#")]),e._v(" Producer æ‰“å°å‘é€æ¶ˆæ¯çš„æ¶ˆè´¹ç»“æœ")]),e._v(" "),r("p",[e._v("2019-12-13 19:13:36.630  INFO 93696 --- [           main] c.i.s.l.r.producer.Demo14ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1576235616] å‘é€æˆåŠŸ æ¶ˆè´¹ç»“æœï¼š[nicai]]")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("\n\n\n- ç¬¦åˆé¢„æœŸ~æ•´ä¸ªè¿‡ç¨‹ï¼Œå¥½å¥½ç†è§£è‰¿è‰¿åœ¨æ—¥å¿—ä¸Šï¼Œæ·»åŠ çš„è¿‡ç¨‹æ³¨é‡Šå™¢ã€‚\n\nğŸ˜ˆ é€šè¿‡ RabbitMQ æ¥å®ç° RPC çš„åŠŸèƒ½ï¼Œçœ‹èµ·æ¥æ˜¯æ¯”è¾ƒé…·ç‚«çš„ã€‚ä¸è¿‡è‰¿è‰¿æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å®é™…çš„ä½¿ç”¨åœºæ™¯ï¼Œæœ‰äº†è§£çš„èƒ–å‹ï¼Œéº»çƒ¦å‘ŠçŸ¥ä¸‹è‰¿è‰¿å™¢ï¼Œè°¢è°¢ã€‚\n\n# 16. MessageConverter\n\n> ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š[lab-04-rabbitmq-demo-json](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json) ã€‚\n\nåœ¨ Spring-AMQP ä¸­ï¼Œé€šè¿‡ [MessageConverter](https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/support/converter/MessageConverter.java) æ¥ä½œä¸ºæ¶ˆæ¯è½¬æ¢å™¨ï¼š\n\n- åœ¨ Producer ä¸­ï¼Œå°† Java POJO è½¬æ¢æˆ AMQP [Message](https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/Message.java) ã€‚\n- åœ¨ Consumer ä¸­ï¼Œå°† AMQP [Message](https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/Message.java) è½¬æ¢æˆ Java POJO ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒRabbitTemplate é‡‡ç”¨ [SimpleMessageConverter](https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/converter/SimpleMessageConverter.java) ã€‚è€Œ SimpleMessageConverter å†…éƒ¨ï¼Œé‡‡ç”¨ Java **è‡ªå¸¦**åºåˆ—åŒ–æ–¹å¼ï¼Œå®ç°å¯¹ Java POJO å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ‰€ä»¥å®˜æ–¹ç›®å‰ä¸æ˜¯å¾ˆæ¨èã€‚ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š\n\n- æ— æ³•è·¨è¯­è¨€\n- åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„å¤ªå¤§\n- åºåˆ—åŒ–æ€§èƒ½å¤ªä½\n\nå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®é‡‡ç”¨ [Jackson2JsonMessageConverter](https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/support/converter/Jackson2JsonMessageConverter.java) ï¼Œä½¿ç”¨ **JSON** å®ç°å¯¹ Java POJO å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚\n\nä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª Jackson2JsonMessageConverter çš„ä½¿ç”¨ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª [lab-04-rabbitmq-demo-json](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json) é¡¹ç›®ã€‚\n\n## 16.1 å¼•å…¥ä¾èµ–\n\nåœ¨ [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/pom.xml) æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–ã€‚\n\n\n\n")])])]),e._v('<?xml version="1.0" encoding="UTF-8"?>\n'),r("p",[r("project",{attrs:{xmlns:"http://maven.apache.org/POM/4.0.0","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"}},[r("parent",[r("groupId",[e._v("org.springframework.boot")]),e._v(" "),r("artifactId",[e._v("spring-boot-starter-parent")]),e._v(" "),r("version",[e._v("2.2.1.RELEASE")]),e._v(" "),r("relativePath")],1),e._v(" "),r("modelVersion",[e._v("4.0.0")])],1)],1),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("<artifactId>lab-04-rabbitmq-demo-json</artifactId>\n\n<dependencies>\n    \x3c!-- å®ç°å¯¹ RabbitMQ çš„è‡ªåŠ¨åŒ–é…ç½® --\x3e\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-amqp</artifactId>\n    </dependency>\n\n    \x3c!-- Jackson ä¾èµ–  --\x3e\n    <dependency>\n        <groupId>com.fasterxml.jackson.core</groupId>\n        <artifactId>jackson-databind</artifactId>\n        <version>2.9.10.1</version>\n    </dependency>\n\n    \x3c!-- æ–¹ä¾¿ç­‰ä¼šå†™å•å…ƒæµ‹è¯• --\x3e\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-test</artifactId>\n        <scope>test</scope>\n    </dependency>\n</dependencies>\n")])])]),e._v("\n```\n"),r("ul",[r("li",[e._v("ç›¸æ¯”"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v("æ¥è¯´ï¼Œé¢å¤–å¼•å…¥ "),r("code",[e._v("jackson-databind")]),e._v(" ä¾èµ–ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_16-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_16-2-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 16.2 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/resources/https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_16-3-demo15message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-demo15message"}},[e._v("#")]),e._v(" 16.3 Demo15Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo15Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo15Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_16-4-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_16-4-rabbitconfig"}},[e._v("#")]),e._v(" 16.4 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œé¢å¤–æ·»åŠ åˆ›å»º Jackson2JsonMessageConverter Bean ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// RabbitConfig.java\n\n@Configuration\npublic class RabbitConfig {\n\n    /**\n     * Direct Exchange ç¤ºä¾‹çš„é…ç½®ç±»\n     */\n    public static class DirectExchangeDemoConfiguration {\n\n        // åˆ›å»º Queue\n        @Bean\n        public Queue demo15Queue() {\n            return new Queue(Demo15Message.QUEUE, // Queue åå­—\n                    true, // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false, // exclusive: æ˜¯å¦æ’å®ƒ\n                    false); // autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤\n        }\n\n        // åˆ›å»º Direct Exchange\n        @Bean\n        public DirectExchange demo15Exchange() {\n            return new DirectExchange(Demo15Message.EXCHANGE,\n                    true,  // durable: æ˜¯å¦æŒä¹…åŒ–\n                    false);  // exclusive: æ˜¯å¦æ’å®ƒ\n        }\n\n        // åˆ›å»º Binding\n        // Exchangeï¼šDemo15Message.EXCHANGE\n        // Routing keyï¼šDemo15Message.ROUTING_KEY\n        // Queueï¼šDemo15Message.QUEUE\n        @Bean\n        public Binding demo15Binding() {\n            return BindingBuilder.bind(demo15Queue()).to(demo15Exchange()).with(Demo15Message.ROUTING_KEY);\n        }\n\n    }\n\n    @Bean\n    public MessageConverter messageConverter() {\n        return new Jackson2JsonMessageConverter();\n    }\n\n}\n")])])]),r("ul",[r("li",[e._v("åœ¨ "),r("code",[e._v("#messageConverter()")]),e._v(" æ–¹æ³•ï¼Œåˆ›å»º Jackson2JsonMessageConverter Bean å¯¹è±¡ã€‚åç»­ï¼Œ"),r("a",{attrs:{href:"https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitAutoConfiguration.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitAutoConfiguration.RabbitTemplateConfiguration"),r("OutboundLink")],1),e._v(" åœ¨åˆ›å»º RabbitTemplate Bean æ—¶ï¼Œä¼šè‡ªåŠ¨æ³¨å…¥å®ƒã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_16-5-demo15producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_16-5-demo15producer"}},[e._v("#")]),e._v(" 16.5 Demo15Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo15Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo15Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("p",[e._v("å¯¹äºèƒ–å‹æ¥è¯´ï¼Œå¯èƒ½æœ€å…³å¿ƒçš„æ˜¯ï¼Œæ¶ˆæ¯ Message æ˜¯æ€ä¹ˆåºåˆ—åŒ–çš„ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("åœ¨åºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Jackson2JsonMessageConverter åºåˆ—åŒ– Message æ¶ˆæ¯å¯¹è±¡ï¼Œå®ƒä¼šåœ¨ RabbitMQ æ¶ˆæ¯ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/MessageProperties.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MessageProperties"),r("OutboundLink")],1),e._v(" çš„ "),r("code",[e._v("__TypeId__")]),e._v(" ä¸Šï¼Œå€¼ä¸º Message æ¶ˆæ¯å¯¹åº”çš„"),r("strong",[e._v("ç±»å…¨å")]),e._v("ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ååºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Jackson2JsonMessageConverter åºåˆ—åŒ–å‡º Message æ¶ˆæ¯å¯¹è±¡ï¼Œå®ƒä¼šæ ¹æ® RabbitMQ æ¶ˆæ¯ "),r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-amqp/src/main/java/org/springframework/amqp/core/MessageProperties.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MessageProperties"),r("OutboundLink")],1),e._v(" çš„ "),r("code",[e._v("__TypeId__")]),e._v(" çš„å€¼ï¼Œååºåˆ—åŒ–æ¶ˆæ¯å†…å®¹æˆè¯¥ Message å¯¹è±¡ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_16-6-demo15consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_16-6-demo15consumer"}},[e._v("#")]),e._v(" 16.6 Demo15Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo15Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo15Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo15Consumer.java\n\n@Component\n@RabbitListener(queues = Demo15Message.QUEUE)\npublic class Demo15Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler(isDefault = true)\n    public void onMessage(Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(),\n                new String(message.getBody()));\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("å› ä¸ºæˆ‘ä»¬å¸Œæœ›é€šè¿‡æŸ¥çœ‹å…·ä½“æ¶ˆæ¯å†…å®¹ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯çœŸçš„ä½¿ç”¨ JSON æ ¼å¼ï¼Œæ‰€ä»¥é‡‡ç”¨ AMQP Message æ¥æ”¶æ¶ˆæ¯ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_16-7-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_16-7-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 16.7 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-json/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo15ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo15ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo15Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo15ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo15ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo15Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("p",[e._v("æ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Producer åŒæ­¥å‘é€ 1 æ¡æ¶ˆæ¯æˆåŠŸ\n2019-12-13 20:38:37.311  INFO 4285 --- [           main] c.i.s.l.r.producer.Demo15ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1576240717] å‘é€æˆåŠŸ]\n\n// Demo15Consumer æ¶ˆè´¹ 1 æ¡æ¶ˆæ¯æˆåŠŸ\n// ä»æ¶ˆæ¯å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° JSON æ ¼å¼ï¼Œè¯´æ˜é…ç½®ç”Ÿæ•ˆï¼Œå˜¿å˜¿ã€‚\n2019-12-13 20:38:37.335  INFO 4285 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo15Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:17 æ¶ˆæ¯å†…å®¹ï¼š{"id":1576240717}]\n')])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸ~")])]),e._v(" "),r("h1",{attrs:{id:"_17-æ¶ˆè´¹å¼‚å¸¸å¤„ç†å™¨"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-æ¶ˆè´¹å¼‚å¸¸å¤„ç†å™¨"}},[e._v("#")]),e._v(" 17. æ¶ˆè´¹å¼‚å¸¸å¤„ç†å™¨")]),e._v(" "),r("blockquote",[r("p",[e._v("ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š"),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-error-handler"),r("OutboundLink")],1),e._v(" ã€‚")])]),e._v(" "),r("p",[e._v("åœ¨"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ7. æ¶ˆè´¹é‡è¯•ã€"),r("OutboundLink")],1),e._v("ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹äº†ä¸‹ï¼Œåœ¨ Consumer æ¶ˆè´¹å¼‚å¸¸æ—¶ï¼ŒSpring-AMQP æä¾›çš„"),r("strong",[e._v("æ¶ˆè´¹é‡è¯•")]),e._v("æœºåˆ¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ Spring-AMQP ä¸­å¯ä»¥è‡ªå®šä¹‰æ¶ˆè´¹å¼‚å¸¸æ—¶çš„å¤„ç†å™¨ã€‚ç›®å‰æœ‰ä¸¤ä¸ªæ¥å£ï¼Œå¯ä»¥å®ç°å¯¹ Consumer æ¶ˆè´¹å¼‚å¸¸çš„å¤„ç†ï¼š")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/spring-projects/spring-amqp/blob/master/spring-rabbit/src/main/java/org/springframework/amqp/rabbit/listener/api/RabbitListenerErrorHandler.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("org.springframework.amqp.rabbit.listener.api.RabbitListenerErrorHandler")]),r("OutboundLink")],1),e._v(" æ¥å£")]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/ErrorHandler.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("org.springframework.util.ErrorHandler")]),r("OutboundLink")],1),e._v(" æ¥å£")])]),e._v(" "),r("p",[e._v("ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª RabbitListenerErrorHandler å’Œ ErrorHandler çš„ä½¿ç”¨ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler",target:"_blank",rel:"noopener noreferrer"}},[e._v("lab-04-rabbitmq-demo-error-handler"),r("OutboundLink")],1),e._v(" é¡¹ç›®ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-1-rabbitlistenererrorhandlerimpl"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-1-rabbitlistenererrorhandlerimpl"}},[e._v("#")]),e._v(" 17.1 RabbitListenerErrorHandlerImpl")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.core")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core/RabbitListenerErrorHandlerImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitListenerErrorHandlerImpl"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ç° RabbitListenerErrorHandler æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// RabbitListenerErrorHandler.java\n\n@Component("rabbitListenerErrorHandler")\npublic class RabbitListenerErrorHandlerImpl implements RabbitListenerErrorHandler {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Override\n    public Object handleError(Message amqpMessage, org.springframework.messaging.Message<?> message,\n                              ListenerExecutionFailedException exception) {\n        // æ‰“å°å¼‚å¸¸æ—¥å¿—\n        logger.error("[handleError][amqpMessage:[{}] message:[{}]]", amqpMessage, message, exception);\n\n        // ç›´æ¥ç»§ç»­æŠ›å‡ºå¼‚å¸¸\n        throw exception;\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ç±»ä¸Šï¼Œæ·»åŠ  "),r("code",[e._v("@Component")]),e._v(" æ³¨è§£ï¼Œå¹¶è®¾ç½®å…¶ Bean åä¸º "),r("code",[e._v('"rabbitListenerErrorHandler"')]),e._v(" ã€‚ç¨åï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°è¯¥ Bean åå­—ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ "),r("code",[e._v("#handleError(...)")]),e._v(" æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å…ˆæ‰“å°å¼‚å¸¸æ—¥å¿—ï¼Œå¹¶ç»§ç»­æŠ›å‡º ListenerExecutionFailedException å¼‚å¸¸ã€‚"),r("strong",[e._v("è¦æ³¨æ„")]),e._v("ï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬ä¸ç»§ç»­æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯ "),r("code",[e._v("return")]),e._v(" ç»“æœï¼Œæ„å‘³ç€ Consumer æ¶ˆæ¯æˆåŠŸã€‚å¦‚æœæˆ‘ä»¬ç»“åˆ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ7. æ¶ˆè´¹é‡è¯•ã€"),r("OutboundLink")],1),e._v("ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸€å®šè¦ç»§ç»­æŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œå¦åˆ™æ¶ˆè´¹é‡è¯•æœºåˆ¶å°†å¤±æ•ˆã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_17-2-rabbitloggingerrorhandler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-2-rabbitloggingerrorhandler"}},[e._v("#")]),e._v(" 17.2 RabbitLoggingErrorHandler")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.core")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/core/RabbitLoggingErrorHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitLoggingErrorHandler"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ç° ErrorHandler æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// RabbitLoggingErrorHandler.java\n\n@Component\npublic class RabbitLoggingErrorHandler implements ErrorHandler {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    public RabbitLoggingErrorHandler(SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory) {\n        rabbitListenerContainerFactory.setErrorHandler(this);\n    }\n\n    @Override\n    public void handleError(Throwable t) {\n        logger.error("[handleError][å‘ç”Ÿå¼‚å¸¸]]", t);\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨æ„é€ æ–¹æ³•ä¸­ï¼ŒæŠŠè‡ªå·±è®¾ç½®åˆ° SimpleRabbitListenerContainerFactory ä¸­ï¼Œä½œä¸ºå…¶ ErrorHandler å¼‚å¸¸å¤„ç†å™¨ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ "),r("code",[e._v("#handleError(...)")]),e._v(" æ–¹æ³•ä¸­ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ã€‚å½“ç„¶ï¼Œå…·ä½“æ€ä¹ˆå¤„ç†ï¼Œèƒ–å‹å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å“ˆã€‚")])]),e._v(" "),r("p",[e._v("åœ¨æ‰§è¡Œ"),r("strong",[e._v("é¡ºåº")]),e._v("ä¸Šï¼ŒRabbitListenerErrorHandler "),r("strong",[e._v("å…ˆ")]),e._v("äº ErrorHandler æ‰§è¡Œã€‚ä¸è¿‡è¿™ä¸ªéœ€è¦å»ºç«‹åœ¨ä¸€ä¸ªå‰æä¸Šï¼ŒRabbitListenerErrorHandler éœ€è¦ç»§ç»­æŠ›å‡ºå¼‚å¸¸ã€‚")]),e._v(" "),r("p",[e._v("å¦å¤–ï¼ŒRabbitListenerErrorHandler éœ€è¦æ¯ä¸ª "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ä¸Šï¼Œéœ€è¦æ¯ä¸ªæ‰‹åŠ¨è®¾ç½®ä¸‹ "),r("code",[e._v("errorHandler")]),e._v(" å±æ€§ã€‚è€Œ ErrorHandler æ˜¯ç›¸å¯¹å…¨å±€çš„ï¼Œæ‰€æœ‰ SimpleRabbitListenerContainerFactory åˆ›å»ºçš„ SimpleMessageListenerContainer éƒ½ä¼šç”Ÿæ•ˆã€‚")]),e._v(" "),r("p",[e._v("å…·ä½“é€‰æ‹© ErrorHandler è¿˜æ˜¯ RabbitLoggingErrorHandler ï¼Œè‰¿è‰¿æš‚æ—¶æ²¡æœ‰ç­”æ¡ˆã€‚ä¸è¿‡ä¸ªäººæ„Ÿè§‰ï¼Œå¦‚æœä¸éœ€è¦å¯¹ Consumer æ¶ˆè´¹çš„ç»“æœï¼ˆåŒ…æ‹¬æˆåŠŸå’Œå¼‚å¸¸ï¼‰åšè¿›ä¸€æ­¥å¤„ç†ï¼Œè¿˜æ˜¯è€ƒè™‘ ErrorHandler å³å¯ã€‚åœ¨ ErrorHandler ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­ Throwable å¼‚å¸¸æ˜¯ä¸æ˜¯ ListenerExecutionFailedException å¼‚å¸¸ï¼Œä»è€Œæ‹¿åˆ° Message ç›¸å…³çš„ä¿¡æ¯ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-3-å¼•å…¥ä¾èµ–"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-3-å¼•å…¥ä¾èµ–"}},[e._v("#")]),e._v(" 17.3 å¼•å…¥ä¾èµ–")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("pom.xml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-4-åº”ç”¨é…ç½®æ–‡ä»¶"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-4-åº”ç”¨é…ç½®æ–‡ä»¶"}},[e._v("#")]),e._v(" 17.4 åº”ç”¨é…ç½®æ–‡ä»¶")]),e._v(" "),r("p",[e._v("å’Œ "),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€"),r("OutboundLink")],1),e._v(" ä¸€è‡´ï¼Œè§ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/resources/application.yaml",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("application.yaml")]),r("OutboundLink")],1),e._v(" æ–‡ä»¶ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-5-demo16message"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-5-demo16message"}},[e._v("#")]),e._v(" 17.5 Demo16Message")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.message")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/message/Demo16Message.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo16Message"),r("OutboundLink")],1),e._v(" æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.4 Demo01Messageã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-6-rabbitconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-6-rabbitconfig"}},[e._v("#")]),e._v(" 17.6 RabbitConfig")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.config")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/config/RabbitConfig.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("RabbitConfig"),r("OutboundLink")],1),e._v(" é…ç½®ç±»ï¼Œé…ç½®ç›¸å…³çš„ Exchangeã€Queueã€Binding ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.5 RabbitConfigã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€Queueã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-7-demo16producer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-7-demo16producer"}},[e._v("#")]),e._v(" 17.7 Demo16Producer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.producer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo16Producer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo16Producer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Spring-AMQP å°è£…æä¾›çš„ RabbitTemplate ï¼Œå®ç°å‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),r("p",[e._v("å’Œ"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ3.1.6 Demo01Producerã€"),r("OutboundLink")],1),e._v("ä¸€è‡´ï¼Œåªæ˜¯ Exchangeã€RoutingKey åå­—ä¸åŒã€‚")]),e._v(" "),r("h2",{attrs:{id:"_17-8-demo16consumer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-8-demo16consumer"}},[e._v("#")]),e._v(" 17.8 Demo16Consumer")]),e._v(" "),r("p",[e._v("åœ¨ "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("cn.iocoder.springboot.lab04.rabbitmqdemo.consumer")]),r("OutboundLink")],1),e._v(" åŒ…ä¸‹ï¼Œåˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/main/java/cn/iocoder/springboot/lab04/rabbitmqdemo/consumer/Demo16Consumer.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo16Consumer"),r("OutboundLink")],1),e._v(" ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo16Consumer.java\n\n@Component\n@RabbitListener(queues = Demo16Message.QUEUE,\n    errorHandler = "rabbitListenerErrorHandler")\npublic class Demo16Consumer {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @RabbitHandler\n    public void onMessage(Demo16Message message) {\n        logger.info("[onMessage][çº¿ç¨‹ç¼–å·:{} æ¶ˆæ¯å†…å®¹ï¼š{}]", Thread.currentThread().getId(), message);\n        // æ¨¡æ‹Ÿæ¶ˆè´¹å¼‚å¸¸\n        throw new RuntimeException("ä½ çŒœ");\n    }\n\n}\n')])])]),r("ul",[r("li",[e._v("åœ¨ "),r("code",[e._v("@RabbitListener")]),e._v(" æ³¨è§£ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½® "),r("code",[e._v("errorHandler")]),e._v(" å±æ€§ä¸º"),r("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/RabbitMQ/?github#",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Œ17.1 RabbitListenerErrorHandlerImplã€"),r("OutboundLink")],1),e._v("çš„åå­—ã€‚")]),e._v(" "),r("li",[e._v("åœ¨ "),r("code",[e._v("#onMessage(...)")]),e._v(" æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŠ›å‡º RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¼‚å¸¸ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_17-9-ç®€å•æµ‹è¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_17-9-ç®€å•æµ‹è¯•"}},[e._v("#")]),e._v(" 17.9 ç®€å•æµ‹è¯•")]),e._v(" "),r("p",[e._v("åˆ›å»º "),r("a",{attrs:{href:"https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-04-rabbitmq/lab-04-rabbitmq-demo-error-handler/src/test/java/cn/iocoder/springboot/lab04/rabbitmqdemo/producer/Demo16ProducerTest.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Demo16ProducerTest"),r("OutboundLink")],1),e._v(" æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo16Producer å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('// Demo16ProducerTest.java\n\n@RunWith(SpringRunner.class)\n@SpringBootTest(classes = Application.class)\npublic class Demo16ProducerTest {\n\n    private Logger logger = LoggerFactory.getLogger(getClass());\n\n    @Autowired\n    private Demo16Producer producer;\n\n    @Test\n    public void testSyncSend() throws InterruptedException {\n        int id = (int) (System.currentTimeMillis() / 1000);\n        producer.syncSend(id);\n        logger.info("[testSyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ]", id);\n\n        // é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹\n        new CountDownLatch(1).await();\n    }\n\n}\n')])])]),r("p",[e._v("æ‰§è¡Œ "),r("code",[e._v("#testSyncSend()")]),e._v(" å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// Producer åŒæ­¥å‘é€ 1 æ¡æ¶ˆæ¯æˆåŠŸ\n2019-12-13 22:35:54.459  INFO 22515 --- [           main] c.i.s.l.r.producer.Demo16ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1576247754] å‘é€æˆåŠŸ]\n\n// Demo08Consumer æ¶ˆè´¹ 1 æ¡æ¶ˆæ¯æˆåŠŸ\n2019-12-13 22:35:57.254  INFO 22515 --- [ntContainer#0-1] c.i.s.l.r.consumer.Demo16Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo16Message{id=1576247754}]\n\n// RabbitListenerErrorHandler å…ˆå¤„ç†å¼‚å¸¸\n2019-12-13 22:35:57.263 ERROR 22515 --- [ntContainer#0-1] i.s.l.r.c.RabbitListenerErrorHandlerImpl : [handleError][amqpMessage:[(Body:'[B@401abc48(byte[187])' MessageProperties [headers={}, contentType=application/x-java-serialized-object, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, redelivered=false, receivedExchange=EXCHANGE_DEMO_16, receivedRoutingKey=ROUTING_KEY_16, deliveryTag=1, consumerTag=amq.ctag-tUY94gzefw73JvHtgqwMnQ, consumerQueue=QUEUE_DEMO_16])] message:[GenericMessage [payload=Demo16Message{id=1576247754}, headers={amqp_receivedDeliveryMode=PERSISTENT, amqp_receivedRoutingKey=ROUTING_KEY_16, amqp_receivedExchange=EXCHANGE_DEMO_16, amqp_deliveryTag=1, amqp_consumerQueue=QUEUE_DEMO_16, amqp_channel=Cached Rabbit Channel: AMQChannel(amqp://guest@127.0.0.1:5672/,1), conn: Proxy@10bd9df0 Shared Rabbit Connection: SimpleConnection@68217d41 [delegate=amqp://guest@127.0.0.1:5672/, localPort= 56809], amqp_redelivered=false, id=34327625-9ef4-0433-3514-a6633bfad100, amqp_consumerTag=amq.ctag-tUY94gzefw73JvHtgqwMnQ, amqp_lastInBatch=false, contentType=application/x-java-serialized-object, timestamp=1576247757255}]]]\n\norg.springframework.amqp.rabbit.support.ListenerExecutionFailedException: Listener method 'public void cn.iocoder.springboot.lab04.rabbitmqdemo.consumer.Demo16Consumer.onMessage(cn.iocoder.springboot.lab04.rabbitmqdemo.message.Demo16Message)' threw exception\n// ... çœç•¥å¼‚å¸¸å †æ ˆ\n\n// ErrorHandler å†å¤„ç†å™¨å¼‚å¸¸\n2019-12-13 22:36:00.175 ERROR 22515 --- [ntContainer#0-1] c.i.s.l.r.c.RabbitLoggingErrorHandler    : [handleError][å‘ç”Ÿå¼‚å¸¸]]\n\norg.springframework.amqp.rabbit.support.ListenerExecutionFailedException: Listener method 'public void cn.iocoder.springboot.lab04.rabbitmqdemo.consumer.Demo16Consumer.onMessage(cn.iocoder.springboot.lab04.rabbitmqdemo.message.Demo16Message)' threw exception\n// ... çœç•¥å¼‚å¸¸å †æ ˆ\n")])])]),r("ul",[r("li",[e._v("ç¬¦åˆé¢„æœŸ~")])])])}),[],!1,null,null,null);r.default=t.exports}}]);