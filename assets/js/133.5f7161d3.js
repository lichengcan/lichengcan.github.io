(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{549:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("seata官网："),s("a",{attrs:{href:"http://seata.io/zh-cn/index.html"}},[t._v("http://seata.io/zh-cn/index.html")]),s("br"),t._v(" seata-server： "),s("a",{attrs:{href:"https://github.com/seata/seata/releases"}},[t._v("https://github.com/seata/seata/releases")]),s("br")])]),t._v(" "),s("h3",{attrs:{id:"二-seata-server配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-seata-server配置"}},[t._v("#")]),t._v(" 二. seata-server配置")]),t._v(" "),s("h4",{attrs:{id:"_1-1-下载seater-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-下载seater-server"}},[t._v("#")]),t._v(" 1.1 下载seater-server")]),t._v(" "),s("p",[t._v("下载指定版本seata-server，本案例使用v1.6.1版本。")]),t._v(" "),s("h4",{attrs:{id:"_1-2-修改seata-conf-application-yml配置文件-已删除无用配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-修改seata-conf-application-yml配置文件-已删除无用配置"}},[t._v("#")]),t._v(" 1.2 修改seata/conf/application.yml配置文件(已删除无用配置)")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7091")]),t._v("\nspring"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  application"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server  # seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server服务名\nlogging"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" classpath"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("logback"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("spring"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xml\n  file"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("runlogs  # 指定日志路径\n  extend"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    logstash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("appender"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      destination"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4560")]),t._v("\n    kafka"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("appender"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      bootstrap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("servers"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9092")]),t._v("\n      topic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" logback_to_logstash\n\n# seata可视化web界面账号密码\nconsole"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" seata\n    password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" seata\n\nseata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\t# 配置中心\n  config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    # support"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" consul"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" apollo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" etcd3\n    type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos # 指定配置中心为nacos\n    nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8848")]),t._v("  # nacos的ip端口\n      group"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEFAULT_GROUP")]),t._v("\t# 对应的组，默认为"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEFAULT_GROUP")]),t._v("\n      namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a090b021"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("160")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42f")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("98d")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("b1f9a5619d97 # 对应的命名空间，在nacos中配置\n      username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos\n      password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos\n      data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" seataServer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("properties # nacos中存放seata的配置文件，后面会提该文件的使用方式，相当于seata服务启动的时候需要注册到nacos，并使用nacos中的配置文件\n  \n  # 注册中心与上述config同理\n  registry"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    # support"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eureka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" consul"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" etcd3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sofa\n    type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos\n    nacos"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      application"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server\n      server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8848")]),t._v("\n      namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a090b021"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("160")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42f")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("98d")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("b1f9a5619d97\n      group"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEFAULT_GROUP")]),t._v("\n      cluster"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v("\n      username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos\n      password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nacos\n\n  security"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    secretKey"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SeataSecretKey0c382ef121d778043159209298fd40bf3850a017")]),t._v("\n    tokenValidityInMilliseconds"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1800000")]),t._v("\n    ignore"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      urls"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("svg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ico"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("fe"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**,/api/v1/auth/login\n")])])])]),s("p",[t._v("【注意】")]),t._v(" "),s("ul",[s("li",[t._v("seata.config.type 与seata.registry.type 都要修改为nacos")]),t._v(" "),s("li",[t._v("修改config与registry中nacos的配置，其中namespace与group须提前在nacos中进行配置")])]),t._v(" "),s("h3",{attrs:{id:"二-nacos配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-nacos配置"}},[t._v("#")]),t._v(" 二. nacos配置")]),t._v(" "),s("h4",{attrs:{id:"_2-1-新建namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-新建namespace"}},[t._v("#")]),t._v(" 2.1 新建namespace")]),t._v(" "),s("p",[t._v("新建namespace命名空间，（a090b021-160c-42fb-98de-b1f9a5619d97）需与上述seata-server的application.yml中配置一致")]),t._v(" "),s("h4",{attrs:{id:"_2-2-新建seata的seataserver-properties配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-新建seata的seataserver-properties配置文件"}},[t._v("#")]),t._v(" 2.2 新建seata的seataServer.properties配置文件")]),t._v(" "),s("p",[t._v("在上述namespace下新建application.yml中seata.config.nacos.data-id提到的配置文件：seataServer.properties")]),t._v(" "),s("p",[t._v("seataServer.properties 已删除无用配置")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("For")]),t._v(" details about configuration items"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" see https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("seata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cn"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("configurations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transport")]),t._v(" configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" client and server\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TCP")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NIO")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heartbeat"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enableTmClientBatchSendRequest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enableRmClientBatchSendRequest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enableTcServerBatchSendResponse"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpcRmRequestTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpcTmRequestTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rpcTcRequestTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bossThreadPrefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NettyBoss")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workerThreadPrefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NettyServerNIOWorker")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serverExecutorThreadPrefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NettyServerBizHandler")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shareBossWorker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientSelectorThreadPrefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NettyClientSelector")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientSelectorThreadSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientWorkerThreadPrefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NettyClientWorkerThread")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bossThreadSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threadFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workerThreadSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shutdown"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serialization"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("seata\ntransport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compressor"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("none\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transaction")]),t._v(" routing rules configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the client\n# 此处的mygroup名字可以自定义，只修改这个值即可\n#这个group的作用还待研究，我改成其他的都不行\nservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vgroupMapping"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mygroup"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v("\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("If")]),t._v(" you use a registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" you can ignore it\n#这个地方是seata的地址，seata的访问地址是"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7091")]),t._v("端口，"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v("是注册到nacos开放的端口\nservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("grouplist"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v("\nservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enableDegrade"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("disableGlobalTransaction"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transaction")]),t._v(" rule configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the client\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asyncCommitBufferLimit"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("retryInterval"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("retryTimes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("retryPolicyBranchRollbackOnConflict"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reportRetryCount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tableMetaCheckEnable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tableMetaCheckerInterval"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sqlParserType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("druid\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reportSuccessEnable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sagaBranchRegisterEnable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sagaJsonParser"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fastjson\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tccActionInterceptorOrder"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2147482648")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commitRetryCount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rollbackRetryCount"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultGlobalTransactionTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("degradeCheck"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("degradeCheckAllowTimes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("degradeCheckPeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptorOrder"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2147482648")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataValidation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logSerialization"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("jackson\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onlyCareUpdateColumns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logSaveDays"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logDeletePeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("86400000")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logTable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("undo_log\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("zip\nclient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("undo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("threshold"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("k\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("For")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TCC")]),t._v(" transaction mode\ntcc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fence"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logTableName"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tcc_fence_log\ntcc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fence"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cleanPeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("h\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),t._v(" rule configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" client and server\nlog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exceptionRate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transaction")]),t._v(" storage configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v(" The")]),t._v(" file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" and redis configuration values are optional"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n# 默认为file，一定要改为db，我们自己的服务启动会连接不到seata\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("db\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("db\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("db\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Used")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" password encryption\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("These")]),t._v(" configurations are required "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" the `store mode` is `db`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("If")]),t._v(" `store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode` are not equal "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" `db`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" you can remove the configuration block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n# 修改mysql的配置\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datasource"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("druid\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dbType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("driverClassName"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("Driver")]),t._v("\n# 指定seata的数据库，下面会提\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("jdbc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("useUnicode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("rewriteBatchedStatements"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("banmajio\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("minConn"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("maxConn"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("globalTable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("global_table\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("branchTable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("branch_table\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("distributedLockTable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("distributed_lock\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queryLimit"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lockTable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lock_table\nstore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("maxWait"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transaction")]),t._v(" rule configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the server\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recovery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("committingRetryPeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recovery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asynCommittingRetryPeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recovery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rollbackingRetryPeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recovery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timeoutRetryPeriod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("maxCommitRetryTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("maxRollbackRetryTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rollbackRetryTimeoutUnlockEnable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("distributedLockExpireTime"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xaerNotaRetryTimeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("branchAsyncQueueSize"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enableBranchAsyncRemove"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enableParallelRequestHandle"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n#"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Metrics")]),t._v(" configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" only "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the server\nmetrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nmetrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("registryType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("compact\nmetrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporterList"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus\nmetrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exporterPrometheusPort"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9898")]),t._v("\n")])])]),s("p",[s("a",{attrs:{href:""}},[t._v("【注意】")])]),t._v(" "),s("ol",[s("li",[t._v("修改service.vgroupMapping.mygroup=default该值，其中mygroup可以自定义，后面我们自己的服务启动时，配置文件中需要指定该group。")]),t._v(" "),s("li",[t._v("修改store.mode store.lock.mode store.session.mode这三个值为db，才能让seata连接到下面的数据库中。")]),t._v(" "),s("li",[t._v("修改store.db配置项下的配置，连接到自己的数据库。")]),t._v(" "),s("li",[t._v("该文件参数的具体作用参考官网： "),s("a",{attrs:{href:"http://seata.io/zh-cn/docs/user/configurations.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("seata配置文件详解（官网）"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("该配置源文件存放在seata目录下：seata/script/config-center/config.txt")])]),t._v(" "),s("h3",{attrs:{id:"三-mysql配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三-mysql配置"}},[t._v("#")]),t._v(" 三. MySQL配置")]),t._v(" "),s("h4",{attrs:{id:"_3-1-新建seata数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-新建seata数据库"}},[t._v("#")]),t._v(" 3.1 新建seata数据库")]),t._v(" "),s("p",[t._v("数据库的名称与上述3.2seata配置文件中的store.db.url保持一致。")]),t._v(" "),s("h4",{attrs:{id:"_3-2-新建seata配置表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-新建seata配置表"}},[t._v("#")]),t._v(" 3.2 新建seata配置表")]),t._v(" "),s("p",[t._v("在上述库中添加seata的配置表，sql文件存放在：seata/script/server/db/mysql.sql中")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("The")]),t._v(" script used when storeMode is "),s("span",{pre:!0,attrs:{class:"token char"}},[t._v("'db'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" the table "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("store")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalSession")]),t._v(" data\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXISTS")]),t._v(" `global_table`\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    `xid`                       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `transaction_id`            "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `status`                    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TINYINT")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `application_id`            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `transaction_service_group` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `transaction_name`          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `timeout`                   "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `begin_time`                "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `application_data`          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `gmt_create`                "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `gmt_modified`              "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`xid`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `idx_status_gmt_modified` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`status` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" `gmt_modified`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `idx_transaction_id` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`transaction_id`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENGINE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InnoDB")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CHARSET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utf8mb4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" the table "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("store")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BranchSession")]),t._v(" data\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXISTS")]),t._v(" `branch_table`\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    `branch_id`         "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `xid`               "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `transaction_id`    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `resource_group_id` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `resource_id`       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `branch_type`       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `status`            "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TINYINT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `client_id`         "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `application_data`  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `gmt_create`        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `gmt_modified`      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`branch_id`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `idx_xid` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`xid`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENGINE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InnoDB")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CHARSET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utf8mb4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" the table "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("store")]),t._v(" lock data\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXISTS")]),t._v(" `lock_table`\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    `row_key`        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `xid`            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `transaction_id` "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `branch_id`      "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `resource_id`    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `table_name`     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `pk`             "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("36")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `status`         "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TINYINT")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token char"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COMMENT")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("locked "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("rollbacking'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `gmt_create`     "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `gmt_modified`   "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`row_key`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `idx_status` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`status`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `idx_branch_id` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`branch_id`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `idx_xid` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`xid`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENGINE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InnoDB")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CHARSET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utf8mb4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXISTS")]),t._v(" `distributed_lock`\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    `lock_key`       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `lock_value`     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("VARCHAR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    `expire`         "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BIGINT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    primary key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`lock_key`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENGINE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InnoDB")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CHARSET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utf8mb4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSERT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTO")]),t._v(" `distributed_lock` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock_value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AsyncCommitting")]),s("span",{pre:!0,attrs:{class:"token char"}},[t._v("', '")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSERT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTO")]),t._v(" `distributed_lock` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock_value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryCommitting")]),s("span",{pre:!0,attrs:{class:"token char"}},[t._v("', '")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSERT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTO")]),t._v(" `distributed_lock` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock_value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryRollbacking")]),s("span",{pre:!0,attrs:{class:"token char"}},[t._v("', '")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSERT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INTO")]),t._v(" `distributed_lock` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock_value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TxTimeoutCheck")]),s("span",{pre:!0,attrs:{class:"token char"}},[t._v("', '")]),t._v(" '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_3-3-业务数据库添加undo-log表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-业务数据库添加undo-log表"}},[t._v("#")]),t._v(" 3.3 业务数据库添加undo_log表")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" 注意此处"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" 增加唯一索引 ux_undo_log\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TABLE")]),t._v(" `undo_log` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  `id` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bigint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `branch_id` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bigint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `xid` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `context` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `rollback_info` longblob "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `log_status` "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `log_created` datetime "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `log_modified` datetime "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  `ext` "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`id`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UNIQUE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY")]),t._v(" `ux_undo_log` "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`xid`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("`branch_id`"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4-seata-server启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-seata-server启动"}},[t._v("#")]),t._v(" 4. seata-server启动")]),t._v(" "),s("p",[t._v("seata 的 /bin 目录下 ：/seata/bin 执行下面的脚本")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("sh seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8091")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n")])])]),s("p",[t._v("在windows下启动")]),t._v(" "),s("blockquote",[s("p",[t._v("seata-server.bat -p 8091 -h 127.0.0.1")])]),t._v(" "),s("p",[t._v("参数解释： -h： 将地址暴露给注册中心，其他服务可以访问seata服务器 -p：要侦听的端口")]),t._v(" "),s("p",[t._v("启动成功后，即可访问  "),s("a",{attrs:{href:"http://127.0.0.1:7091/#/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:7091/#/login"),s("OutboundLink")],1),t._v(" 改地址进入seata的webui，用户名与密码默认为seata，可在上面的 "),s("a",{attrs:{href:"#click_me_jump"}},[t._v("1.2章节中")]),t._v("中提到的application.yml配置项：console.user中修改")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/1c6820b5879a45ec838ddd7f5c1fb6e4.png",alt:""}})]),t._v(" "),s("p",[t._v("并且查看nacos中的服务注册中心是否可以看到seata-server")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/lichengcan/images/main/d3767656a3944fe8985bb8048ecc6611.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("至此，seater-server的配置与部署完成")])]),t._v(" "),s("h3",{attrs:{id:"五-springcloud整合seata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五-springcloud整合seata"}},[t._v("#")]),t._v(" 五. SpringCloud整合Seata")]),t._v(" "),s("h4",{attrs:{id:"_5-1-项目地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-项目地址"}},[t._v("#")]),t._v(" 5.1 项目地址")]),t._v(" "),s("p",[t._v("https://github.com/lichengcan/SpringBoot-Labs/tree/master/labx-17")]),t._v(" "),s("h4",{attrs:{id:"_5-2-bootstrap-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-bootstrap-yml"}},[t._v("#")]),t._v(" 5.2 bootstrap.yml")]),t._v(" "),s("p",[t._v("配置文件中加入以下配置")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("seata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  tx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("group"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mygroup # 事务分组名称，要和服务端对应\n  service"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    vgroup"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mapping"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      mygroup"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" # key是事务分组名称 value要和服务端的机房名称保持一致\n")])])]),s("p",[t._v("其中tx-service-group配置项要与  "),s("a",{attrs:{href:"#click_me_jump2"}},[t._v("上述2.3章节")]),t._v("中提到的service.vgroupMapping.mygroup=default中的group保持一致， seata.service.vgroup-mapping.mygroup 中的mygroup同理。")]),t._v(" "),s("h4",{attrs:{id:"_5-3-启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-启动服务"}},[t._v("#")]),t._v(" 5.3 启动服务")]),t._v(" "),s("p",[t._v("我们自己的服务要与seata-server服务在同一个namespace下 查看服务是否启动成功 查看nacos的对应的namespace中服务是否注册成功")]),t._v(" "),s("h4",{attrs:{id:"_5-4-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-使用"}},[t._v("#")]),t._v(" 5.4 使用")]),t._v(" "),s("p",[t._v("在外层接口上增加@GlobalTransactional注解")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/remoteTest"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GlobalTransactional")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remoteTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   \n        orderService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remoteTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order success"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("只需要在最外层方法上添加注解即可，子事务方法上不需要添加@GlobalTransactional与@Transactional注解。")])])}),[],!1,null,null,null);s.default=e.exports}}]);