(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{556:function(a,s,t){"use strict";t.r(s);var e=t(2),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"下载-elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载-elasticsearch"}},[a._v("#")]),a._v(" 下载 Elasticsearch")]),a._v(" "),s("p",[a._v("​    1. Elasticsearch 官网下载链接")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.elastic.co/cn/downloads/elasticsearch",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/cn/downloads/elasticsearch"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("安装 Elasticsearch（ES）需要以下步骤：")]),a._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[a._v("安装 Java")])]),a._v(" "),s("p",[a._v("Elasticsearch 是基于 Java 运行的，所以需要先安装 Java。最好使用 Oracle JDK 或 OpenJDK 8 版本。")]),a._v(" "),s("p",[a._v("可以使用以下命令来安装 OpenJDK：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo yum install java-1.8.0-openjdk\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("安装 Elasticsearch")])]),a._v(" "),s("p",[a._v("将下载的 Elasticsearch 压缩包解压到指定目录下，例如 "),s("code",[a._v("/usr/local")]),a._v(" 目录下：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo tar -xzf elasticsearch-7.16.2-linux-x86_64.tar.gz -C /usr/local/\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("启动 Elasticsearch")])]),a._v(" "),s("p",[a._v("进入 Elasticsearch 目录下的 "),s("code",[a._v("bin")]),a._v(" 目录，执行以下命令启动 Elasticsearch：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo ./elasticsearch\n在后台运行：\nsudo nohup ./elasticsearch &\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("验证 Elasticsearch 是否启动成功")])]),a._v(" "),s("p",[a._v("使用 curl 命令验证 Elasticsearch 是否启动成功：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("curl http://localhost:9200/\n")])])]),s("p",[a._v("如果返回类似以下内容，则表示 Elasticsearch 已经成功安装并启动：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('{\n  "name" : "Your-Hostname",\n  "cluster_name" : "elasticsearch",\n  "cluster_uuid" : "xxxxxxxxxxxxxxxxxxxx",\n  "version" : {\n    "number" : "7.16.2",\n    "build_flavor" : "default",\n    "build_type" : "tar",\n    "build_hash" : "d47ad2a",\n    "build_date" : "2022-01-19T22:14:02.141971330Z",\n    "build_snapshot" : false,\n    "lucene_version" : "8.10.2",\n    "minimum_wire_compatibility_version" : "6.8.0",\n    "minimum_index_compatibility_version" : "6.0.0-beta1"\n  },\n  "tagline" : "You Know, for Search"\n}\n')])])]),s("p",[a._v("以上就是在 CentOS 7 中安装 Elasticsearch 的步骤。")]),a._v(" "),s("h2",{attrs:{id:"启动报错1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动报错1"}},[a._v("#")]),a._v(" 启动报错1")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2023/12/18/3SNhWsUOvl9nLEy.png",alt:""}})]),a._v(" "),s("p",[a._v("根据你提供的信息，Elasticsearch 无法以 root 用户身份运行。建议你使用非 root 用户运行 Elasticsearch。")]),a._v(" "),s("p",[a._v("可以创建一个新的用户并分配合适的权限，然后使用该用户运行 Elasticsearch。请按照以下步骤操作：")]),a._v(" "),s("ol",[s("li",[a._v("创建新用户")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo useradd es\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("设置新用户密码")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo passwd es\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("将 Elasticsearch 安装目录的所有者更改为新用户")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo chown -R es:es /usr/local/elasticsearch-8.11.3/\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[a._v("切换到新用户")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("su - es\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[a._v("启动 Elasticsearch")])]),a._v(" "),s("p",[a._v("在 Elasticsearch 目录下的 "),s("code",[a._v("bin")]),a._v(" 目录中，执行以下命令：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./elasticsearch\n")])])]),s("p",[a._v("现在 Elasticsearch 应该已经成功启动了。")]),a._v(" "),s("p",[s("strong",[a._v("还有坑")])]),a._v(" "),s("p",[a._v("1.需要给es用户加上sudo权限：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo usermod -aG sudo es\n")])])]),s("p",[a._v("2.sudo visudo")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("root ALL=(ALL:ALL) ALL\n")])])]),s("h2",{attrs:{id:"启动报错2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动报错2"}},[a._v("#")]),a._v(" 启动报错2")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2023/12/18/SAMTIBJebFsiprK.png",alt:""}})]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("确保elasticsearch目录下的data目录可写。你可以使用以下命令更改目录权限：")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo chmod 777 /usr/local/elasticsearch-8.11.3/data\n")])])]),s("p",[a._v("试过了，不行")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("检查是否有其他用户或进程占用了Elasticsearch的节点锁。你可以使用以下命令查看哪些进程正在使用node.lock文件：")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo lsof | grep node.lock\n")])])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2023/12/18/vFEVOILCjf3ueH9.png",alt:""}})]),a._v(" "),s("p",[a._v("把这些进程杀死了还是不行")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("修改配置文件")])])]),a._v(" "),s("p",[a._v("要查看Elasticsearch的访问端口，您可以检查Elasticsearch配置文件中的"),s("code",[a._v("elasticsearch.yml")]),a._v("文件。默认情况下，Elasticsearch使用9200端口作为HTTP RESTful API的默认端口，而9200端口用于节点之间的通信。")]),a._v(" "),s("p",[a._v("您可以使用以下命令查看"),s("code",[a._v("elasticsearch.yml")]),a._v("文件的内容：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /usr/local/elasticsearch-8.11.3/config/elasticsearch.yml\n")])])]),s("p",[a._v("查找以下行，其中包含有关HTTP或节点通信端口的信息：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("http.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9200")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("transport.tcp.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9300")]),a._v("\n")])])]),s("p",[a._v("上述示例中，"),s("code",[a._v("http.port")]),a._v("指定了HTTP端口（默认为9200），而"),s("code",[a._v("transport.tcp.port")]),a._v("指定了节点之间的通信端口（默认为9300）。")]),a._v(" "),s("p",[a._v("要测试Elasticsearch是否成功启动，可以使用curl命令或任何HTTP客户端来发送请求并检查响应。例如，使用curl测试：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://localhost:9200/"')]),a._v("\n")])])]),s("p",[s("strong",[a._v("测试还是报错")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('$ curl -X GET "http://localhost:9200/"\ncurl: (52) Empty reply from server\n')])])]),s("p",[a._v('出现 "Empty reply from server" 的错误可能有几个原因。以下是一些可能的解决方法：')]),a._v(" "),s("ol",[s("li",[s("p",[s("strong",[a._v("等待一段时间：")]),a._v(" 有时，Elasticsearch启动可能需要一些时间。等待一分钟然后重新尝试。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("检查Elasticsearch日志：")]),a._v(" 检查Elasticsearch的日志文件，通常位于 "),s("code",[a._v("/usr/local/elasticsearch-8.11.3/logs/")]),a._v(" 目录中。查看日志文件可以提供关于启动过程中出现的任何问题的更多信息。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /usr/local/elasticsearch-8.11.3/logs/elasticsearch.log\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("这个是日志信息：[2023-12-18T15:50:19,033][WARN ][o.e.h.n.Netty4HttpServerTransport] [lichengcan] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel{localAddress=/192.168.104.128:9200, remoteAddress=/192.168.104.1:8741}\n[2023-12-18T15:50:19,037][WARN ][o.e.h.n.Netty4HttpServerTransport] [lichengcan] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel{localAddress=/192.168.104.128:9200, remoteAddress=/192.168.104.1:8743}\n")])])]),s("p",[a._v("根据日志信息，您遇到的问题是Elasticsearch正在收到明文的HTTP流量，而通道却是通过HTTPS配置的。这可能是由于Elasticsearch配置中的HTTPS设置导致的。在默认情况下，Elasticsearch使用HTTPS进行安全通信，但如果您使用了HTTP而不是HTTPS，则可能会收到这些警告。")]),a._v(" "),s("p",[a._v("为了解决这个问题，您可以采取以下步骤：")]),a._v(" "),s("ol",[s("li",[s("p",[s("strong",[a._v("检查"),s("code",[a._v("elasticsearch.yml")]),a._v("配置文件：")]),a._v(" 打开Elasticsearch的配置文件（通常在"),s("code",[a._v("/usr/local/elasticsearch-8.11.3/config/elasticsearch.yml")]),a._v("），并确保以下HTTPS设置已正确配置：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("xpack.security.enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n")])])]),s("p",[a._v("或者，如果您使用较早版本的Elasticsearch，您可能需要找到和禁用以下配置：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("searchguard.ssl.http.enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n")])])]),s("p",[a._v("请注意，上述设置是禁用Elasticsearch的安全特性。在生产环境中，如果需要安全性，请谨慎进行配置。")])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("重新启动Elasticsearch：")]),a._v(" 在更改配置后，重新启动Elasticsearch以使更改生效：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" elasticsearch restart\n")])])])]),a._v(" "),s("li",[s("p",[s("strong",[a._v("再次尝试使用curl：")]),a._v(" 确保您的curl命令使用HTTP协议：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://localhost:9200/"')]),a._v("\n")])])]),s("p",[s("strong",[a._v("测试成功")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2023/12/18/pbrBDIHMfNgz7Sw.png",alt:""}})])])])])]),a._v(" "),s("h2",{attrs:{id:"重启es脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启es脚本"}},[a._v("#")]),a._v(" 重启es脚本")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('#!/bin/bash\n\n# 查找并杀死Elasticsearch进程\npids=$(ps -ef | grep elasticsearch | awk \'{print $2}\')\n\nfor pid in $pids; do\n  echo "Killing Elasticsearch process with PID $pid"\n  kill -9 $pid\ndone\n\n# 确保所有进程都已终止\nsleep 2\n\n# 启动Elasticsearch服务\necho "Starting Elasticsearch in the background..."\nnohup /usr/local/elasticsearch-8.11.3/bin/elasticsearch > /dev/null 2>&1 &\n')])])]),s("h2",{attrs:{id:"连接工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接工具"}},[a._v("#")]),a._v(" 连接工具")]),a._v(" "),s("p",[a._v("ElasticHD")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2023/12/18/BwnpKUcCxeNsLu9.png",alt:""}})])])}),[],!1,null,null,null);s.default=r.exports}}]);