(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{560:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[t._v("#")]),t._v(" Redis")]),t._v(" "),s("h2",{attrs:{id:"一、引言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、引言"}},[t._v("#")]),t._v(" 一、引言")]),t._v(" "),s("h3",{attrs:{id:"_1-1-数据库压力过大"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-数据库压力过大"}},[t._v("#")]),t._v(" 1.1 数据库压力过大")]),t._v(" "),s("blockquote",[s("p",[t._v("由于用户量增大，请求数量也随之增大，数据压力过大")])]),t._v(" "),s("h3",{attrs:{id:"_1-2-数据不同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-数据不同步"}},[t._v("#")]),t._v(" 1.2 数据不同步")]),t._v(" "),s("blockquote",[s("p",[t._v("多台服务器之间，数据不同步 ----- session 共享问题")])]),t._v(" "),s("h3",{attrs:{id:"_1-3-传统锁失效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-传统锁失效"}},[t._v("#")]),t._v(" 1.3 传统锁失效")]),t._v(" "),s("blockquote",[s("p",[t._v("多台服务器之间的锁，已经不存在互斥性了。 ------ 分布式锁的问题")])]),t._v(" "),s("h2",{attrs:{id:"二、redis介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、redis介绍"}},[t._v("#")]),t._v(" 二、Redis介绍")]),t._v(" "),s("h3",{attrs:{id:"_2-1-nosql介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-nosql介绍"}},[t._v("#")]),t._v(" 2.1 NoSQL介绍")]),t._v(" "),s("p",[t._v("提示")]),t._v(" "),s("ul",[s("li",[t._v("Redis就是一款NoSQL。 not only sql")]),t._v(" "),s("li",[t._v("NoSQL -> 非关系型数据库 -> Not Only SQL。")]),t._v(" "),s("li",[t._v("Key-Value：Redis。。。")]),t._v(" "),s("li",[t._v("文档型：ElasticSearch，Solr，Mongodb。。。")]),t._v(" "),s("li",[t._v("面向列：Hbase。。。")]),t._v(" "),s("li",[t._v("图形化：Neo4j。。。")]),t._v(" "),s("li",[t._v("除了关系型数据库都是非关系型数据库。")]),t._v(" "),s("li",[t._v("NoSQL只是一种概念，泛指非关系型数据库，和关系型数据库做一个区分。")])]),t._v(" "),s("h3",{attrs:{id:"_2-2-redis介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-redis介绍"}},[t._v("#")]),t._v(" 2.2 Redis介绍")]),t._v(" "),s("p",[t._v("提示")]),t._v(" "),s("p",[t._v("有一位意大利人，在开发一款LLOOGG的统计页面，因为MySQL的性能不好，自己研发了一款非关系型数据库，并命名为Redis。Salvatore。\nRedis（Remote Dictionary Server）即远程字典服务，Redis是由C语言去编写，Redis是一款基于Key-Value的NoSQL，而且Redis是基于内存存储数据的，Redis还提供了多种持久化机制，性能可以达到110000/s读取数据以及81000/s写入数据，Redis还提供了主从，哨兵以及集群的搭建方式，可以更方便的横向扩展以及垂直扩展。")]),t._v(" "),s("h2",{attrs:{id:"三、redis安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、redis安装"}},[t._v("#")]),t._v(" 三、Redis安装")]),t._v(" "),s("h3",{attrs:{id:"_3-1-安装redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装redis"}},[t._v("#")]),t._v(" 3.1 安装Redis")]),t._v(" "),s("blockquote",[s("p",[t._v("Docker-Compose安装")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n")])])]),s("p",[t._v("注意： 这个镜像仓库 的 安装 默认 开启了 两种持久化方式rdb/aof，不同的安装方式，持久化开启情况不一样")]),t._v(" "),s("h3",{attrs:{id:"_3-2-使用redis-cli连接redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-使用redis-cli连接redis"}},[t._v("#")]),t._v(" 3.2 使用redis-cli连接Redis")]),t._v(" "),s("blockquote",[s("p",[t._v("进去Redis容器的内部")]),t._v(" "),s("p",[t._v("docker exec -it 容器id bash")]),t._v(" "),s("p",[t._v("在容器内部，使用redis-cli连接")]),t._v(" "),s("p",[t._v("redis-cli 在这个/usr/local/bin路径下")])]),t._v(" "),s("p",[t._v("进入容器内部后，可以使用容器自带的redis-cli 连接到redis的服务端")]),t._v(" "),s("p",[t._v("redis-cli 是redis自带的一个客户端工具，可以帮助我们连接到redis服务端，操作redis")]),t._v(" "),s("h3",{attrs:{id:"_3-3-使用图形化界面连接redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-使用图形化界面连接redis"}},[t._v("#")]),t._v(" 3.3 使用图形化界面连接Redis")]),t._v(" "),s("blockquote",[s("p",[t._v("下载地址：https://github.com/lework/RedisDesktopManager-Windows/releases/download/2019.5/redis-desktop-manager-2019.5.zipopen in new window")]),t._v(" "),s("p",[t._v("傻瓜式安装RedisDesktopManager")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2023/12/18/YSuNgfIZEO1bHsJ.png",alt:""}})])]),t._v(" "),s("h2",{attrs:{id:"四、redis常用命令【重点】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、redis常用命令【重点】"}},[t._v("#")]),t._v(" 四、Redis常用命令【重点】")]),t._v(" "),s("h3",{attrs:{id:"_4-1-redis存储数据的结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-redis存储数据的结构"}},[t._v("#")]),t._v(" 4.1 Redis存储数据的结构")]),t._v(" "),s("blockquote",[s("p",[t._v("常用的5种数据结构：")]),t._v(" "),s("ul",[s("li",[t._v("key-string：一个key对应一个值。")]),t._v(" "),s("li",[t._v("key-hash：一个key对应一个Map。")]),t._v(" "),s("li",[t._v("key-list：一个key对应一个列表。 有序的 可以重复的")]),t._v(" "),s("li",[t._v("key-set：一个key对应一个集合。 无序的 不可以重复的")]),t._v(" "),s("li",[t._v("key-zset：一个key对应一个有序的集合。 有序的 不可以重复的")])]),t._v(" "),s("p",[t._v("另外三种数据结构：")]),t._v(" "),s("ul",[s("li",[t._v("HyperLogLog：计算近似值的。")]),t._v(" "),s("li",[t._v("GEO：地理位置。")]),t._v(" "),s("li",[t._v("BIT：一般存储的也是一个字符串，存储的是一个byte[]。")])]),t._v(" "),s("p",[t._v("五种常用的存储数据结构图")])]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("key-string：最常用的，一般用于存储一个值。")]),t._v(" "),s("li",[t._v("key-hash：存储一个对象数据的。")]),t._v(" "),s("li",[t._v("key-list：使用list结构实现栈和队列结构。")]),t._v(" "),s("li",[t._v("key-set：交集，差集和并集的操作。")]),t._v(" "),s("li",[t._v("key-zset：排行榜，积分存储等操作。")])])]),t._v(" "),s("h3",{attrs:{id:"_4-2-string常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-string常用命令"}},[t._v("#")]),t._v(" 4.2 string常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("string常用操作命令")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1.  添加值")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" key value\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" name zs \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 取值")]),t._v("\nget key\nget name\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 批量操作")]),t._v("\nmset key value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nmset k1 v1 k2 v2 k3 v3\nmget key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nmget k1 k2 k3\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 自增命令（自增1）")]),t._v("\nincr key \n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\nincr age \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 自减命令（自减1）")]),t._v("\ndecr key\ndecr age\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6. 自增或自减指定数量")]),t._v("\nincrby key increment\nincrby age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\ndecrby key increment\nDECRBY age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#7. 设置值的同时，指定生存时间（每次向Redis中添加数据时，尽量都设置上生存时间）")]),t._v("\nsetex key second value\nsetex address "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" zz      设置  address  zz 键值 存活30秒\n\nttl key    查看key 的 剩余存活时间\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#8. 设置值，如果当前key不存在的话（如果这个key存在，什么事都不做，如果这个key不存在，和set命令一样）")]),t._v("\nsetnx key value\nsetnx lock "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("       \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果redis 内没有  lock 这个键  就执行成功   有的话就执行失败 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#9. 在key对应的value后，追加内容")]),t._v("\nappend key value\nappend name zs      name 这个键对应的值后追加  zs\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#10. 查看value字符串的长度")]),t._v("\nstrlen key\n")])])]),s("blockquote",[s("p",[t._v("设置key时同时指定过期时间")]),t._v(" "),s("p",[t._v("语法： set key value ex 秒")]),t._v(" "),s("p",[t._v("例子： set foo bar ex 20")])]),t._v(" "),s("h3",{attrs:{id:"_4-3-hash常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-hash常用命令"}},[t._v("#")]),t._v(" 4.3 hash常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("hash常用命令")]),t._v(" "),s("p",[t._v("保存的value是一个对象 【属性和属性值】")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1. 存储数据")]),t._v("\nhset key field value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 获取数据")]),t._v("\nhget key field\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 批量操作")]),t._v("\nhmset key field value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("field value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nhmget key field "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("field "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 自增（指定自增的值）")]),t._v("\nhincrby key field increment\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 设置值（如果key-field不存在，那么就正常添加，如果存在，什么事都不做）")]),t._v("\nhsetnx key field value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6. 检查field是否存在")]),t._v("\nhexists key field \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#7. 删除key对应的field，可以删除多个")]),t._v("\nhdel key field "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("field "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#8. 获取当前hash结构中的全部field和value")]),t._v("\nhgetall key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#9. 获取当前hash结构中的全部field")]),t._v("\nhkeys key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#10. 获取当前hash结构中的全部value")]),t._v("\nhvals key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#11. 获取当前hash结构中field的数量")]),t._v("\nhlen key\n")])])]),s("p",[t._v("hash应用场景")]),t._v(" "),s("p",[t._v("对象缓存")]),t._v(" "),s("blockquote",[s("p",[t._v("模拟购物车")]),t._v(" "),s("p",[t._v("用户id 为 key 商品id 为 field 商品数量 为 value")]),t._v(" "),s("p",[t._v("添加商品 hset cart:1001 10086 1 【hset cart:用户ID 商品ID 数量】")]),t._v(" "),s("p",[t._v("增加数量 HINCRBY cart:1001 10086 1 【HINCRBY cart:用户ID 商品ID 数量】")]),t._v(" "),s("p",[t._v("商品总数 HLEN cart:1001 【HLEN cart:用户ID】")]),t._v(" "),s("p",[t._v("删除商品 hdel cart:1001 10086 【 hdel cart:用户ID 商品ID】")]),t._v(" "),s("p",[t._v("获取购物车所有商品： HGETALL cart:1001 【HGETALL cart:用户ID 】")])]),t._v(" "),s("h3",{attrs:{id:"_4-4-list常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-list常用命令"}},[t._v("#")]),t._v(" 4.4 list常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("list常用命令 有序的列表")]),t._v(" "),s("p",[t._v("push 推，存数据")]),t._v(" "),s("p",[t._v("pop 弹，取数据")]),t._v(" "),s("p",[t._v("l left：左边")]),t._v(" "),s("p",[t._v("r right: 右边")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1. 存储数据（从左侧插入数据，从右侧插入数据）")]),t._v("\nlpush key value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nrpush key value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 存储数据(如果key不存在，就什么都不做，如果key存在，就正常添加)")]),t._v("\nlpushx key value\nrpushx key value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 修改数据（在存储数据时，指定好你的索引位置,覆盖之前索引位置的数据，index超出整个列表的长度，也会失败）")]),t._v("\nlset key index value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 弹栈方式获取数据（左侧弹出数据，从右侧弹出数据）")]),t._v("\nlpop key\nrpop key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 获取指定索引范围的数据（start从0开始，stop输入-1，代表最后一个，-2代表倒数第二个）")]),t._v("\nlrange key start stop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6. 获取指定索引位置的数据")]),t._v("\nlindex key index\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#7. 获取整个列表的长度")]),t._v("\nllen key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#8. 删除列表中的数据（他是删除当前列表中的count个value值，count > 0从左侧向右侧删除，count < 0从右侧向左侧删除，count == 0删除列表中全部的value）")]),t._v("\nlrem key count value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#9. 保留列表中的数据（保留你指定索引范围内的数据，超过整个索引范围被移除掉）")]),t._v("\nltrim key start stop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#10. 将一个列表中最后的一个数据，插入到另外一个列表的头部位置")]),t._v("\nrpoplpush list1 list2\n")])])]),s("blockquote",[s("p",[t._v("list 模拟栈 statck = lpush + lpop")]),t._v(" "),s("p",[t._v("模拟队列 queue = lpush + rpop")]),t._v(" "),s("p",[t._v("小明关注了 多个a,b,c三个公众号 三个公众号依次发消息 小明的id 为1")]),t._v(" "),s("p",[t._v("lpush msg:1 1001 a公众号发id 为1001 的 消息")]),t._v(" "),s("p",[t._v("lpush msg:1 1002 b公众号发id 为1002 的 消息")]),t._v(" "),s("p",[t._v("lpush msg:1 1003 c公众号发id 为1003 的 消息")])]),t._v(" "),s("h3",{attrs:{id:"_4-5-set常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-set常用命令"}},[t._v("#")]),t._v(" 4.5 set常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("set常用命令")]),t._v(" "),s("p",[t._v("无序不可重复")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1. 存储数据")]),t._v("\nsadd key member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 获取数据（获取全部数据）")]),t._v("\nsmembers key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 随机获取一个数据（获取的同时，移除数据，count默认为1，代表弹出数据的数量）")]),t._v("\nspop key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 交集（取多个set集合交集）")]),t._v("\nsinter set1 set2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 并集（获取全部集合中的数据）")]),t._v("\nsunion set1 set2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6. 差集（获取多个集合中不一样的数据）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sdiff")]),t._v(" set1 set2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7. 删除数据")]),t._v("\nsrem key member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 8. 查看当前的set集合中是否包含这个值")]),t._v("\nsismember key member\n")])])]),s("blockquote",[s("p",[t._v("应用场景 朋友圈点赞")]),t._v(" "),s("p",[t._v("sadd like:messageid:1 1 messageid:1 消息 被 id为1 的用户点赞")]),t._v(" "),s("p",[t._v("SCARD like:messageid:1 获取点赞数")]),t._v(" "),s("p",[t._v("SISMEMBER like:messageid:1 2 判断 id 为2 的 有没有给这个朋友圈信息点赞")])]),t._v(" "),s("blockquote",[s("p",[t._v("抖音的关注模型")]),t._v(" "),s("p",[t._v("zs关注的人 sadd zslike ls ww zl")]),t._v(" "),s("p",[t._v("ls 关注的人 sadd lslike ww zl tq")]),t._v(" "),s("p",[t._v("ww关注的人 sadd wwlike zs ls zl tq")]),t._v(" "),s("p",[t._v("ww的粉丝 sadd wwfans zs ls")]),t._v(" "),s("p",[t._v("zs和ls 共同关注的人 SINTER zslike lslike")]),t._v(" "),s("p",[t._v("zs可能认识的人")]),t._v(" "),s("p",[t._v("SDIFF lslike zslike")])]),t._v(" "),s("h3",{attrs:{id:"_4-6-zset的常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-zset的常用命令"}},[t._v("#")]),t._v(" 4.6 zset的常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("zset常用命令")]),t._v(" "),s("p",[t._v("有序且不重复。每个元素都会关联一个double类型的分数，Redis通过分数进行从小到大的排序。")]),t._v(" "),s("p",[t._v("分数可以重复")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1. 添加数据(score必须是数值。member不允许重复的。)")]),t._v("\nzadd key score member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("score member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 修改member的分数（如果member是存在于key中的，正常增加分数，如果memeber不存在，这个命令就相当于zadd）")]),t._v("\nzincrby key increment member\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 查看指定的member的分数")]),t._v("\nzscore key member\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 获取zset中数据的数量")]),t._v("\nzcard key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 根据score的范围查询member数量")]),t._v("\nzcount key min max\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6. 删除zset中的成员")]),t._v("\nzrem key member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("member"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#7. 根据分数从小到大排序，获取指定范围内的数据（withscores如果添加这个参数，那么会返回member对应的分数）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 全部元素根据分数从小到大排序")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# start 起始下标")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# stop 终止下标")]),t._v("\nzrange key start stop "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withscores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#8. 根据分数从大到小排序，获取指定范围内的数据（withscores如果添加这个参数，那么会返回member对应的分数）")]),t._v("\nzrevrange key start stop "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withscores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#9. 根据分数的返回去获取member(withscores代表同时返回score，添加limit，就和MySQL中一样，如果不希望等于min或者max的值被查询出来可以采用 ‘(分数’ 相当于 < 但是不等于的方式，最大值和最小值使用+inf和-inf来标识)")]),t._v("\nzrangebyscore key min max "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withscores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("limit offset count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   ZRANGEBYSCORE zset1 10 18 withscores limit 0 2    ")]),t._v("\n取score  为  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" 到  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" 之间的 value（包含边界值10  和  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("）  从 索引为 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" 处开始取    取两个 \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   ZRANGEBYSCORE zset1 (10 (18 withscores limit 0 2 ")]),t._v("\n取score  为  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" 到  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" 之间的 value（不包含边界值10  和  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("）  从 索引为 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" 处开始取    取两个\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  ZRANGEBYscore zset1 -inf +inf withscores limit 1  3")]),t._v("\n取 最小 score 到 最大score 的值   从 索引1  开始 取 ，取 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" 个  \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#10. 根据分数的返回去获取member(withscores代表同时返回score，添加limit，就和MySQL中一样)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  返回有序集中指定分数区间内的所有的成员。有序集成员按分数值递减(从大到小)的次序排列。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  成员按分数值递减的次序排列")]),t._v("\nzrevrangebyscore key max min "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("withscores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("limit offset count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("rev: reverse 反转")]),t._v(" "),s("p",[t._v("range: 范围")]),t._v(" "),s("p",[t._v("score: 分数")]),t._v(" "),s("p",[t._v("inf: 无穷，无限")])]),t._v(" "),s("p",[t._v("分数的取值范围【可以是整数小数】")]),t._v(" "),s("p",[t._v("如果分数相同，就按元素的字典序排列【数值从小到大，字母从a到z】")]),t._v(" "),s("h3",{attrs:{id:"_4-7-key常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-key常用命令"}},[t._v("#")]),t._v(" 4.7 key常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("key常用命令")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1. 查看Redis中的全部的key（pattern：* ，xxx*，*xxx）")]),t._v("\nkeys pattern\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 查看某一个key是否存在（1 - key存在，0 - key不存在）")]),t._v("\nexists key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 删除key")]),t._v("\ndel key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 设置key的生存时间，单位为秒，设置还能活多久")]),t._v("\nexpire key second\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单位为毫秒,")]),t._v("\npexpire key milliseconds\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 设置key的生存时间，单位为秒,设置能活到什么时间点    接收到的是unix 时间戳")]),t._v("\nexpireat key timestamp \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单位为毫秒")]),t._v("\npexpireat key milliseconds\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6. 查看key的剩余生存时间,单位为秒")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#（-2 表示当前key不存在，-1 -表示当前key没有设置生存时间，其他数值表示具体剩余的生存时间）")]),t._v("\nttl key\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单位为毫秒")]),t._v("\npttl key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#7. 移除key的生存时间（1 - 移除成功，0 - key不存在生存时间或者key不存在）")]),t._v("\npersist key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#8. 选择操作的库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("~15\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#9. 移动key到另外一个库中")]),t._v("\nmove key db\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#10. 重命名key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rename")]),t._v(" key newkey：修改key的名称\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#11. 查看key存储值的数据类型")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" key：返回key所储存的值的类型\n")])])]),s("p",[t._v("expirekey的使用场景：")]),t._v(" "),s("blockquote",[s("p",[t._v("1、限时的优惠活动\n2、网站数据缓存\n3、手机验证码\n4、限制网站访客频率")])]),t._v(" "),s("p",[t._v("key的命名建议：")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("key不要太长，尽量不要超过1024字节。不仅消耗内存，也会降低查找的效率")]),t._v(" "),s("li",[t._v("key不要太短，太短可读性会降低")]),t._v(" "),s("li",[t._v("在一个项目中，key最好使用统一的命名模式，如 user:123:password")]),t._v(" "),s("li",[t._v("key区分大小写")])])]),t._v(" "),s("h3",{attrs:{id:"_4-8-库的常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-库的常用命令"}},[t._v("#")]),t._v(" 4.8 库的常用命令")]),t._v(" "),s("blockquote",[s("p",[t._v("db常用命令")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#1. 清空当前所在的数据库")]),t._v("\nflushdb\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2. 清空全部数据库")]),t._v("\nflushall\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#3. 查看当前数据库中有多少个key")]),t._v("\ndbsize\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#4. 查看最后一次操作的时间   Lastsave 命令返回最近一次 Redis 成功将数据保存到磁盘上的时间，以 UNIX 时间戳格式表示。")]),t._v("\nlastsave        返回   integer 值 \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#5. 实时监控Redis服务接收到的命令   在一个连接上  使用 monitor 可以监控 别的连接对redis 的操作  ")]),t._v("\nmonitor\n")])])]),s("h2",{attrs:{id:"五、java连接redis【重点】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、java连接redis【重点】"}},[t._v("#")]),t._v(" 五、Java连接Redis【重点】")]),t._v(" "),s("h3",{attrs:{id:"_5-1-springboot连接redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-springboot连接redis"}},[t._v("#")]),t._v(" 5.1 SpringBoot连接Redis")]),t._v(" "),s("h4",{attrs:{id:"_5-1-1-创建maven工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-创建maven工程"}},[t._v("#")]),t._v(" 5.1.1 创建Maven工程")]),t._v(" "),s("blockquote",[s("p",[t._v("idea创建，创建时选择就选择单元测试/Lombok/NoSQL中的redis模块")])]),t._v(" "),s("h4",{attrs:{id:"_5-1-2-导入需要的依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-导入需要的依赖"}},[t._v("#")]),t._v(" 5.1.2 导入需要的依赖")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-web"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-data-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-devtools"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("runtime"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    \n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.projectlombok"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("lombok"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    \n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("配置文件")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redis连接信息配置")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.29.110\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# springboot2.0以上的版本默认使用的是lettuce redis客户端")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lettuce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-wait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-idle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-idle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("h4",{attrs:{id:"_5-1-3-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-测试"}},[t._v("#")]),t._v(" 5.1.3 测试")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootTest")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisDemoApplicationTests")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注入StringRedisTemplate 字串类型的redis操作模板类")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只能操作key/value都是字串类型的数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")]),t._v(" stringRedisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("contextLoads")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueOperations")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" ops "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stringRedisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置数据")]),t._v("\n        ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"仁康"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取值")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置值同时指定过期时间")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// ops.set("name2","李四",30,TimeUnit.SECONDS);')]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果key不存在时设置值并返回true，如果存在时什么都不在返回false")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// ops.setIfAbsent("name1","王五");')]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果key存在时设置值并返回true，如果不存在时什么都不在返回false")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// ops.setIfPresent("name1","王五");')]),t._v("\n\n        ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"大好人"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取字串的字符数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-2-存储一个对象到redis以json的形式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-存储一个对象到redis以json的形式"}},[t._v("#")]),t._v(" 5.2 存储一个对象到Redis以json的形式")]),t._v(" "),s("h4",{attrs:{id:"_5-2-1-准备一个user实体类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-准备一个user实体类"}},[t._v("#")]),t._v(" 5.2.1 准备一个User实体类")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serializable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" serialVersionUID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5700617907293625554L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" birthday"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("配置序列化类，自动添加serialVersionUID")]),t._v(" "),s("blockquote",[s("p",[t._v("实体类需要实现Serializable接口，")]),t._v(" "),s("p",[t._v("配置过以后，在类上使用 alt+Enter可以自动提示，生成serialVersionUID")])]),t._v(" "),s("h4",{attrs:{id:"_5-2-2-redis配置类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-redis配置类"}},[t._v("#")]),t._v(" 5.2.2 Redis配置类")]),t._v(" "),s("p",[t._v("一般需要配置 redis key/value的序列化方式")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisTemplate")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("redisTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisConnectionFactory")]),t._v(" factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisTemplate")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" template "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisTemplate")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置开启事务支持")]),t._v("\n        template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEnableTransactionSupport")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//关联")]),t._v("\n        template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setConnectionFactory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置key的序列化器")]),t._v("\n        template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setKeySerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置value的序列器")]),t._v("\n        template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setValueSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("RedisSerializer指定序列化的方式，常用的 string() 和 json()")]),t._v(" "),s("p",[t._v("本质上Spring自动注入的StringRedisTemplate就是指定了string()的序列化方式")])]),t._v(" "),s("h4",{attrs:{id:"_5-2-3-创建demo测试类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-3-创建demo测试类"}},[t._v("#")]),t._v(" 5.2.3 创建Demo测试类")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testJson")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueOperations")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" ops "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"董晨旭"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setBirthday")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-3-注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-注意事项"}},[t._v("#")]),t._v(" 5.3 注意事项")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 需要引入jackson本质原因是因为redis使用了json序列化 --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.fasterxml.jackson.core"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("jackson-databind"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 或者直接导入web模块，WEB模块中有依赖jackson-databind --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-web"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-4-常用命令操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-常用命令操作"}},[t._v("#")]),t._v(" 5.4 常用命令操作")]),t._v(" "),s("blockquote",[s("p",[t._v("Java验证key的常用命令")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueOperations")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" ops "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stringRedisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisOperations")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" operations "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOperations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("operations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExpire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaa"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("operations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExpire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取key的值数据类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataType")]),t._v(" dataType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" operations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dataType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"六、redis其他配置及集群【重点】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、redis其他配置及集群【重点】"}},[t._v("#")]),t._v(" 六、Redis其他配置及集群【重点】")]),t._v(" "),s("blockquote",[s("p",[t._v("redis默认配置文件中的内容")])]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 他的意思是只允许指定的地址来连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("bind")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("127.0.0.1  ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 900秒 如果15分钟内有超过1个key发生变化，就会把redis内存中的数据持久化到磁盘")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("save")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("900 1 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 300秒 如果5分钟内有超过10个key发生变化，就会把redis内存中的数据持久化到磁盘")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("save")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("300 10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 60秒 如果1分钟内有超过10000个key发生变化，就会把redis内存中的数据持久化到磁盘")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("save")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("60 10000")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The filename where to dump the DB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认持久化文件的名字是 dump.rdb")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("dbfilename")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("dump.rdb")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# requirepass 这个配置项是指定连接redis的密码的，默认没有开启")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果我们需要指定密码，就把这一项开启，设置一个密码就行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# requirepass foobared")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("修改yml文件，以方便后期修改Redis配置信息")]),t._v(" "),s("p",[t._v("./conf redis的配置文件目录")]),t._v(" "),s("p",[t._v("./data redis的数据文件")]),t._v(" "),s("p",[t._v("command 启动redis并指定配置文件")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"_6-1-redis的auth"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-redis的auth"}},[t._v("#")]),t._v(" 6.1 Redis的AUTH")]),t._v(" "),s("blockquote",[s("p",[t._v("通过修改Redis的配置文件，实现Redis的密码校验，")]),t._v(" "),s("p",[t._v("需要在docker-compose.yml文件所在目录中创建 conf 和 data目录")]),t._v(" "),s("p",[t._v("image-20220824095424074")]),t._v(" "),s("p",[t._v("进入conf目录，创建redis.conf文件")]),t._v(" "),s("p",[t._v("vi redis.conf")]),t._v(" "),s("p",[t._v("配置文件内容如下")])]),t._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("requirepass 密码\n")])])]),s("p",[t._v("修改配置文件后重启redis")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先停止redis:  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" down\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新启动: ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("三种客户端的连接方式")]),t._v(" "),s("ul",[s("li",[t._v("redis-cli：在输入正常命令之前，先输入auth 密码即可。")])]),t._v(" "),s("p",[t._v("看到上面的提示，就表示要求输入密码，输入 auth 你的密码")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("图形化界面：在连接Redis的信息中添加上验证的密码。")])]),t._v(" "),s("li",[s("p",[t._v("Java客户端：修改application.yml 文件指定redis的password")])])])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.174.128\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n")])])]),s("h3",{attrs:{id:"_6-2-redis的事务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-redis的事务"}},[t._v("#")]),t._v(" 6.2 Redis的事务")]),t._v(" "),s("blockquote",[s("p",[t._v("Redis的事务：一次事务操作，该成功的成功，该失败的失败。")]),t._v(" "),s("p",[t._v("先开启事务，执行一些系列命令，但是命令不会立即执行，会被放在一个队列中，如果你执行事务，那么这个队列中的命令全部执行，如果取消了事务，一个队列中的命令全部作废。")]),t._v(" "),s("ul",[s("li",[t._v("开启事务：multi")]),t._v(" "),s("li",[t._v("输入要执行的命令：被放入到一个队列中")]),t._v(" "),s("li",[t._v("执行事务：exec")]),t._v(" "),s("li",[t._v("取消事务：discard")])]),t._v(" "),s("p",[t._v("Redis的事务要想发挥功能，需要配置watch监听机制")]),t._v(" "),s("p",[t._v("在开启事务之前，先通过watch命令去监听一个或多个key，在开启事务之后，如果有其他客户端修改了我监听的key，事务会自动取消。")]),t._v(" "),s("p",[t._v("如果执行了事务，或者取消了事务，watch监听自动消除，一般不需要手动执行unwatch。")])]),t._v(" "),s("h3",{attrs:{id:"_6-3-redis持久化机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-redis持久化机制"}},[t._v("#")]),t._v(" 6.3 Redis持久化机制")]),t._v(" "),s("h4",{attrs:{id:"_6-3-1-rdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-1-rdb"}},[t._v("#")]),t._v(" 6.3.1 RDB")]),t._v(" "),s("blockquote",[s("p",[t._v("RDB是Redis默认的持久化机制")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("RDB持久化文件，速度比较快，而且存储的是一个二进制的文件，传输起来很方便。")])]),t._v(" "),s("li",[s("p",[t._v("RDB持久化的时机：")]),t._v(" "),s("p",[t._v("save 900 1：在900秒内，有1个key改变了，就执行RDB持久化。")]),t._v(" "),s("p",[t._v("save 300 10：在300秒内，有10个key改变了，就执行RDB持久化。")]),t._v(" "),s("p",[t._v("save 60 10000：在60秒内，有10000个key改变了，就执行RDB持久化。")])]),t._v(" "),s("li",[s("p",[t._v("RDB无法保证数据的绝对安全。")])])])]),t._v(" "),s("p",[t._v("关闭REDIS服务时可以指定，是否持久化[默认不持久化]")]),t._v(" "),s("p",[t._v("重启redis可以验证，redis从磁盘恢复数据到内存中了。")]),t._v(" "),s("h4",{attrs:{id:"_6-3-2-aof"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-2-aof"}},[t._v("#")]),t._v(" 6.3.2 AOF")]),t._v(" "),s("blockquote",[s("p",[t._v("AOF持久化机制默认是关闭的，Redis官方推荐同时开启RDB和AOF持久化，更安全，避免数据丢失。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("AOF持久化的速度，相对RDB较慢的，存储的是一个文本文件，到了后期文件会比较大，传输困难。")])]),t._v(" "),s("li",[s("p",[t._v("AOF持久化时机。")]),t._v(" "),s("p",[t._v("appendfsync always：每执行一个写操作，立即持久化到AOF文件中，性能比较低。\nappendfsync everysec：每秒执行一次持久化。\nappendfsync no：会根据你的操作系统不同，环境的不同，在一定时间内执行一次持久化。")])]),t._v(" "),s("li",[s("p",[t._v("AOF相对RDB更安全，推荐同时开启AOF和RDB。")])])])]),t._v(" "),s("p",[t._v("AOF相关的配置")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("appendonly no\nappendfilename "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"appendonly.aof"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# If unsure, use "everysec".')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果你不确定 aof持久化使用哪些配置，建议使用 everysec")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# appendfsync always")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# everysec 每秒中持久化一次")]),t._v("\nappendfsync everysec\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# appendfsync no")]),t._v("\n")])])]),s("p",[t._v("修改为如下的配置内容")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启AOF持久化")]),t._v("\nappendonly "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\nappendfilename "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis.aof"')]),t._v("\n")])])]),s("h4",{attrs:{id:"_6-3-3-注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-3-注意事项"}},[t._v("#")]),t._v(" 6.3.3 注意事项")]),t._v(" "),s("blockquote",[s("p",[t._v("同时开启RDB和AOF的注意事项：")]),t._v(" "),s("p",[t._v("如果同时开启了AOF和RDB持久化，那么在Redis宕机重启之后，需要加载一个持久化文件，优先选择AOF文件。")]),t._v(" "),s("p",[t._v("如果先开启了RDB，再次开启AOF，如果RDB执行了持久化，那么RDB文件中的内容会被AOF覆盖掉。")]),t._v(" "),s("p",[t._v("或者是：建议redis配置完成后，同时开启RDB和AOF备份！")])]),t._v(" "),s("h3",{attrs:{id:"_6-4-redis的主从架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-redis的主从架构"}},[t._v("#")]),t._v(" 6.4 Redis的主从架构")]),t._v(" "),s("blockquote",[s("p",[t._v("单机版 Redis存在读写瓶颈的问题 110000/s 的 读 81000/s 的写")])]),t._v(" "),s("blockquote",[s("p",[t._v("指定docker-compose.yml文件")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis1.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7002"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis2.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("links")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("master\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7003"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis3.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("links")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("master\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#redis1.conf配置文件中什么都不用写")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redis2.conf和redis3.conf从节点配置内容如下")]),t._v("\nreplicaof master "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n")])])]),s("p",[t._v("验证：到redis1中写数据，redis2/redis3中会同步数据。")]),t._v(" "),s("blockquote",[s("p",[t._v("演示： 在redis1中写数据，redis2和redis3中会自动同步")])]),t._v(" "),s("p",[t._v("主从结构： 读写分离性能扩展 容灾恢复，但是还是存在单点故障问题，就是主节点挂掉 ，redis 服务不可用了，剩下的从节点无法进行写操作，咱们希望的是 主节点挂掉，从节点能够上位。")]),t._v(" "),s("p",[t._v("解决这个问题需要使用哨兵模式。")]),t._v(" "),s("h3",{attrs:{id:"_6-5-哨兵"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-哨兵"}},[t._v("#")]),t._v(" 6.5 哨兵")]),t._v(" "),s("blockquote",[s("p",[t._v("哨兵可以帮助我们解决主从架构中的单点故障问题")])]),t._v(" "),s("blockquote",[s("p",[t._v("1、准备哨兵的配置文件，在conf目录中编写")]),t._v(" "),s("p",[t._v("主节点配置：sentinel1.conf")]),t._v(" "),s("p",[t._v("从节点配置：sentinel2.conf sentinel3.conf")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 禁止保护模式")]),t._v("\nprotected-mode no\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 哨兵需要后台启动")]),t._v("\ndaemonize "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定Master节点的ip和端口（主节点配置）")]),t._v("\nsentinel monitor master localhost "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定Master节点的ip和端口（从节点配置）")]),t._v("\nsentinel monitor master master "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 哨兵每隔多久监听一次redis架构")]),t._v("\nsentinel down-after-milliseconds master "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#所有相关的端口号需要在防火墙开启比如 7001 7002 7003 26379（是哨兵通信端口也得开 在哨兵配置文件可以看到） ")]),t._v("\n")])])]),s("p",[t._v("完整的配置文件内容如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("配置文件")]),t._v(" "),s("th",[t._v("内容")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("redis1.conf")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("redis2.conf")]),t._v(" "),s("td",[t._v("replicaof master 6379")])]),t._v(" "),s("tr",[s("td",[t._v("redis3.conf")]),t._v(" "),s("td",[t._v("replicaof master 6379")])]),t._v(" "),s("tr",[s("td",[t._v("sentinel1.conf")]),t._v(" "),s("td",[t._v("protected-mode no daemonize yes sentinel monitor master localhost 6379 2 sentinel down-after-milliseconds master 10000")])]),t._v(" "),s("tr",[s("td",[t._v("sentinel2.conf")]),t._v(" "),s("td",[t._v("protected-mode no daemonize yes sentinel monitor master master 6379 2 sentinel down-after-milliseconds master 10000")])]),t._v(" "),s("tr",[s("td",[t._v("sentinel3.conf")]),t._v(" "),s("td",[t._v("protected-mode no daemonize yes sentinel monitor master master 6379 2 sentinel down-after-milliseconds master 10000")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("修改了以下docker-compose.yml，为了可以在容器内部使用哨兵的配置")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis1.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/sentinel1.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data/sentinel.conf        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加的内容")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7002"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis2.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/sentinel2.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data/sentinel.conf        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加的内容")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("links")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("master\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7003"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis3.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/sentinel3.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data/sentinel.conf        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加的内容 ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("links")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("master\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("启动docker-compose， docker-compose up -d")]),t._v(" "),s("p",[t._v("然后在Redis容器内部手动启动哨兵即可 redis-sentinel sentinel.conf 三台机器的哨兵都需要启动")]),t._v(" "),s("p",[t._v("image-20220529200653149")])]),t._v(" "),s("p",[t._v("哨兵模式 主节点 挂掉之后 在从机中选出新的主节点，哪个从机会被选为新的主节点？")]),t._v(" "),s("p",[t._v("根据 配置文件的replica-priority 100 这个配置 这个值越小 优先级越高")]),t._v(" "),s("blockquote",[s("p",[t._v("验证哨兵：redis主节点停止后，redis会重新选择一个节点作为主节点")])]),t._v(" "),s("h3",{attrs:{id:"_6-6-redis的集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-redis的集群"}},[t._v("#")]),t._v(" 6.6 Redis的集群")]),t._v(" "),s("blockquote",[s("p",[t._v("前面的主从复制 解决了 redis 的 读写压力问题 ，分出了两个从节点 分担了 读取数据的压力")]),t._v(" "),s("p",[t._v("哨兵 解决了单点故障的问题 当有一个 master 节点 挂掉了 自动投票选举 出来一个 master 保证 主从架构正常执行 但是 这种架构还有一种问题 就是 存储的数据有限 ，也就是当数据量很大的时候 一个redis 存不下，上面的 一个 redis 主节点 无法存储这么多的数据 此时 就需要集群了")]),t._v(" "),s("p",[t._v("Redis集群在保证主从加哨兵的基本功能之外，还能够提升Redis存储数据的能力。")])]),t._v(" "),s("blockquote",[s("p",[t._v("注意 这里的从节点 跟上面的一主二从的 从节点不一样 ，这里的从节点 只负责备份主节点的数据 不负责分担主节点的读压力，而是一直看主节点干活 如果发现主节点挂掉了 马上顶替主节点干活")]),t._v(" "),s("p",[t._v("那么 如果某个节点上的一些数据 查询频率太高 也可以针对某一个节点 搭建 读写分离的那种 主从")]),t._v(" "),s("p",[t._v("主从 哨兵 和 集群 是三个概念")]),t._v(" "),s("p",[t._v("集群中的节点 超过半数挂掉 那么 整个集群服务就不可用了")]),t._v(" "),s("p",[t._v("如果某一个主节点挂掉 那么从节点顶上来做主节点 这个过程 是由其他节点选举")]),t._v(" "),s("p",[t._v("如果某一个主从节点都挂掉了 redis集群是否还能提供服务要看下面的配置")]),t._v(" "),s("p",[t._v("cluster-require-full-coverage yes 那么 整个集群都挂掉")]),t._v(" "),s("p",[t._v("cluster-require-full-coverage no 该节点不可用 该节点上的插槽都不能使用 其他节点正常使用")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("正常的心跳数据包携带节点的完整配置，它能以幂等方式来更新配置。如果采用 16384 个插槽，占空间 2KB （16384/8）；如果采用 65536 个插槽，占空间 8KB (65536/8)。\nRedis Cluster 不太可能扩展到超过 1000 个主节点，太多可能导致网络拥堵。\n16384 个插槽范围比较合适，当集群扩展到1000个节点时，也能确保每个master节点有足够的插槽，\n8KB 的心跳包看似不大，但是这个是心跳包每秒都要将本节点的信息同步给集群其他节点。比起 16384 个插槽，头大小增加了4倍，ping消息的消息头太大了，浪费带宽。\n")])])]),s("blockquote",[s("p",[t._v("创建docker_redis_cluster目录，准备yml文件")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 17001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17001")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis1.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7002"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7002")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 17002"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17002")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis2.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7003"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7003")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 17003"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17003")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis3.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis4\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7004"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7004")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 17004"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17004")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis4.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis5\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7005"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7005")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 17005"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17005")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis5.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" daocloud.io/library/redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("5.0.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis6\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7006"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7006")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 17006"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17006")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./conf/redis6.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/redis/redis.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/redis/redis.conf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n")])])]),s("blockquote",[s("p",[t._v("配置文件，创建redis1.conf redis2.conf ... redis6.conf")]),t._v(" "),s("p",[t._v("配置文件内容类似，需要修改为不同的端口")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redis1.conf")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定redis的端口号")]),t._v("\nport "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启Redis集群")]),t._v("\ncluster-enabled "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群信息的文件")]),t._v("\ncluster-config-file nodes-7001.conf\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群的对外ip地址【这个IP地址需要改成自己的】")]),t._v("\ncluster-announce-ip "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群的对外port")]),t._v("\ncluster-announce-port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群的总线端口")]),t._v("\ncluster-announce-bus-port "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17001")]),t._v("\n")])])]),s("p",[t._v("替换操作可以使用vi编辑器的替换命令")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(":.,%s/7001/7002/g\n")])])]),s("p",[t._v("进入尾行模式 ., 表示同从第一行到最后一行 %s 字符替换")]),t._v(" "),s("p",[t._v("/7701 要替换的字串 /7002 替换为 /g 全局替换")]),t._v(" "),s("blockquote",[s("p",[t._v("通过docker-compose启动了6个Redis的节点。 切记开启所有相关的端口号 重启防火墙 重启docker服务")]),t._v(" "),s("p",[t._v("随便跳转到一个容器内部，使用redis-cli管理集群")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 【这个IP地址需要改成自己的】")]),t._v("\nredis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cluster")]),t._v(" create "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110:7001 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110:7002  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110:7003  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110:7004  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110:7005  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110:7006 --cluster-replicas "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("验证：操作集群")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("redis-cli 操作集群\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -c 实现自动重定向")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -h 指定IP地址 【这个IP地址需要改成自己的】")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -p 指定端口号")]),t._v("\nredis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".29.110 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v(" \n")])])]),s("h3",{attrs:{id:"_6-7-java连接redis集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-java连接redis集群"}},[t._v("#")]),t._v(" 6.7 Java连接Redis集群")]),t._v(" "),s("blockquote",[s("p",[t._v("SpringBoot连接Redis集群，只需要修改配置文件，增加集群配置即可")])]),t._v(" "),s("p",[t._v("SpringBoot配置文件")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群IP和PORT")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.29.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.29.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7002")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.29.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7003")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.29.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7004")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.29.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7005")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 192.168.29.110"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7006")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨集群执行命令时要遵循的最大重定向数")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-redirects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lettuce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-wait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-idle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-idle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])])]),s("p",[t._v("正常测试")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testCluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueOperations")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" ops "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stringRedisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"哈哈"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Redis管道方式测试【了解】")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testPipeline")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 管道命令")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SessionCallback")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" sessionCallback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SessionCallback")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisOperations")]),t._v(" operations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataAccessException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                operations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("boundValueOps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"集群"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("executePipelined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"七、redis常见问题【重点】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、redis常见问题【重点】"}},[t._v("#")]),t._v(" 七、Redis常见问题【重点】")]),t._v(" "),s("h3",{attrs:{id:"_7-1-key的生存时间到了-redis会立即删除吗"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-key的生存时间到了-redis会立即删除吗"}},[t._v("#")]),t._v(" 7.1 key的生存时间到了，Redis会立即删除吗？")]),t._v(" "),s("blockquote",[s("p",[t._v("不会立即删除。")]),t._v(" "),s("ul",[s("li",[t._v("定期删除：Redis每隔一段时间就去会去查看Redis设置了过期时间的key，会再100ms的间隔中默认查看3个key。")]),t._v(" "),s("li",[t._v("惰性删除：如果当你去查询一个已经过了生存时间的key时，Redis会先查看当前key的生存时间，是否已经到了，直接删除当前key，并且给用户返回一个空值。")])])]),t._v(" "),s("h3",{attrs:{id:"_7-2-redis的淘汰机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-redis的淘汰机制"}},[t._v("#")]),t._v(" 7.2 Redis的淘汰机制")]),t._v(" "),s("blockquote",[s("p",[t._v("在Redis内存已经满的时候，添加了一个新的数据，执行淘汰机制。")]),t._v(" "),s("ul",[s("li",[t._v("volatile-lru：在内存不足时，Redis会在设置过了生存时间的key中干掉一个最近最少使用的key。")]),t._v(" "),s("li",[t._v("allkeys-lru：在内存不足时，Redis会再全部的key中干掉一个最近最少使用的key。")]),t._v(" "),s("li",[t._v("volatile-lfu：在内存不足时，Redis会再设置过了生存时间的key中干掉一个最近最少频次使用的key。")]),t._v(" "),s("li",[t._v("allkeys-lfu：在内存不足时，Redis会再全部的key中干掉一个最近最少频次使用的key。")]),t._v(" "),s("li",[t._v("volatile-random：在内存不足时，Redis会再设置过了生存时间的key中随机干掉一个。")]),t._v(" "),s("li",[t._v("allkeys-random：在内存不足时，Redis会再全部的key中随机干掉一个。")]),t._v(" "),s("li",[t._v("volatile-ttl：在内存不足时，Redis会在设置过了生存时间的key中干掉一个剩余生存时间最少的key。")]),t._v(" "),s("li",[t._v("noeviction：（默认）在内存不足时，直接报错。")])]),t._v(" "),s("p",[t._v("指定淘汰机制的方式：maxmemory-policy 具体策略，设置Redis的最大内存：maxmemory 字节大小\n内存配置\n(1)、内存设置")]),t._v(" "),s("p",[t._v("①、如果不设置内存大小或者设置内存大小为0，在64位操作系统下不限制内存大小，在32位操作系统下最多使用3GB内存。\n②、Redis一般推荐设置内存为最大物理内存的四分之三。")]),t._v(" "),s("p",[t._v("(2)、修改文件配置\n修改maxmemory大小，单位字节")])]),t._v(" "),s("h3",{attrs:{id:"_7-3-缓存的常问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-缓存的常问题"}},[t._v("#")]),t._v(" 7.3 缓存的常问题")]),t._v(" "),s("h4",{attrs:{id:"_7-3-1-缓存穿透问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-缓存穿透问题"}},[t._v("#")]),t._v(" 7.3.1 缓存穿透问题")]),t._v(" "),s("blockquote",[s("p",[t._v("缓存穿透")]),t._v(" "),s("p",[t._v("个人理解：指查询一个一定不存在的数据，由于缓存是不命中的，将去查询数据库，但是数据库也没有这个数据，更糟糕的是我们没有把这次查询的 null 结果 写入缓存，这将导致这个不存在的数据每次查询 都走数据库。 缓存也就没有意义了")]),t._v(" "),s("p",[t._v("风险: 利用不存在的数据 进行攻击 数据库瞬时压力增大 可能导致崩溃")]),t._v(" "),s("p",[t._v("解决：将null 结果放入 缓存 ，最好 加入一个 过期时间")])]),t._v(" "),s("h4",{attrs:{id:"_7-3-2-缓存击穿问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-缓存击穿问题"}},[t._v("#")]),t._v(" 7.3.2 缓存击穿问题")]),t._v(" "),s("blockquote",[s("p",[t._v("缓存击穿")]),t._v(" "),s("p",[t._v("个人理解：对于某些热点数据 可能设置了过期时间 或者 在 第一次访问之前缓存中没有 在某一刻的高并发访问 都没有命中缓存，都查询了数据库 这称之为 缓存击穿")]),t._v(" "),s("p",[t._v("解决方案：加锁")]),t._v(" "),s("p",[t._v("预先设置下热点数据")])]),t._v(" "),s("h4",{attrs:{id:"_7-3-3-缓存雪崩问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-3-缓存雪崩问题"}},[t._v("#")]),t._v(" 7.3.3 缓存雪崩问题")]),t._v(" "),s("blockquote",[s("p",[t._v("缓存雪崩")]),t._v(" "),s("p",[t._v("个人理解：我们在设置缓存的 key 时 采用了相同的过期时间 导致缓存在某一时刻同时失效 请求全部转到数据库 数据库瞬时压力大 造成雪崩")]),t._v(" "),s("p",[t._v("解决方案：设置key 的时候 在原有的过期时间上 加上一个 随机值 比如 1-5 分钟的随机值 这样 每一个缓存key 的过期时间 重复率就会降低")])]),t._v(" "),s("h4",{attrs:{id:"_7-3-4-缓存倾斜问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-4-缓存倾斜问题"}},[t._v("#")]),t._v(" 7.3.4 缓存倾斜问题")]),t._v(" "),s("blockquote",[s("p",[t._v("缓存倾斜")]),t._v(" "),s("p",[t._v("问题：热点数据放在了一个Redis节点上，导致Redis节点无法承受住大量的请求，最终Redis宕机。")]),t._v(" "),s("p",[t._v("1.扩展主从架构，搭建大量的从节点，缓解Redis的压力。")]),t._v(" "),s("p",[t._v("2.可以在Tomcat中JVM缓存，在查看Redis之前，先去查询Tomcat中的缓存。")])]),t._v(" "),s("h2",{attrs:{id:"八、redis的使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#八、redis的使用场景"}},[t._v("#")]),t._v(" 八、Redis的使用场景")]),t._v(" "),s("p",[t._v("缓存和数据库的一致性问题，最终解决方案：延迟双删！")]),t._v(" "),s("p",[t._v("redis延迟双删的策略")]),t._v(" "),s("p",[t._v("1.为什么要进行延迟双删\n一般我们在更新数据库数据时，需要同步redis中缓存的数据\n所以存在两种方法：\n（1）第一种方案：先执行update操作，再执行缓存清除。\n（2）第二种方案：先执行缓存清除，再执行update操作。")]),t._v(" "),s("p",[t._v("弊端:当存在并发请求时，很容易出现问题\n（1）第一种方案：当请求1执行update操作后，还未来得及进行缓存清除，此时请求2查询到并使用了redis中的旧数据。\n（2）第二种方案：当请求1执行清除缓存后，还未进行update操作，此时请求2进行查询到了旧数据并写入了redis。")]),t._v(" "),s("p",[t._v("2.如何实现延迟双删\n所以此时我们需要使用第三种方案：\n先进行缓存清除，再执行update，最后（延迟N秒）再执行缓存清除。")]),t._v(" "),s("p",[t._v("3.需要注意的点\n上述中（延迟N秒）的时间要大于一次写操作的时间，一般为3-5秒。\n原因：如果延迟时间小于写入redis的时间，会导致请求1清除了缓存，但是请求2缓存还未写入的尴尬。。。")])])}),[],!1,null,null,null);s.default=e.exports}}]);