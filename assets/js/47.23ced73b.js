(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{464:function(e,r,a){"use strict";a.r(r);var t=a(2),n=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"_1-上移、下移、置顶逻辑"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-上移、下移、置顶逻辑"}},[e._v("#")]),e._v(" 1 上移、下移、置顶逻辑")]),e._v(" "),r("p",[e._v("倒序逻辑：")]),e._v(" "),r("p",[e._v("使用一个sort_order字段来排序")]),e._v(" "),r("p",[e._v("新增：当新增第一个时初始化100000")]),e._v(" "),r("p",[e._v("新增第N个：max(sort_order) -1 ,放在下面")]),e._v(" "),r("p",[e._v("上移：当前sort_order和大于当前sort_order替换（已经最顶不能上移")]),e._v(" "),r("p",[e._v("下移：当前sort_order和小于当前sort_order替换（已经最低不能下移")]),e._v(" "),r("p",[e._v("置顶：当前sort_order和max(sort_order)替换")]),e._v(" "),r("h3",{attrs:{id:"mybatis"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#mybatis"}},[e._v("#")]),e._v(" mybatis")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('  \x3c!-- 读取上一条记录--\x3e\n  <select id="selectPreviousOrder" resultType="java.lang.Integer" parameterType="java.util.Map">\n    SELECT ifnull(iorder, 1) previousOrder\n    FROM goods    \n    WHERE  iorder <![CDATA[ < ]]> #{iorder}\n    order by iorder desc limit 0,1\n  </select>\n \n  \x3c!-- 读取下一条记录--\x3e\n  <select id="selectNextOrder" resultType="java.lang.Integer" parameterType="java.util.Map">\n    SELECT ifnull(iorder, 1) nextOrder\n    FROM goods\n    WHERE  iorder > #{iorder}\n    order by iorder  limit 0,1\n  </select>\n \n  \x3c!-- 修改当前的排序--\x3e\n  <update id="updateSelfOrder" parameterType="java.util.Map">\n    UPDATE goods SET iorder = #{iorder} WHERE au_id = #{auId}\n  </update>\n \n  \x3c!--修改当前的上一个或者下一个的排序 --\x3e\n  <update id="updateOtherOrder" parameterType="java.util.Map">\n    UPDATE goods SET iorder = #{iorder} WHERE iorder = #{originalOrder}\n  </update>\n')])])]),r("h3",{attrs:{id:"service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[e._v("#")]),e._v(" service")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('    @Transactional\n    public int movelOrder(Goods goods, String operateType) {\n        try {\n                //当前移动的分类\n                Map<String, Object> selfMap = new HashMap<>();\n                selfMap.put("auId", goods.getAuId());\n                //当前移动分类的上一个或者下一个\n                Map<String, Object> otherMap = new HashMap<>();\n                otherMap.put("iorder", goods.getIorder());\n                //获取最大排序值\n                Map<String, Object> order = goodsMapper.selectMaxOrder();\n                if ("top".equals(operateType)) { //置顶\n                //获取最大排序值\n                int maxOrder = order == null ? 1 : Integer.valueOf(order.get("maxOrder").toString()) + 1;\n                selfMap.put("iorder", maxOrder);\n                //修改当前排序值为最大排序值+1\n                goodsMapper.updateSelfOrder(selfMap);\n            }\n            if ("up".equals(operateType)) { //上移\n                //获取下一条记录iorder\n                int nextOrder = goodsMapper.selectNextOrder(paramMap);\n                //修改下一条的为当前值\n                otherMap.put("originalOrder", nextOrder );\n                goodsMapper.updateOtherOrder(otherMap);\n                //修改自己的排序为下一条\n                selfMap.put("iorder", nextOrder);\n                goodsMapper.updateSelfOrder(selfMap);\n            }\n            if ("down".equals(operateType)) { //下移\n                //获取上一条记录iorder\n                int previousOrder = goodsMapper.selectPreviousOrder(paramMap);\n                otherMap.put("originalOrder", previousOrder );\n                //修改上一条的为当前值\n                goodsMapper.updateOtherOrder(otherMap);\n                //修改自己的排序为上一条\n                selfMap.put("iorder", previousOrder );\n                goodsMapper.updateSelfOrder(selfMap);\n            }\n        } catch (Exception e) {\n            logger.error("移动异常" + e.getMessage() );\n            return 0;\n        }\n        return 1;\n    }\n')])])])])}),[],!1,null,null,null);r.default=n.exports}}]);